<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Billing App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Animazioni */
        .fade-in { animation: fadeIn 0.3s ease-in; }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        /* Custom colors */
        .card-income { border-left: 4px solid #10b981; }
        .card-expense { border-left: 4px solid #ef4444; }
        .card-balance { border-left: 4px solid #3b82f6; }
        .card-budget { border-left: 4px solid #8b5cf6; }
        
        .btn-income { background-color: #10b981; }
        .btn-income:hover { background-color: #059669; }
        
        .btn-expense { background-color: #ef4444; }
        .btn-expense:hover { background-color: #dc2626; }
        
        .btn-budget { background-color: #8b5cf6; }
        .btn-budget:hover { background-color: #7c3aed; }
        
        .btn-neutral { background-color: #6b7280; }
        .btn-neutral:hover { background-color: #4b5563; }
        
        /* Screen transitions */
        .screen { display: none; }
        .screen.active { display: block; animation: fadeIn 0.3s; }
        
        /* Progress bars */
        .progress-bar { transition: width 0.5s ease-in-out; }
        
        /* Shopping optimization */
        .optimization-card {
            border: 2px solid;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        .optimization-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        /* Toast animation */
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        
        /* Stile per categoria suggerita */
        .suggested {
            border-color: #3b82f6 !important;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1) !important;
            animation: pulse 1s;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        
        /* Tooltip per suggerimento */
        .suggestion-badge {
            background-color: #3b82f6;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 5px;
        }
        
        /* Loader per ricerca negozi */
        .store-loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- APP CONTAINER -->
    <div id="app" class="max-w-4xl mx-auto p-4">
        
        <!-- ==================== SCREEN 1: DASHBOARD ==================== -->
<div id="screen-dashboard" class="screen active">
    <!-- Header -->
    <header class="mb-8">
        <div class="flex justify-between items-center mb-2">
            <div>
                <h1 class="text-3xl font-bold text-gray-800">
                    <i class="fas fa-wallet text-green-500 mr-2"></i>Smart Billing
                </h1>
            </div>
            
            <!-- ðŸ‘‡ AGGIUNGI QUESTO CONTAINER ðŸ‘‡ -->
            <div class="flex items-center space-x-4">
                
                
                <!-- Bottone Profilo (giÃ  esistente) -->
                <button onclick="showScreen('profile')" 
                        class="w-10 h-10 rounded-full bg-gray-200 flex items-center justify-center hover:bg-gray-300">
                    <i class="fas fa-user text-gray-600"></i>
                </button>
                
            </div>
            <!-- ðŸ‘† FINE AGGIUNTA ðŸ‘† -->
        </div>
        <p class="text-gray-500 mt-2">Gestisci le tue finanze in modo intelligente</p>
    </header>
            
            <!-- Alert -->
            <div id="budgetAlert" class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 hidden">
                <div class="flex">
                    <i class="fas fa-exclamation-triangle text-yellow-500 mt-1 mr-3"></i>
                    <div>
                        <p class="font-semibold">Budget superiore alle entrate</p>
                        <p class="text-sm text-yellow-700">Rivedi il budget o aggiungi entrate</p>
                    </div>
                </div>
            </div>
            
            <!-- Stats Cards -->
            <div class="grid grid-cols-2 gap-4 mb-8">
                <!-- Income Card -->
                <div class="card-income bg-white rounded-xl shadow p-5">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <p class="text-gray-500 text-sm uppercase tracking-wider">Entrate</p>
                            <p class="text-2xl font-bold text-gray-800 mt-1" id="dashboard-income">â‚¬0,00</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-money-bill-wave text-green-500 text-xl"></i>
                        </div>
                    </div>
                    <button onclick="showScreen('add-income')" 
                            class="w-full py-2 btn-income text-white rounded-lg font-semibold mt-2 flex items-center justify-center gap-2">
                        <i class="fas fa-plus"></i> Aggiungi Entrata
                    </button>
                </div>
                
                <!-- Expenses Card -->
                <div class="card-expense bg-white rounded-xl shadow p-5">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <p class="text-gray-500 text-sm uppercase tracking-wider">Uscite</p>
                            <p class="text-2xl font-bold text-gray-800 mt-1" id="dashboard-expenses">â‚¬0,00</p>
                        </div>
                        <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-shopping-cart text-red-500 text-xl"></i>
                        </div>
                    </div>
                    <button onclick="askExpenseType()" 
        class="w-full py-2 btn-expense text-white rounded-lg font-semibold mt-2 flex items-center justify-center gap-2">
    <i class="fas fa-plus"></i> <span data-translate="add-expense">Aggiungi Uscita</span>
</button>
                </div>
                
                <!-- Balance Card -->
                <div class="card-balance bg-white rounded-xl shadow p-5">
                <div class="flex justify-between items-start mb-3">
                    <div>
                        <p class="text-gray-500 text-sm uppercase tracking-wider" data-translate="balance">Saldo</p>  <!-- âœ… AGGIUNTO data-translate -->
                        <p class="text-2xl font-bold text-gray-800 mt-1" id="dashboard-balance">â‚¬0,00</p>
                    </div>
                    <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-chart-line text-blue-500 text-xl"></i>
                    </div>
                </div>
                <div class="text-sm text-gray-500 mt-2">
                    <i class="fas fa-info-circle mr-1"></i> 
                    <span data-translate="income-minus-expenses">Entrate - Uscite</span>
                </div>
            </div>
                
                <!-- Budget Card -->
                <div class="card-budget bg-white rounded-xl shadow p-5">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <p class="text-gray-500 text-sm uppercase tracking-wider">Budget</p>
                            <p class="text-2xl font-bold text-gray-800 mt-1" id="dashboard-budget">â‚¬0,00</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                            <i class="fas fa-piggy-bank text-purple-500 text-xl"></i>
                        </div>
                    </div>
                    <button onclick="showScreen('budget')" 
                            class="w-full py-2 btn-budget text-white rounded-lg font-semibold mt-2 flex items-center justify-center gap-2">
                        <i class="fas fa-cog"></i> Gestisci Budget
                    </button>
                </div>
            </div>
            
            <!-- Recent Transactions -->
            <div class="bg-white rounded-xl shadow p-5 mb-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-800">
                        <i class="fas fa-history mr-2"></i>
                        <span data-translate="recent-transactions">Ultime Transazioni</span>
                    </h2>
                    <button onclick="showScreen('transactions')" 
                            class="text-sm text-blue-500 hover:text-blue-700">
                        Vedi tutte â†’
                    </button>
                </div>
                
                <div id="recent-transactions" class="space-y-3">
                    <!-- Filled by JavaScript -->
                </div>
                
                <div class="mt-4 pt-4 border-t">
                <button onclick="askTransactionType()" 
                class="w-full py-3 border-2 border-dashed border-gray-300 text-gray-500 rounded-lg hover:border-green-400 hover:text-green-500 transition">
            <i class="fas fa-plus mr-2"></i>
            <span data-translate="add-new-transaction">Aggiungi Nuova Transazione</span>
        </button>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="grid grid-cols-2 gap-4">
                <button onclick="showScreen('shopping')" 
                        class="bg-white rounded-xl shadow p-4 flex items-center gap-3 hover:shadow-md transition">
                    <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-shopping-basket text-green-500"></i>
                    </div>
                    <div class="text-left">
                        <p class="font-semibold">Lista Spesa</p>
                        <p class="text-sm text-gray-500" id="shopping-count">0 articoli</p>
                    </div>
                </button>
                
                <button onclick="findNearbyStores()" 
                        class="bg-white rounded-xl shadow p-4 flex items-center gap-3 hover:shadow-md transition">
                    <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
                        <i class="fas fa-store text-blue-500"></i>
                    </div>
                    <div class="text-left">
                    <p class="font-semibold" data-translate="stores">Negozi Vicini</p>
                    <p class="text-sm text-gray-500" data-translate="find-prices">Trova prezzi</p>
                </div>
                </button>
            </div>
        </div>
        
        <!-- ==================== SCREEN 2: AGGIUNGI ENTRATA ==================== -->
        <div id="screen-add-income" class="screen">
            <div class="mb-6">
            <button onclick="showScreen('dashboard')" 
            class="flex items-center gap-2 text-gray-600 hover:text-gray-800">
        <i class="fas fa-arrow-left"></i> <span data-translate="back-to-dashboard">Torna alla Dashboard</span>
    </button>
            </div>
            
            <div class="bg-white rounded-xl shadow p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-2">
            <i class="fas fa-money-bill-wave text-green-500 mr-2"></i><span data-translate="new-income">Nuova Entrata</span>
        </h2>
        <p class="text-gray-500 mb-6" data-translate="register-income">Registra una nuova entrata</p>

                
                <div class="space-y-4">
                    <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="description">Descrizione *</label>
                    <input type="text" id="income-desc" 
                    class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                    placeholder="Stipendio, Bonus, Vendita..."
                    data-translate-placeholder="income-placeholder">
                    </div>
                    
                    <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="amount-with-currency">Importo (â‚¬) *</label>
                        <input type="number" step="0.01" id="income-amount" 
                               class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                               placeholder="0,00">
                    </div>
                    
                    <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="category">Categoria</label>
                    <select id="income-category" 
                    class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500">
                    <option value="Stipendio" data-translate="salary">Stipendio</option>
                    <option value="Bonus" data-translate="bonus">Bonus</option>
                    <option value="Investimenti" data-translate="investments">Investimenti</option>
                    <option value="Rendite" data-translate="rental-income">Rendite</option>
                    <option value="Altro" data-translate="other">Altro</option>
                </select>
                    </div>
                    
                    <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="date">Data</label>

                        <input type="date" id="income-date" 
                               class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                               value="${new Date().toISOString().split('T')[0]}">
                    </div>
                    
                    <div class="flex gap-3 pt-4">
                    <button onclick="addIncome()" 
                    class="flex-1 py-3 btn-income text-white rounded-lg font-semibold">
                <i class="fas fa-save mr-2"></i><span data-translate="save-income">Salva Entrata</span>
            </button>
                        <button onclick="showScreen('dashboard')" 
                                class="flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300">
                            Annulla
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- ==================== SCREEN 3: SCELTA TIPO USCITA ==================== -->
        <div id="screen-expense-choice" class="screen">
            <div class="mb-6">
                <button onclick="showScreen('dashboard')" 
                        class="flex items-center gap-2 text-gray-600 hover:text-gray-800">
                    <i class="fas fa-arrow-left"></i> Torna alla Dashboard
                </button>
            </div>
            
            <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-2">
                    <i class="fas fa-shopping-cart text-red-500 mr-2"></i>Aggiungi Uscita
                </h2>
                <p class="text-gray-500 mb-8">Cosa vuoi aggiungere?</p>
                
                <div class="space-y-4">
                    <button onclick="showScreen('shopping')" 
                            class="w-full p-5 border-2 border-dashed border-green-300 rounded-xl text-left hover:border-green-500 hover:bg-green-50 transition group">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center group-hover:bg-green-200">
                                <i class="fas fa-shopping-basket text-green-500 text-xl"></i>
                            </div>
                            <div>
                                <p class="font-bold text-gray-800">Lista della Spesa</p>
                                <p class="text-sm text-gray-500">Aggiungi articoli da acquistare</p>
                            </div>
                            <div class="ml-auto">
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        </div>
                    </button>
                    
                    <button onclick="showScreen('add-expense')" 
                            class="w-full p-5 border-2 border-dashed border-red-300 rounded-xl text-left hover:border-red-500 hover:bg-red-50 transition group">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center group-hover:bg-red-200">
                                <i class="fas fa-receipt text-red-500 text-xl"></i>
                            </div>
                            <div>
                                <p class="font-bold text-gray-800">Uscita Generica</p>
                                <p class="text-sm text-gray-500">Bollette, ristorante, carburante...</p>
                            </div>
                            <div class="ml-auto">
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        </div>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ==================== SCREEN 4: AGGIUNGI USCITA GENERICA ==================== -->
        <div id="screen-add-expense" class="screen">
            <div class="mb-6">
                <button onclick="showScreen('expense-choice')" 
                        class="flex items-center gap-2 text-gray-600 hover:text-gray-800">
                    <i class="fas fa-arrow-left"></i> Torna alla scelta
                </button>
            </div>
            
            <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-2">
                    <i class="fas fa-receipt text-red-500 mr-2"></i>Nuova Uscita
                </h2>
                <p class="text-gray-500 mb-6">Registra una nuova spesa</p>
                
                <div class="space-y-4">
                    <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="description">Descrizione *</label>

                        <input type="text" id="expense-desc" 
                               class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
                               placeholder="Cena, Benzina, Bolletta..."
                               oninput="suggestCategoryOnInput()">
                        <p id="category-suggestion-hint" class="text-xs text-blue-600 mt-1 hidden">
                            <i class="fas fa-lightbulb"></i> Suggerimento: <span id="suggested-category-text"></span>
                        </p>
                    </div>
                    
                    <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="amount-with-currency">Importo (â‚¬) *</label>
                        <input type="number" step="0.01" id="expense-amount" 
                               class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
                               placeholder="0,00">
                    </div>
                    
                    <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="category">Categoria</label>
                        <select id="expense-category" 
        class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500">
    <option value="Alimentari" data-translate="food">Alimentari</option>
    <option value="Bollette" data-translate="utilities">Bollette</option>
    <option value="Mutuo" data-translate="mortgage">Mutuo</option>  <!-- ðŸ”´ NUOVO -->
    <option value="Trasporti" data-translate="transport">Trasporti</option>
    <option value="Svago" data-translate="entertainment">Svago</option>
    <option value="Salute" data-translate="health">Salute</option>
    <option value="Shopping" data-translate="shopping">Shopping</option>
    <option value="Affitto" data-translate="rent">Affitto</option>
    <option value="Altro" data-translate="other">Altro</option>
</select>
                    </div>
                    
                    <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="date">Data</label>

                        <input type="date" id="expense-date" 
                               class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500"
                               value="${new Date().toISOString().split('T')[0]}">
                    </div>
                    
                    <div class="flex gap-3 pt-4">
                    <button onclick="addExpense()" 
                            class="flex-1 py-3 btn-expense text-white rounded-lg font-semibold">
                        <i class="fas fa-save mr-2"></i><span data-translate="save-expense">Salva Uscita</span>
                    </button>
                    <button onclick="showScreen('expense-choice')" 
        class="flex items-center gap-2 text-gray-600 hover:text-gray-800">
    <i class="fas fa-arrow-left"></i> <span data-translate="back-to-choice">Torna alla scelta</span>
</button>
                </div>
                </div>
            </div>
        </div>
        
        <!-- ==================== SCREEN 5: LISTA SPESA ==================== -->
        <div id="screen-shopping" class="screen">
            <div class="mb-6">
                <button onclick="showScreen('dashboard')" 
                        class="flex items-center gap-2 text-gray-600 hover:text-gray-800">
                    <i class="fas fa-arrow-left"></i> Torna alla Dashboard
                </button>
            </div>
            
            <div class="bg-white rounded-xl shadow p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-2">
                    <i class="fas fa-shopping-basket text-green-500 mr-2"></i>Lista della Spesa
                </h2>
                
                <div class="flex gap-2 mb-6">
                    <input type="text" id="shopping-item" 
                           class="flex-1 p-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                           placeholder="Cosa devi comprare?" 
                           onkeypress="if(event.key === 'Enter') addShoppingItem()">
                    <button onclick="addShoppingItem()" 
                            class="px-5 btn-income text-white rounded-lg font-semibold">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
                
                <div id="shopping-list-items" class="space-y-3">
                    <!-- Filled by JavaScript -->
                </div>
                
                <!-- Optimization Options -->
                <div id="optimization-section" class="mt-8 pt-6 border-t">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-chart-line text-purple-500 mr-2"></i>Ottimizza Acquisti
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <button onclick="optimizeLowestPrice()" 
                                class="optimization-card border-green-300 bg-green-50 p-4 text-center">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-euro-sign text-green-600"></i>
                            </div>
                            <p class="font-bold text-gray-800 mb-1">Prezzo piÃ¹ basso</p>
                            <p class="text-sm text-gray-600">Spesa minima totale</p>
                            <p class="text-xs text-green-600 mt-2" id="lowest-price-total">â‚¬0,00 / 0 negozi</p>
                        </button>
                        
                        <button onclick="optimizeFewestStores()" 
                                class="optimization-card border-blue-300 bg-blue-50 p-4 text-center">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-store text-blue-600"></i>
                            </div>
                            <p class="font-bold text-gray-800 mb-1">Meno negozi</p>
                            <p class="text-sm text-gray-600">Visita meno punti vendita</p>
                            <p class="text-xs text-blue-600 mt-2" id="fewest-stores-count">â‚¬0,00 / 0 negozi</p>
                        </button>
                        
                        <button onclick="optimizeBalanced()" 
                                class="optimization-card border-purple-300 bg-purple-50 p-4 text-center">
                            <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                <i class="fas fa-balance-scale text-purple-600"></i>
                            </div>
                            <p class="font-bold text-gray-800 mb-1">Ottimizzato</p>
                            <p class="text-sm text-gray-600">Prezzo e negozi bilanciati</p>
                            <p class="text-xs text-purple-600 mt-2" id="balanced-optimization">â‚¬0,00 / 0 negozi</p>
                        </button>
                    </div>
                    
                    <!-- Optimization Results -->
                    <div id="optimization-results" class="hidden">
                        <div class="p-4 bg-gray-50 rounded-lg">
                            <div class="flex justify-between items-center mb-3">
                                <h4 class="font-semibold text-gray-800" id="optimization-title">Risultato Ottimizzazione</h4>
                                <button onclick="closeOptimizationResults()" class="text-gray-500 hover:text-gray-700">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                            <div class="grid grid-cols-2 gap-4 mb-4">
                                <div class="text-center p-3 bg-white rounded-lg">
                                    <p class="text-sm text-gray-500">Prezzo Totale</p>
                                    <p class="text-xl font-bold text-green-600" id="opt-total-price">â‚¬0,00</p>
                                </div>
                                <div class="text-center p-3 bg-white rounded-lg">
                                    <p class="text-sm text-gray-500">Negozi</p>
                                    <p class="text-xl font-bold text-blue-600" id="opt-store-count">0</p>
                                </div>
                            </div>
                            <div id="optimization-details" class="space-y-3">
                                <!-- Filled dynamically -->
                            </div>
                            <button onclick="applyOptimization()" 
                                    class="w-full mt-4 py-2 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600">
                                <i class="fas fa-check mr-2"></i>Applica questa soluzione
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Nearby Stores -->
            <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">
                    <i class="fas fa-store text-blue-500 mr-2"></i>Negozi Vicini
                </h2>
                
                <div id="nearby-stores" class="space-y-3">
                    <p class="text-gray-500 text-center py-4">
                        Imposta il tuo indirizzo nel profilo per trovare negozi
                    </p>
                </div>
                
                <button id="search-stores-btn" onclick="renderNearbyStores()" 
                        class="w-full mt-4 py-3 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 flex items-center justify-center gap-2">
                    <i class="fas fa-search mr-2"></i>Cerca Negozi Vicini
                </button>
            </div>
        </div>
        
        <!-- ==================== SCREEN 6: GESTIONE BUDGET ==================== -->
        <div id="screen-budget" class="screen">
            <div class="mb-6">
                <button onclick="showScreen('dashboard')" 
                        class="flex items-center gap-2 text-gray-600 hover:text-gray-800">
                    <i class="fas fa-arrow-left"></i> Torna alla Dashboard
                </button>
            </div>
            
            <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-2">
                    <i class="fas fa-piggy-bank text-purple-500 mr-2"></i>Gestione Budget
                </h2>
                <p class="text-gray-500 mb-6">Imposta i budget mensili per categoria</p>
                
                <div id="budget-items" class="space-y-4 mb-6">
                    <!-- Filled by JavaScript -->
                </div>
                
                <div class="pt-4 border-t">
                    <button onclick="showScreen('dashboard')" 
                            class="w-full py-3 btn-neutral text-white rounded-lg font-semibold">
                        <i class="fas fa-check mr-2"></i>Conferma Budget
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ==================== SCREEN 7: PROFILO ==================== -->
        <div id="screen-profile" class="screen">
            <div class="mb-6">
                <button onclick="showScreen('dashboard')" 
                        class="flex items-center gap-2 text-gray-600 hover:text-gray-800">
                    <i class="fas fa-arrow-left"></i> Torna alla Dashboard
                </button>
            </div>
            
            <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-2">
                    <i class="fas fa-user text-blue-500 mr-2"></i>Il Tuo Profilo
                </h2>
                <p class="text-gray-500 mb-6">Configura i tuoi dati per un'esperienza personalizzata</p>
                
                <div class="space-y-8">
                    <!-- Sezione Dati Personali -->
                    <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-id-card mr-2"></i><span data-translate="personal-data">Dati Personali</span>
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" data-translate="first-name">Nome</label>
                            <input type="text" id="profile-firstname" 
                                   class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="Mario">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" data-translate="last-name">Cognome</label>
                            <input type="text" id="profile-lastname" 
                                   class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="Rossi">
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-translate="email">Email</label>
                        <input type="email" id="profile-email" 
                               class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="mario.rossi@email.com">
                    </div>
                </div>
                    
                    <!-- Sezione Indirizzo Casa -->
                    <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-home mr-2"></i><span data-translate="home-address">Indirizzo di Casa</span>
                        <span class="ml-2 text-xs bg-green-100 text-green-800 px-2 py-1 rounded" data-translate="used-for-stores">Usato per trovare negozi</span>
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" data-translate="street">Via</label>
                            <input type="text" id="home-street" 
                                   class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="Via Roma">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" data-translate="number">Numero</label>
                            <input type="text" id="home-number" 
                                   class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="123">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" data-translate="city">CittÃ </label>
                            <input type="text" id="home-city" 
                                   class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="Milano">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" data-translate="province">Provincia</label>
                            <input type="text" id="home-province" 
                                   class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 uppercase max-w-[80px]"
                                   placeholder="MI" maxlength="2">
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-translate="country">Paese</label>
                        <select id="home-country" 
                                class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="IT">ðŸ‡®ðŸ‡¹ Italia</option>
                            <option value="RO">ðŸ‡·ðŸ‡´ RomÃ¢nia</option>
                            <option value="US">ðŸ‡ºðŸ‡¸ United States</option>
                            <option value="GB">ðŸ‡¬ðŸ‡§ United Kingdom</option>
                            <option value="ES">ðŸ‡ªðŸ‡¸ EspaÃ±a</option>
                            <option value="FR">ðŸ‡«ðŸ‡· France</option>
                            <option value="DE">ðŸ‡©ðŸ‡ª Deutschland</option>
                            <option value="CH">ðŸ‡¨ðŸ‡­ Schweiz</option>
                        </select>
                    </div>
                </div>
                    
                    <!-- Sezione Indirizzo Lavoro -->
                    <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-briefcase mr-2"></i><span data-translate="work-address">Indirizzo di Lavoro</span>
                        <span class="ml-2 text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded" data-translate="optional">Facoltativo</span>
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" data-translate="street">Via</label>
                            <input type="text" id="work-street" 
                                   class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="Via Milano">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" data-translate="number">Numero</label>
                            <input type="text" id="work-number" 
                                   class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="456">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" data-translate="city">CittÃ </label>
                            <input type="text" id="work-city" 
                                   class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                                   placeholder="Milano">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1" data-translate="province">Provincia</label>
                            <input type="text" id="work-province" 
                                   class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500 uppercase max-w-[80px]"
                                   placeholder="MI" maxlength="2">
                        </div>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-translate="country">Paese</label>
                        <select id="work-country" 
                                class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500">
                            <option value="" data-translate="select">-- Seleziona --</option>
                            <option value="IT">ðŸ‡®ðŸ‡¹ Italia</option>
                            <option value="RO">ðŸ‡·ðŸ‡´ RomÃ¢nia</option>
                            <option value="US">ðŸ‡ºðŸ‡¸ United States</option>
                            <option value="GB">ðŸ‡¬ðŸ‡§ United Kingdom</option>
                            <option value="ES">ðŸ‡ªðŸ‡¸ EspaÃ±a</option>
                            <option value="FR">ðŸ‡«ðŸ‡· France</option>
                            <option value="DE">ðŸ‡©ðŸ‡ª Deutschland</option>
                            <option value="CH">ðŸ‡¨ðŸ‡­ Schweiz</option>
                        </select>
                    </div>
                    <div class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-1" data-translate="company">Nome Azienda</label>
                        <input type="text" id="work-company" 
                               class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500"
                               placeholder="Nome della tua azienda">
                    </div>
                </div>
                    
                    <!-- NUOVA SEZIONE: Lingua e Valuta -->
                    <div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-globe mr-2"></i><span data-translate="international-preferences">Preferenze Internazionali</span>
                    </h3>
                
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="preferred-language">Lingua Preferita</label>
                            <select id="profile-language" 
                                    class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="it">ðŸ‡®ðŸ‡¹ Italiano</option>
                                <option value="en">ðŸ‡¬ðŸ‡§ English</option>
                                <option value="es">ðŸ‡ªðŸ‡¸ EspaÃ±ol</option>
                                <option value="fr">ðŸ‡«ðŸ‡· FranÃ§ais</option>
                                <option value="de">ðŸ‡©ðŸ‡ª Deutsch</option>
                                <option value="ro">ðŸ‡·ðŸ‡´ RomÃ¢nÄƒ</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="default-currency">Valuta Predefinita</label>
                            <select id="profile-currency" 
                                    class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-purple-500">
                                <option value="EUR">â‚¬ Euro (EUR) - Unione Europea</option>
                                <option value="USD">$ US Dollar (USD) - Stati Uniti</option>
                                <option value="GBP">Â£ British Pound (GBP) - Regno Unito</option>
                                <option value="RON">lei Romanian Leu (RON) - Romania</option>
                                <option value="CHF">CHF Swiss Franc (CHF) - Svizzera</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Preview valuta -->
                    <div id="currency-preview" class="mt-4 p-3 bg-gray-50 rounded-lg hidden">
                        <p class="text-sm text-gray-600 mb-1" data-translate="formatting-preview">Anteprima formattazione:</p>
                        <p class="font-mono text-lg">
                            <span id="preview-amount">1.234,56</span>
                            <span class="text-gray-500 ml-2" id="preview-info"></span>
                        </p>
                    </div>
                </div>
                    <!-- Pulsanti Azione -->
                    <div class="flex flex-col sm:flex-row gap-3 pt-6 border-t">
                    <button onclick="saveProfile()" 
                            class="flex-1 py-3 btn-income text-white rounded-lg font-semibold flex items-center justify-center gap-2">
                        <i class="fas fa-save"></i> <span data-translate="save-profile">Salva Profilo</span>
                    </button>
                    <button onclick="showScreen('dashboard')" 
                            class="flex-1 py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300 flex items-center justify-center gap-2">
                        <i class="fas fa-times"></i> <span data-translate="cancel">Annulla</span>
                    </button>
                </div>
                </div>
            </div>
        </div>
        
        <!-- ==================== SCREEN 8: TUTTE LE TRANSAZIONI ==================== -->
        <div id="screen-transactions" class="screen">
            <div class="mb-6">
                <button onclick="showScreen('dashboard')" 
                        class="flex items-center gap-2 text-gray-600 hover:text-gray-800">
                    <i class="fas fa-arrow-left"></i> Torna alla Dashboard
                </button>
            </div>
            
            <div class="bg-white rounded-xl shadow p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-exchange-alt mr-2"></i>Tutte le Transazioni
                </h2>
                
                <div id="all-transactions" class="space-y-3">
                    <!-- Filled by JavaScript -->
                </div>
            </div>
        </div>

    </div>

    <!-- JAVASCRIPT -->
    <script>
        // ==================== STACKBLITZ STORAGE SOLUTION ====================
// Sistema di storage garantito per Stackblitz
const appStorage = {
    data: {},
    
    setItem: function(key, value) {
        // Prima prova localStorage
        try {
            if (typeof localStorage !== 'undefined') {
                localStorage.setItem(key, JSON.stringify(value));
                return;
            }
        } catch (e) {}
        
        // Poi prova sessionStorage
        try {
            if (typeof sessionStorage !== 'undefined') {
                sessionStorage.setItem(key, JSON.stringify(value));
                return;
            }
        } catch (e) {}
        
        // Fallback: variabile globale
        this.data[key] = value;
        console.log('Storage fallback usato per:', key);
    },
    
    getItem: function(key) {
        // Prima prova localStorage
        try {
            if (typeof localStorage !== 'undefined') {
                const item = localStorage.getItem(key);
                if (item) return JSON.parse(item);
            }
        } catch (e) {}
        
        // Poi prova sessionStorage
        try {
            if (typeof sessionStorage !== 'undefined') {
                const item = sessionStorage.getItem(key);
                if (item) return JSON.parse(item);
            }
        } catch (e) {}
        
        // Fallback: variabile globale
        return this.data[key] || null;
    },
    
    removeItem: function(key) {
        try { localStorage.removeItem(key); } catch (e) {}
        try { sessionStorage.removeItem(key); } catch (e) {}
        delete this.data[key];
    },
    
    clear: function() {
        try { localStorage.clear(); } catch (e) {}
        try { sessionStorage.clear(); } catch (e) {}
        this.data = {};
    }
};

// DEBUG: Controlla se lo storage funziona
console.log('Storage system ready:', appStorage);
window.GLOBAL_APP_DATA = {
    userProfile: null,
    lastSave: null
};
// ====================================================================
  // ==================== DATA ====================
let userProfile = {
    // Personal data
    firstName: '',
    lastName: '',
    email: '',
    
    // Home address
    homeStreet: '',
    homeNumber: '',
    homeCity: '',
    homeProvince: '',
    homeCountry: 'IT',  // <-- NUOVO CAMPO (codice ISO a 2 lettere)
    homeFullAddress: '',
    
    // Work address
    workStreet: '',
    workNumber: '',
    workCity: '',
    workProvince: '',
    workCountry: '',    // <-- NUOVO CAMPO
    workCompany: '',
    workFullAddress: '',
    
    // NUOVI CAMPI: Internazionalizzazione
    language: 'en',
    currency: 'EUR',
    currencySymbol: 'â‚¬'
};

// Dizionari per lingue e valute
const languages = {
    'it': { name: 'Italiano', flag: 'ðŸ‡®ðŸ‡¹' },
    'en': { name: 'English', flag: 'ðŸ‡¬ðŸ‡§' },
    'es': { name: 'EspaÃ±ol', flag: 'ðŸ‡ªðŸ‡¸' },
    'fr': { name: 'FranÃ§ais', flag: 'ðŸ‡«ðŸ‡·' },
    'de': { name: 'Deutsch', flag: 'ðŸ‡©ðŸ‡ª' },
    'ro': { name: 'RomÃ¢nÄƒ', flag: 'ðŸ‡·ðŸ‡´' }
};

const currencies = {
    'EUR': { name: 'Euro', symbol: 'â‚¬', country: 'UE' },
    'USD': { name: 'US Dollar', symbol: '$', country: 'USA' },
    'GBP': { name: 'British Pound', symbol: 'Â£', country: 'UK' },
    'RON': { name: 'Romanian Leu', symbol: 'lei', country: 'Romania' },
    'CHF': { name: 'Swiss Franc', symbol: 'CHF', country: 'Switzerland' }
};
const countries = {
    'IT': { name: 'Italia', flag: 'ðŸ‡®ðŸ‡¹', code: 'IT' },
    'RO': { name: 'RomÃ¢nia', flag: 'ðŸ‡·ðŸ‡´', code: 'RO' },
    'US': { name: 'United States', flag: 'ðŸ‡ºðŸ‡¸', code: 'US' },
    'GB': { name: 'United Kingdom', flag: 'ðŸ‡¬ðŸ‡§', code: 'GB' },
    'ES': { name: 'EspaÃ±a', flag: 'ðŸ‡ªðŸ‡¸', code: 'ES' },
    'FR': { name: 'France', flag: 'ðŸ‡«ðŸ‡·', code: 'FR' },
    'DE': { name: 'Deutschland', flag: 'ðŸ‡©ðŸ‡ª', code: 'DE' },
    'CH': { name: 'Schweiz', flag: 'ðŸ‡¨ðŸ‡­', code: 'CH' }
};
let transactions = [
    { id: 1, amount: 1500, description: 'Stipendio', category: 'Stipendio', type: 'entrata', date: '2024-01-15' },
    { id: 2, amount: 85.50, description: 'Spesa settimanale', category: 'Alimentari', type: 'uscita', date: '2024-01-16' },
    { id: 3, amount: 650, description: 'Affitto', category: 'Affitto', type: 'uscita', date: '2024-01-01' },
    { id: 4, amount: 45, description: 'Ristorante', category: 'Svago', type: 'uscita', date: '2024-01-18' },
];

let shoppingList = [
    { id: 1, name: 'Pane', checked: false, bestPrice: null, bestStore: null, prices: [], recognized: true },
    { id: 2, name: 'Latte', checked: false, bestPrice: null, bestStore: null, prices: [], recognized: true },
    { id: 3, name: 'Uova', checked: false, bestPrice: null, bestStore: null, prices: [], recognized: true },
];

let budget = {
    Alimentari: 300,
    Affitto: 650,
    Bollette: 150,
    Trasporti: 100,
    Svago: 200,
    Salute: 50
};
    // ==================== SUGGERIMENTO CATEGORIE INTELLIGENTE ====================
    const categoryKeywords = {
        'Bollette': ['luce', 'elettrica', 'gas', 'acqua', 'riscaldamento', 'telefono', 'internet', 'fibra', 'adsl', 'enel', 'enel energia', 'energia', 'bolletta', 'fornitura', 'utenza'],
        'Alimentari': ['spesa', 'alimentari', 'supermercato', 'alimentare', 'cibo', 'cucina', 'mercato', 'grossista'],
        'Trasporti': ['benzina', 'diesel', 'carburante', 'gasolio', 'autostrada', 'parcheggio', 'taxi', 'trasporto', 'bus', 'treno', 'metro', 'mezzi', 'biglietto', 'abbonamento'],
        'Svago': ['ristorante', 'pizza', 'cena', 'pranzo', 'cinema', 'teatro', 'concerto', 'disco', 'bar', 'pub', 'vacanza', 'viaggio', 'hotel', 'divertimento'],
        'Salute': ['farmacia', 'farmaco', 'medico', 'dottore', 'ospedale', 'analisi', 'visita', 'specialista', 'dentista', 'oculista', 'medicina'],
        'Shopping': ['vestiti', 'abbigliamento', 'scarpe', 'tecnologia', 'elettronica', 'arredamento', 'mobile', 'casa', 'giocattolo', 'regalo'],
        'Affitto': ['affitto', 'mutuo', 'rata', 'condominio', 'casa', 'appartamento', 'locazione']
    };

    // Dizionario per imparare dalle correzioni utente
    let learnedCategories = JSON.parse(sessionStorage.getItem('learnedCategories') || '{}');

    // Suggerisci categoria basata sul nome della spesa
    function suggestCategory(description) {
        const descLower = description.toLowerCase().trim();
        
        // 1. Controlla prima nelle categorie imparate
        for (const [keyword, category] of Object.entries(learnedCategories)) {
            if (descLower.includes(keyword.toLowerCase())) {
                return category;
            }
        }
        
        // 2. Controlla nelle keyword predefinite
        for (const [category, keywords] of Object.entries(categoryKeywords)) {
            for (const keyword of keywords) {
                if (descLower.includes(keyword.toLowerCase())) {
                    return category;
                }
            }
        }
        
        // 3. Default
        return 'Altro';
    }

    // Impara dalla correzione utente
    function learnCategory(description, category) {
    const descLower = description.toLowerCase().trim();
    const words = descLower.split(' ').filter(word => word.length > 2);
    
    words.forEach(word => {
        if (word.length > 3) {
            learnedCategories[word] = category;
        }
    });
    
    // Salva in ENTRAMBI i sistemi
    appStorage.setItem('learnedCategories', learnedCategories);
    try {
        sessionStorage.setItem('learnedCategories', JSON.stringify(learnedCategories));
    } catch (e) {
        console.log('sessionStorage fallito per learnedCategories:', e);
    }
}

    // Mostra suggerimento in tempo reale
    function suggestCategoryOnInput() {
        const descInput = document.getElementById('expense-desc');
        const categorySelect = document.getElementById('expense-category');
        const hintElement = document.getElementById('category-suggestion-hint');
        const suggestedText = document.getElementById('suggested-category-text');
        
        if (descInput.value.trim().length > 2) {
            const suggestedCategory = suggestCategory(descInput.value);
            
            // Evidenzia il suggerimento
            categorySelect.value = suggestedCategory;
            categorySelect.classList.add('suggested');
            
            // Mostra l'hint
            hintElement.classList.remove('hidden');
            suggestedText.textContent = suggestedCategory;
            
            // Rimuovi l'evidenziazione dopo 1.5 secondi
            setTimeout(() => {
                categorySelect.classList.remove('suggested');
            }, 1500);
        } else {
            hintElement.classList.add('hidden');
        }
    }

    // Database dei prezzi per negozio - AGGIORNATO CON PIÃ™ PRODOTTI
    const storePrices = {
        'Esselunga': {
            'pane': 1.99,
            'latte': 1.49,
            'uova': 2.99,
            'pasta': 0.89,
            'riso': 1.29,
            'pomodori': 2.49,
            'formaggio': 4.99,
            'yogurt': 2.19,
            'caffÃ¨': 3.49,
            'biscotti': 1.79,
            'burro': 2.49,
            'olio': 5.99,
            'zucchero': 1.29,
            'sale': 0.89,
            'acqua': 0.39,
            'vino': 6.99,
            'birra': 1.99,
            'carne': 12.99,
            'pollo': 8.99,
            'pesce': 14.99,
            'frutta': 3.49,
            'verdura': 2.99,
            'penne': 1.19,
            'spaghetti': 1.09,
            'lasagne': 3.49,
            'mozzarella': 2.99,
            'parmigiano': 12.99,
            'prosciutto': 15.99,
            'salame': 13.99,
            'tonno': 3.99,
            'salmone': 18.99,
            'banane': 1.99,
            'mele': 2.49,
            'arance': 2.29,
            'limoni': 1.79,
            'patate': 1.49,
            'cipolle': 1.29,
            'aglio': 2.99,
            'carote': 1.19,
            'insalata': 1.99,
            'pane integrale': 2.29,
            'pane bianco': 1.99,
            'latte intero': 1.59,
            'latte scremato': 1.59,
            'uova di gallina': 3.49,
            'pasta integrale': 1.49,
            'crackers': 2.49,
            'cereali': 3.99,
            'marmellata': 2.79,
            'miele': 4.99,
            'succo': 1.89,
            'succhi': 1.89,
            'aranciata': 1.49,
            'coca cola': 1.79,
            'coca-cola': 1.79,
            'pepsi': 1.69,
            'fanta': 1.49,
            'sprite': 1.49,
            'cioccolato': 2.99,
            'gelato': 4.99,
            'pizza surgelata': 3.49,
            'hamburger': 8.99,
            'salsiccia': 7.99,
            'wurstel': 3.99,
            'maionese': 2.49,
            'ketchup': 1.99,
            'senape': 1.79,
            'aceto': 2.29,
            'pepe': 3.49,
            'paprika': 2.99,
            'cannella': 4.99,
            'noce moscata': 5.49,
            'curry': 3.79,
            'zenzero': 4.29,
            'prezzemolo': 0.99,
            'basilico': 1.29,
            'rosmarino': 1.49,
            'salvia': 1.59,
            'timo': 1.49
        },
        'Carrefour Express': {
            'pane': 2.19,
            'latte': 1.59,
            'uova': 3.19,
            'pasta': 0.99,
            'riso': 1.39,
            'pomodori': 2.69,
            'formaggio': 5.29,
            'yogurt': 2.39,
            'caffÃ¨': 3.79,
            'biscotti': 1.99,
            'burro': 2.69,
            'olio': 6.29,
            'zucchero': 1.39,
            'sale': 0.99,
            'acqua': 0.49,
            'vino': 7.49,
            'birra': 2.19,
            'carne': 13.99,
            'pollo': 9.49,
            'pesce': 15.99,
            'frutta': 3.79,
            'verdura': 3.29,
            'penne': 1.29,
            'spaghetti': 1.19,
            'lasagne': 3.79,
            'mozzarella': 3.29,
            'parmigiano': 13.99,
            'prosciutto': 16.99,
            'salame': 14.99,
            'tonno': 4.29,
            'salmone': 19.99,
            'banane': 2.19,
            'mele': 2.69,
            'arance': 2.49,
            'limoni': 1.99,
            'patate': 1.69,
            'cipolle': 1.49,
            'aglio': 3.29,
            'carote': 1.39,
            'insalata': 2.19,
            'pane integrale': 2.49,
            'pane bianco': 2.19,
            'latte intero': 1.69,
            'latte scremato': 1.69,
            'uova di gallina': 3.79,
            'pasta integrale': 1.69,
            'crackers': 2.69,
            'cereali': 4.29,
            'marmellata': 2.99,
            'miele': 5.49,
            'succo': 1.99,
            'succhi': 1.99,
            'aranciata': 1.59,
            'coca cola': 1.89,
            'coca-cola': 1.89,
            'pepsi': 1.79,
            'fanta': 1.59,
            'sprite': 1.59,
            'cioccolato': 3.29,
            'gelato': 5.49,
            'pizza surgelata': 3.79,
            'hamburger': 9.49,
            'salsiccia': 8.49,
            'wurstel': 4.29,
            'maionese': 2.69,
            'ketchup': 2.19,
            'senape': 1.99,
            'aceto': 2.49,
            'pepe': 3.79,
            'paprika': 3.29,
            'cannella': 5.49,
            'noce moscata': 5.99,
            'curry': 4.09,
            'zenzero': 4.69,
            'prezzemolo': 1.19,
            'basilico': 1.49,
            'rosmarino': 1.69,
            'salvia': 1.79,
            'timo': 1.69
        },
        'Conad': {
            'pane': 1.89,
            'latte': 1.39,
            'uova': 2.89,
            'pasta': 0.85,
            'riso': 1.25,
            'pomodori': 2.39,
            'formaggio': 4.79,
            'yogurt': 2.09,
            'caffÃ¨': 3.29,
            'biscotti': 1.69,
            'burro': 2.29,
            'olio': 5.49,
            'zucchero': 1.19,
            'sale': 0.79,
            'acqua': 0.35,
            'vino': 6.49,
            'birra': 1.79,
            'carne': 11.99,
            'pollo': 7.99,
            'pesce': 13.99,
            'frutta': 3.19,
            'verdura': 2.79,
            'penne': 1.09,
            'spaghetti': 0.99,
            'lasagne': 3.19,
            'mozzarella': 2.79,
            'parmigiano': 11.99,
            'prosciutto': 14.99,
            'salame': 12.99,
            'tonno': 3.69,
            'salmone': 17.99,
            'banane': 1.79,
            'mele': 2.29,
            'arance': 2.09,
            'limoni': 1.59,
            'patate': 1.29,
            'cipolle': 1.09,
            'aglio': 2.79,
            'carote': 1.09,
            'insalata': 1.79,
            'pane integrale': 2.09,
            'pane bianco': 1.89,
            'latte intero': 1.49,
            'latte scremato': 1.49,
            'uova di gallina': 3.29,
            'pasta integrale': 1.39,
            'crackers': 2.29,
            'cereali': 3.79,
            'marmellata': 2.59,
            'miele': 4.79,
            'succo': 1.79,
            'succhi': 1.79,
            'aranciata': 1.39,
            'coca cola': 1.69,
            'coca-cola': 1.69,
            'pepsi': 1.59,
            'fanta': 1.39,
            'sprite': 1.39,
            'cioccolato': 2.79,
            'gelato': 4.79,
            'pizza surgelata': 3.29,
            'hamburger': 8.49,
            'salsiccia': 7.49,
            'wurstel': 3.79,
            'maionese': 2.29,
            'ketchup': 1.89,
            'senape': 1.69,
            'aceto': 2.09,
            'pepe': 3.29,
            'paprika': 2.79,
            'cannella': 4.79,
            'noce moscata': 5.29,
            'curry': 3.59,
            'zenzero': 4.09,
            'prezzemolo': 0.89,
            'basilico': 1.19,
            'rosmarino': 1.39,
            'salvia': 1.49,
            'timo': 1.39
        },
        'Tigre': {
            'pane': 1.79,
            'latte': 1.29,
            'uova': 2.79,
            'pasta': 0.79,
            'riso': 1.19,
            'pomodori': 2.29,
            'formaggio': 4.59,
            'yogurt': 1.99,
            'caffÃ¨': 3.19,
            'biscotti': 1.59,
            'burro': 2.19,
            'olio': 5.29,
            'zucchero': 1.09,
            'sale': 0.69,
            'acqua': 0.29,
            'vino': 5.99,
            'birra': 1.59,
            'carne': 10.99,
            'pollo': 6.99,
            'pesce': 12.99,
            'frutta': 2.99,
            'verdura': 2.59,
            'penne': 0.99,
            'spaghetti': 0.89,
            'lasagne': 2.99,
            'mozzarella': 2.59,
            'parmigiano': 10.99,
            'prosciutto': 13.99,
            'salame': 11.99,
            'tonno': 3.49,
            'salmone': 16.99,
            'banane': 1.59,
            'mele': 2.09,
            'arance': 1.89,
            'limoni': 1.39,
            'patate': 1.19,
            'cipolle': 0.99,
            'aglio': 2.59,
            'carote': 0.99,
            'insalata': 1.59,
            'pane integrale': 1.89,
            'pane bianco': 1.79,
            'latte intero': 1.39,
            'latte scremato': 1.39,
            'uova di gallina': 3.09,
            'pasta integrale': 1.29,
            'crackers': 2.19,
            'cereali': 3.59,
            'marmellata': 2.39,
            'miele': 4.59,
            'succo': 1.69,
            'succhi': 1.69,
            'aranciata': 1.29,
            'coca cola': 1.59,
            'coca-cola': 1.59,
            'pepsi': 1.49,
            'fanta': 1.29,
            'sprite': 1.29,
            'cioccolato': 2.59,
            'gelato': 4.59,
            'pizza surgelata': 3.09,
            'hamburger': 7.99,
            'salsiccia': 6.99,
            'wurstel': 3.59,
            'maionese': 2.09,
            'ketchup': 1.79,
            'senape': 1.59,
            'aceto': 1.99,
            'pepe': 3.09,
            'paprika': 2.59,
            'cannella': 4.59,
            'noce moscata': 5.09,
            'curry': 3.39,
            'zenzero': 3.89,
            'prezzemolo': 0.79,
            'basilico': 1.09,
            'rosmarino': 1.29,
            'salvia': 1.39,
            'timo': 1.29
        }
    };

    // Store information - AGGIORNATO CON PIÃ™ PRODOTTI
    let stores = [
        { 
            name: 'Esselunga', 
            distance: '1.2 km', 
            items: ['pane', 'latte', 'uova', 'pasta', 'riso', 'pomodori', 'formaggio', 'yogurt', 'caffÃ¨', 'biscotti', 'crackers', 'cereali', 'succo', 'aranciata', 'cioccolato'],
            rating: 4.2,
            type: 'supermercato'
        },
        { 
            name: 'Carrefour Express', 
            distance: '0.8 km', 
            items: ['pane', 'latte', 'uova', 'pasta', 'riso', 'pomodori', 'formaggio', 'yogurt', 'caffÃ¨', 'biscotti', 'crackers', 'cereali', 'succo', 'aranciata', 'cioccolato'],
            rating: 3.9,
            type: 'supermercato'
        },
        { 
            name: 'Conad', 
            distance: '1.5 km', 
            items: ['pane', 'latte', 'uova', 'pasta', 'riso', 'pomodori', 'formaggio', 'yogurt', 'caffÃ¨', 'biscotti', 'crackers', 'cereali', 'succo', 'aranciata', 'cioccolato'],
            rating: 4.0,
            type: 'supermercato'
        },
        { 
            name: 'Tigre', 
            distance: '2.1 km', 
            items: ['pane', 'latte', 'uova', 'pasta', 'riso', 'pomodori', 'formaggio', 'yogurt', 'caffÃ¨', 'biscotti', 'crackers', 'cereali', 'succo', 'aranciata', 'cioccolato'],
            rating: 4.5,
            type: 'supermercato'
        },
        { 
            name: 'Panificio Rossi', 
            distance: '0.5 km', 
            items: ['pane', 'pane integrale', 'pane bianco', 'biscotti', 'crackers', 'cioccolato'],
            rating: 4.3,
            type: 'panificio'
        },
        { 
            name: 'Frutta & Verdura Mario', 
            distance: '0.7 km', 
            items: ['frutta', 'verdura', 'pomodori', 'patate', 'cipolle', 'aglio', 'carote', 'insalata', 'banane', 'mele', 'arance', 'limoni'],
            rating: 4.1,
            type: 'fruttivendolo'
        },
        { 
            name: 'Macelleria Bianchi', 
            distance: '1.1 km', 
            items: ['carne', 'pollo', 'hamburger', 'salsiccia', 'wurstel', 'prosciutto', 'salame'],
            rating: 4.4,
            type: 'macelleria'
        },
        { 
            name: 'Pescheria Azzurra', 
            distance: '1.8 km', 
            items: ['pesce', 'tonno', 'salmone'],
            rating: 4.2,
            type: 'pescheria'
        }
    ];

    // Funzione per aggiornare dinamicamente i prodotti nei negozi
    function updateStoreProducts() {
        // Raccoglie tutti i prodotti unici dalla lista della spesa
        const allProducts = [...new Set(shoppingList.map(item => item.name.toLowerCase()))];
        
        // Per ogni negozio, aggiunge i prodotti che non ha giÃ 
        stores.forEach(store => {
            // Se Ã¨ un supermercato, aggiunge piÃ¹ prodotti
            if (store.type === 'supermercato') {
                allProducts.forEach(product => {
                    if (!store.items.includes(product)) {
                        // Aggiungi se il prodotto ha senso per un supermercato
                        const commonProducts = ['pane', 'latte', 'uova', 'pasta', 'riso', 'formaggio', 'yogurt', 
                                              'caffÃ¨', 'biscotti', 'crackers', 'cereali', 'succo', 'aranciata', 
                                              'cioccolato', 'gelato', 'pizza surgelata', 'maionese', 'ketchup'];
                        
                        if (commonProducts.some(cp => product.includes(cp) || cp.includes(product))) {
                            store.items.push(product);
                        }
                    }
                });
            }
            // Altrimenti, aggiunge solo prodotti pertinenti
            else if (store.type === 'panificio') {
                allProducts.forEach(product => {
                    if (product.includes('pane') || product.includes('biscotti') || 
                        product.includes('crackers') || product.includes('cioccolato')) {
                        if (!store.items.includes(product)) {
                            store.items.push(product);
                        }
                    }
                });
            }
            else if (store.type === 'fruttivendolo') {
                allProducts.forEach(product => {
                    if (product.includes('frutta') || product.includes('verdura') || 
                        product.includes('pomodori') || product.includes('patate') ||
                        product.includes('cipolle') || product.includes('aglio') ||
                        product.includes('carote') || product.includes('insalata') ||
                        product.includes('banane') || product.includes('mele') ||
                        product.includes('arance') || product.includes('limoni')) {
                        if (!store.items.includes(product)) {
                            store.items.push(product);
                        }
                    }
                });
            }
        });
    }

    // Ottimizzazione corrente
    let currentOptimization = null;

    // ==================== SUGGERIMENTI PRODOTTI ====================
    // ==================== DIZIONARIO PRODOTTI MULTILINGUA ====================
const productDictionary = {
    // PANE E SIMILI
    'pane': { name: 'Pane', category: 'Panetteria', translations: { 'it': 'Pane', 'en': 'Bread', 'es': 'Pan', 'fr': 'Pain', 'de': 'Brot', 'ro': 'PÃ¢ine' } },
    'paine': { name: 'PÃ¢ine', category: 'Panetteria', translations: { 'it': 'Pane', 'en': 'Bread', 'es': 'Pan', 'fr': 'Pain', 'de': 'Brot', 'ro': 'PÃ¢ine' } },
    'bread': { name: 'Bread', category: 'Bakery', translations: { 'it': 'Pane', 'en': 'Bread', 'es': 'Pan', 'fr': 'Pain', 'de': 'Brot', 'ro': 'PÃ¢ine' } },
    'pan': { name: 'Pan', category: 'PanaderÃ­a', translations: { 'it': 'Pane', 'en': 'Bread', 'es': 'Pan', 'fr': 'Pain', 'de': 'Brot', 'ro': 'PÃ¢ine' } },
    'pain': { name: 'Pain', category: 'Boulangerie', translations: { 'it': 'Pane', 'en': 'Bread', 'es': 'Pan', 'fr': 'Pain', 'de': 'Brot', 'ro': 'PÃ¢ine' } },
    'brot': { name: 'Brot', category: 'BÃ¤ckerei', translations: { 'it': 'Pane', 'en': 'Bread', 'es': 'Pan', 'fr': 'Pain', 'de': 'Brot', 'ro': 'PÃ¢ine' } },
    
    'pane integrale': { name: 'Pane Integrale', category: 'Panetteria', translations: { 'it': 'Pane Integrale', 'en': 'Whole Wheat Bread', 'es': 'Pan Integral', 'fr': 'Pain Complet', 'de': 'Vollkornbrot', 'ro': 'PÃ¢ine IntegralÄƒ' } },
    'whole wheat bread': { name: 'Whole Wheat Bread', category: 'Bakery', translations: { 'it': 'Pane Integrale', 'en': 'Whole Wheat Bread', 'es': 'Pan Integral', 'fr': 'Pain Complet', 'de': 'Vollkornbrot', 'ro': 'PÃ¢ine IntegralÄƒ' } },
    
    'pane bianco': { name: 'Pane Bianco', category: 'Panetteria', translations: { 'it': 'Pane Bianco', 'en': 'White Bread', 'es': 'Pan Blanco', 'fr': 'Pain Blanc', 'de': 'WeiÃŸbrot', 'ro': 'PÃ¢ine AlbÄƒ' } },
    
    // LATTE E LATTICINI
    'latte': { name: 'Latte', category: 'Latticini', translations: { 'it': 'Latte', 'en': 'Milk', 'es': 'Leche', 'fr': 'Lait', 'de': 'Milch', 'ro': 'Lapte' } },
    'milk': { name: 'Milk', category: 'Dairy', translations: { 'it': 'Latte', 'en': 'Milk', 'es': 'Leche', 'fr': 'Lait', 'de': 'Milch', 'ro': 'Lapte' } },
    'leche': { name: 'Leche', category: 'LÃ¡cteos', translations: { 'it': 'Latte', 'en': 'Milk', 'es': 'Leche', 'fr': 'Lait', 'de': 'Milch', 'ro': 'Lapte' } },
    'lait': { name: 'Lait', category: 'Produits laitiers', translations: { 'it': 'Latte', 'en': 'Milk', 'es': 'Leche', 'fr': 'Lait', 'de': 'Milch', 'ro': 'Lapte' } },
    'milch': { name: 'Milch', category: 'Molkereiprodukte', translations: { 'it': 'Latte', 'en': 'Milk', 'es': 'Leche', 'fr': 'Lait', 'de': 'Milch', 'ro': 'Lapte' } },
    'lapte': { name: 'Lapte', category: 'Lactate', translations: { 'it': 'Latte', 'en': 'Milk', 'es': 'Leche', 'fr': 'Lait', 'de': 'Milch', 'ro': 'Lapte' } },
    
    'latte intero': { name: 'Latte Intero', category: 'Latticini', translations: { 'it': 'Latte Intero', 'en': 'Whole Milk', 'es': 'Leche Entera', 'fr': 'Lait Entier', 'de': 'Vollmilch', 'ro': 'Lapte Integral' } },
    'latte scremato': { name: 'Latte Scremato', category: 'Latticini', translations: { 'it': 'Latte Scremato', 'en': 'Skim Milk', 'es': 'Leche Desnatada', 'fr': 'Lait Ã‰crÃ©mÃ©', 'de': 'Magermilch', 'ro': 'Lapte Degresat' } },
    
    'yogurt': { name: 'Yogurt', category: 'Latticini', translations: { 'it': 'Yogurt', 'en': 'Yogurt', 'es': 'Yogur', 'fr': 'Yaourt', 'de': 'Joghurt', 'ro': 'Iaurt' } },
    'yaourt': { name: 'Yaourt', category: 'Produits laitiers', translations: { 'it': 'Yogurt', 'en': 'Yogurt', 'es': 'Yogur', 'fr': 'Yaourt', 'de': 'Joghurt', 'ro': 'Iaurt' } },
    'joghurt': { name: 'Joghurt', category: 'Molkereiprodukte', translations: { 'it': 'Yogurt', 'en': 'Yogurt', 'es': 'Yogur', 'fr': 'Yaourt', 'de': 'Joghurt', 'ro': 'Iaurt' } },
    'iaurt': { name: 'Iaurt', category: 'Lactate', translations: { 'it': 'Yogurt', 'en': 'Yogurt', 'es': 'Yogur', 'fr': 'Yaourt', 'de': 'Joghurt', 'ro': 'Iaurt' } },
    
    'formaggio': { name: 'Formaggio', category: 'Latticini', translations: { 'it': 'Formaggio', 'en': 'Cheese', 'es': 'Queso', 'fr': 'Fromage', 'de': 'KÃ¤se', 'ro': 'BrÃ¢nzÄƒ' } },
    'cheese': { name: 'Cheese', category: 'Dairy', translations: { 'it': 'Formaggio', 'en': 'Cheese', 'es': 'Queso', 'fr': 'Fromage', 'de': 'KÃ¤se', 'ro': 'BrÃ¢nzÄƒ' } },
    'queso': { name: 'Queso', category: 'LÃ¡cteos', translations: { 'it': 'Formaggio', 'en': 'Cheese', 'es': 'Queso', 'fr': 'Fromage', 'de': 'KÃ¤se', 'ro': 'BrÃ¢nzÄƒ' } },
    'fromage': { name: 'Fromage', category: 'Produits laitiers', translations: { 'it': 'Formaggio', 'en': 'Cheese', 'es': 'Queso', 'fr': 'Fromage', 'de': 'KÃ¤se', 'ro': 'BrÃ¢nzÄƒ' } },
    'kÃ¤se': { name: 'KÃ¤se', category: 'Molkereiprodukte', translations: { 'it': 'Formaggio', 'en': 'Cheese', 'es': 'Queso', 'fr': 'Fromage', 'de': 'KÃ¤se', 'ro': 'BrÃ¢nzÄƒ' } },
    'branza': { name: 'BrÃ¢nzÄƒ', category: 'Lactate', translations: { 'it': 'Formaggio', 'en': 'Cheese', 'es': 'Queso', 'fr': 'Fromage', 'de': 'KÃ¤se', 'ro': 'BrÃ¢nzÄƒ' } },
    
    'mozzarella': { name: 'Mozzarella', category: 'Latticini', translations: { 'it': 'Mozzarella', 'en': 'Mozzarella', 'es': 'Mozzarella', 'fr': 'Mozzarella', 'de': 'Mozzarella', 'ro': 'Mozzarella' } },
    'parmigiano': { name: 'Parmigiano', category: 'Latticini', translations: { 'it': 'Parmigiano', 'en': 'Parmesan', 'es': 'Parmesano', 'fr': 'Parmesan', 'de': 'Parmesan', 'ro': 'Parmezan' } },
    'parmesan': { name: 'Parmesan', category: 'Dairy', translations: { 'it': 'Parmigiano', 'en': 'Parmesan', 'es': 'Parmesano', 'fr': 'Parmesan', 'de': 'Parmesan', 'ro': 'Parmezan' } },
    
    'burro': { name: 'Burro', category: 'Latticini', translations: { 'it': 'Burro', 'en': 'Butter', 'es': 'Mantequilla', 'fr': 'Beurre', 'de': 'Butter', 'ro': 'Unt' } },
    'butter': { name: 'Butter', category: 'Dairy', translations: { 'it': 'Burro', 'en': 'Butter', 'es': 'Mantequilla', 'fr': 'Beurre', 'de': 'Butter', 'ro': 'Unt' } },
    'beurre': { name: 'Beurre', category: 'Produits laitiers', translations: { 'it': 'Burro', 'en': 'Butter', 'es': 'Mantequilla', 'fr': 'Beurre', 'de': 'Butter', 'ro': 'Unt' } },
    
    // UOVA
    'uova': { name: 'Uova', category: 'Uova', translations: { 'it': 'Uova', 'en': 'Eggs', 'es': 'Huevos', 'fr': 'Å’ufs', 'de': 'Eier', 'ro': 'OuÄƒ' } },
    'eggs': { name: 'Eggs', category: 'Eggs', translations: { 'it': 'Uova', 'en': 'Eggs', 'es': 'Huevos', 'fr': 'Å’ufs', 'de': 'Eier', 'ro': 'OuÄƒ' } },
    'huevos': { name: 'Huevos', category: 'Huevos', translations: { 'it': 'Uova', 'en': 'Eggs', 'es': 'Huevos', 'fr': 'Å’ufs', 'de': 'Eier', 'ro': 'OuÄƒ' } },
    'oeufs': { name: 'Å’ufs', category: 'Å’ufs', translations: { 'it': 'Uova', 'en': 'Eggs', 'es': 'Huevos', 'fr': 'Å’ufs', 'de': 'Eier', 'ro': 'OuÄƒ' } },
    'eier': { name: 'Eier', category: 'Eier', translations: { 'it': 'Uova', 'en': 'Eggs', 'es': 'Huevos', 'fr': 'Å’ufs', 'de': 'Eier', 'ro': 'OuÄƒ' } },
    'oua': { name: 'OuÄƒ', category: 'OuÄƒ', translations: { 'it': 'Uova', 'en': 'Eggs', 'es': 'Huevos', 'fr': 'Å’ufs', 'de': 'Eier', 'ro': 'OuÄƒ' } },
    
    'uova di gallina': { name: 'Uova di Gallina', category: 'Uova', translations: { 'it': 'Uova di Gallina', 'en': 'Hen Eggs', 'es': 'Huevos de Gallina', 'fr': 'Å’ufs de Poule', 'de': 'HÃ¼hnereier', 'ro': 'OuÄƒ de GÄƒinÄƒ' } },
    
    // PASTA E RISO
    'pasta': { name: 'Pasta', category: 'Pasta e Riso', translations: { 'it': 'Pasta', 'en': 'Pasta', 'es': 'Pasta', 'fr': 'PÃ¢tes', 'de': 'Nudeln', 'ro': 'PastÄƒ' } },
    'pates': { name: 'PÃ¢tes', category: 'PÃ¢tes et Riz', translations: { 'it': 'Pasta', 'en': 'Pasta', 'es': 'Pasta', 'fr': 'PÃ¢tes', 'de': 'Nudeln', 'ro': 'PastÄƒ' } },
    'nudeln': { name: 'Nudeln', category: 'Nudeln und Reis', translations: { 'it': 'Pasta', 'en': 'Pasta', 'es': 'Pasta', 'fr': 'PÃ¢tes', 'de': 'Nudeln', 'ro': 'PastÄƒ' } },
    
    'penne': { name: 'Penne', category: 'Pasta e Riso', translations: { 'it': 'Penne', 'en': 'Penne', 'es': 'Penne', 'fr': 'Pennes', 'de': 'Penne', 'ro': 'Penne' } },
    'spaghetti': { name: 'Spaghetti', category: 'Pasta e Riso', translations: { 'it': 'Spaghetti', 'en': 'Spaghetti', 'es': 'Espaguetis', 'fr': 'Spaghettis', 'de': 'Spaghetti', 'ro': 'Spaghete' } },
    'lasagne': { name: 'Lasagne', category: 'Pasta e Riso', translations: { 'it': 'Lasagne', 'en': 'Lasagna', 'es': 'LasaÃ±a', 'fr': 'Lasagnes', 'de': 'Lasagne', 'ro': 'Lasagna' } },
    
    'riso': { name: 'Riso', category: 'Pasta e Riso', translations: { 'it': 'Riso', 'en': 'Rice', 'es': 'Arroz', 'fr': 'Riz', 'de': 'Reis', 'ro': 'Orez' } },
    'rice': { name: 'Rice', category: 'Pasta and Rice', translations: { 'it': 'Riso', 'en': 'Rice', 'es': 'Arroz', 'fr': 'Riz', 'de': 'Reis', 'ro': 'Orez' } },
    'arroz': { name: 'Arroz', category: 'Pastas y Arroces', translations: { 'it': 'Riso', 'en': 'Rice', 'es': 'Arroz', 'fr': 'Riz', 'de': 'Reis', 'ro': 'Orez' } },
    'riz': { name: 'Riz', category: 'PÃ¢tes et Riz', translations: { 'it': 'Riso', 'en': 'Rice', 'es': 'Arroz', 'fr': 'Riz', 'de': 'Reis', 'ro': 'Orez' } },
    'reis': { name: 'Reis', category: 'Nudeln und Reis', translations: { 'it': 'Riso', 'en': 'Rice', 'es': 'Arroz', 'fr': 'Riz', 'de': 'Reis', 'ro': 'Orez' } },
    'orez': { name: 'Orez', category: 'PastÄƒ È™i Orez', translations: { 'it': 'Riso', 'en': 'Rice', 'es': 'Arroz', 'fr': 'Riz', 'de': 'Reis', 'ro': 'Orez' } },
    
    // CARNE
    'carne': { name: 'Carne', category: 'Carne', translations: { 'it': 'Carne', 'en': 'Meat', 'es': 'Carne', 'fr': 'Viande', 'de': 'Fleisch', 'ro': 'Carne' } },
    'meat': { name: 'Meat', category: 'Meat', translations: { 'it': 'Carne', 'en': 'Meat', 'es': 'Carne', 'fr': 'Viande', 'de': 'Fleisch', 'ro': 'Carne' } },
    'viande': { name: 'Viande', category: 'Viande', translations: { 'it': 'Carne', 'en': 'Meat', 'es': 'Carne', 'fr': 'Viande', 'de': 'Fleisch', 'ro': 'Carne' } },
    'fleisch': { name: 'Fleisch', category: 'Fleisch', translations: { 'it': 'Carne', 'en': 'Meat', 'es': 'Carne', 'fr': 'Viande', 'de': 'Fleisch', 'ro': 'Carne' } },
    
    'pollo': { name: 'Pollo', category: 'Carne', translations: { 'it': 'Pollo', 'en': 'Chicken', 'es': 'Pollo', 'fr': 'Poulet', 'de': 'HÃ¤hnchen', 'ro': 'Pui' } },
    'chicken': { name: 'Chicken', category: 'Meat', translations: { 'it': 'Pollo', 'en': 'Chicken', 'es': 'Pollo', 'fr': 'Poulet', 'de': 'HÃ¤hnchen', 'ro': 'Pui' } },
    'poulet': { name: 'Poulet', category: 'Viande', translations: { 'it': 'Pollo', 'en': 'Chicken', 'es': 'Pollo', 'fr': 'Poulet', 'de': 'HÃ¤hnchen', 'ro': 'Pui' } },
    'hÃ¤hnchen': { name: 'HÃ¤hnchen', category: 'Fleisch', translations: { 'it': 'Pollo', 'en': 'Chicken', 'es': 'Pollo', 'fr': 'Poulet', 'de': 'HÃ¤hnchen', 'ro': 'Pui' } },
    'pui': { name: 'Pui', category: 'Carne', translations: { 'it': 'Pollo', 'en': 'Chicken', 'es': 'Pollo', 'fr': 'Poulet', 'de': 'HÃ¤hnchen', 'ro': 'Pui' } },
    
    'manzo': { name: 'Manzo', category: 'Carne', translations: { 'it': 'Manzo', 'en': 'Beef', 'es': 'Ternera', 'fr': 'BÅ“uf', 'de': 'Rindfleisch', 'ro': 'VitÄƒ' } },
    'beef': { name: 'Beef', category: 'Meat', translations: { 'it': 'Manzo', 'en': 'Beef', 'es': 'Ternera', 'fr': 'BÅ“uf', 'de': 'Rindfleisch', 'ro': 'VitÄƒ' } },
    'boeuf': { name: 'BÅ“uf', category: 'Viande', translations: { 'it': 'Manzo', 'en': 'Beef', 'es': 'Ternera', 'fr': 'BÅ“uf', 'de': 'Rindfleisch', 'ro': 'VitÄƒ' } },
    
    'maiale': { name: 'Maiale', category: 'Carne', translations: { 'it': 'Maiale', 'en': 'Pork', 'es': 'Cerdo', 'fr': 'Porc', 'de': 'Schweinefleisch', 'ro': 'Porc' } },
    'pork': { name: 'Pork', category: 'Meat', translations: { 'it': 'Maiale', 'en': 'Pork', 'es': 'Cerdo', 'fr': 'Porc', 'de': 'Schweinefleisch', 'ro': 'Porc' } },
    
    // PESCE
    'pesce': { name: 'Pesce', category: 'Pesce', translations: { 'it': 'Pesce', 'en': 'Fish', 'es': 'Pescado', 'fr': 'Poisson', 'de': 'Fisch', 'ro': 'PeÈ™te' } },
    'fish': { name: 'Fish', category: 'Fish', translations: { 'it': 'Pesce', 'en': 'Fish', 'es': 'Pescado', 'fr': 'Poisson', 'de': 'Fisch', 'ro': 'PeÈ™te' } },
    'pescado': { name: 'Pescado', category: 'Pescado', translations: { 'it': 'Pesce', 'en': 'Fish', 'es': 'Pescado', 'fr': 'Poisson', 'de': 'Fisch', 'ro': 'PeÈ™te' } },
    'poisson': { name: 'Poisson', category: 'Poisson', translations: { 'it': 'Pesce', 'en': 'Fish', 'es': 'Pescado', 'fr': 'Poisson', 'de': 'Fisch', 'ro': 'PeÈ™te' } },
    'fisch': { name: 'Fisch', category: 'Fisch', translations: { 'it': 'Pesce', 'en': 'Fish', 'es': 'Pescado', 'fr': 'Poisson', 'de': 'Fisch', 'ro': 'PeÈ™te' } },
    'peste': { name: 'PeÈ™te', category: 'PeÈ™te', translations: { 'it': 'Pesce', 'en': 'Fish', 'es': 'Pescado', 'fr': 'Poisson', 'de': 'Fisch', 'ro': 'PeÈ™te' } },
    
    'salmone': { name: 'Salmone', category: 'Pesce', translations: { 'it': 'Salmone', 'en': 'Salmon', 'es': 'SalmÃ³n', 'fr': 'Saumon', 'de': 'Lachs', 'ro': 'Somon' } },
    'salmon': { name: 'Salmon', category: 'Fish', translations: { 'it': 'Salmone', 'en': 'Salmon', 'es': 'SalmÃ³n', 'fr': 'Saumon', 'de': 'Lachs', 'ro': 'Somon' } },
    'somon': { name: 'Somon', category: 'PeÈ™te', translations: { 'it': 'Salmone', 'en': 'Salmon', 'es': 'SalmÃ³n', 'fr': 'Saumon', 'de': 'Lachs', 'ro': 'Somon' } },
    
    'tonno': { name: 'Tonno', category: 'Pesce', translations: { 'it': 'Tonno', 'en': 'Tuna', 'es': 'AtÃºn', 'fr': 'Thon', 'de': 'Thunfisch', 'ro': 'Ton' } },
    'tuna': { name: 'Tuna', category: 'Fish', translations: { 'it': 'Tonno', 'en': 'Tuna', 'es': 'AtÃºn', 'fr': 'Thon', 'de': 'Thunfisch', 'ro': 'Ton' } },
    
    // FRUTTA E VERDURA
    'frutta': { name: 'Frutta', category: 'Frutta', translations: { 'it': 'Frutta', 'en': 'Fruit', 'es': 'Fruta', 'fr': 'Fruits', 'de': 'Obst', 'ro': 'Fructe' } },
    'fruit': { name: 'Fruit', category: 'Fruit', translations: { 'it': 'Frutta', 'en': 'Fruit', 'es': 'Fruta', 'fr': 'Fruits', 'de': 'Obst', 'ro': 'Fructe' } },
    'obst': { name: 'Obst', category: 'Obst', translations: { 'it': 'Frutta', 'en': 'Fruit', 'es': 'Fruta', 'fr': 'Fruits', 'de': 'Obst', 'ro': 'Fructe' } },
    
    'verdura': { name: 'Verdura', category: 'Verdura', translations: { 'it': 'Verdura', 'en': 'Vegetables', 'es': 'Verdura', 'fr': 'LÃ©gumes', 'de': 'GemÃ¼se', 'ro': 'Legume' } },
    'vegetables': { name: 'Vegetables', category: 'Vegetables', translations: { 'it': 'Verdura', 'en': 'Vegetables', 'es': 'Verdura', 'fr': 'LÃ©gumes', 'de': 'GemÃ¼se', 'ro': 'Legume' } },
    'legumes': { name: 'LÃ©gumes', category: 'LÃ©gumes', translations: { 'it': 'Verdura', 'en': 'Vegetables', 'es': 'Verdura', 'fr': 'LÃ©gumes', 'de': 'GemÃ¼se', 'ro': 'Legume' } },
    'gemÃ¼se': { name: 'GemÃ¼se', category: 'GemÃ¼se', translations: { 'it': 'Verdura', 'en': 'Vegetables', 'es': 'Verdura', 'fr': 'LÃ©gumes', 'de': 'GemÃ¼se', 'ro': 'Legume' } },
    
    'mele': { name: 'Mele', category: 'Frutta', translations: { 'it': 'Mele', 'en': 'Apples', 'es': 'Manzanas', 'fr': 'Pommes', 'de': 'Ã„pfel', 'ro': 'Mere' } },
    'apples': { name: 'Apples', category: 'Fruit', translations: { 'it': 'Mele', 'en': 'Apples', 'es': 'Manzanas', 'fr': 'Pommes', 'de': 'Ã„pfel', 'ro': 'Mere' } },
    'mere': { name: 'Mere', category: 'Fructe', translations: { 'it': 'Mele', 'en': 'Apples', 'es': 'Manzanas', 'fr': 'Pommes', 'de': 'Ã„pfel', 'ro': 'Mere' } },
    
    'banane': { name: 'Banane', category: 'Frutta', translations: { 'it': 'Banane', 'en': 'Bananas', 'es': 'PlÃ¡tanos', 'fr': 'Bananes', 'de': 'Bananen', 'ro': 'Banane' } },
    'bananas': { name: 'Bananas', category: 'Fruit', translations: { 'it': 'Banane', 'en': 'Bananas', 'es': 'PlÃ¡tanos', 'fr': 'Bananes', 'de': 'Bananen', 'ro': 'Banane' } },
    
    'arance': { name: 'Arance', category: 'Frutta', translations: { 'it': 'Arance', 'en': 'Oranges', 'es': 'Naranjas', 'fr': 'Oranges', 'de': 'Orangen', 'ro': 'Portocale' } },
    'oranges': { name: 'Oranges', category: 'Fruit', translations: { 'it': 'Arance', 'en': 'Oranges', 'es': 'Naranjas', 'fr': 'Oranges', 'de': 'Orangen', 'ro': 'Portocale' } },
    
    'limoni': { name: 'Limoni', category: 'Frutta', translations: { 'it': 'Limoni', 'en': 'Lemons', 'es': 'Limones', 'fr': 'Citrons', 'de': 'Zitronen', 'ro': 'LÄƒmÃ¢i' } },
    
    'patate': { name: 'Patate', category: 'Verdura', translations: { 'it': 'Patate', 'en': 'Potatoes', 'es': 'Patatas', 'fr': 'Pommes de terre', 'de': 'Kartoffeln', 'ro': 'Cartofi' } },
    'potatoes': { name: 'Potatoes', category: 'Vegetables', translations: { 'it': 'Patate', 'en': 'Potatoes', 'es': 'Patatas', 'fr': 'Pommes de terre', 'de': 'Kartoffeln', 'ro': 'Cartofi' } },
    'kartoffeln': { name: 'Kartoffeln', category: 'GemÃ¼se', translations: { 'it': 'Patate', 'en': 'Potatoes', 'es': 'Patatas', 'fr': 'Pommes de terre', 'de': 'Kartoffeln', 'ro': 'Cartofi' } },
    
    'pomodori': { name: 'Pomodori', category: 'Verdura', translations: { 'it': 'Pomodori', 'en': 'Tomatoes', 'es': 'Tomates', 'fr': 'Tomates', 'de': 'Tomaten', 'ro': 'RoÈ™ii' } },
    'tomatoes': { name: 'Tomatoes', category: 'Vegetables', translations: { 'it': 'Pomodori', 'en': 'Tomatoes', 'es': 'Tomates', 'fr': 'Tomates', 'de': 'Tomaten', 'ro': 'RoÈ™ii' } },
    'rosii': { name: 'RoÈ™ii', category: 'Legume', translations: { 'it': 'Pomodori', 'en': 'Tomatoes', 'es': 'Tomates', 'fr': 'Tomates', 'de': 'Tomaten', 'ro': 'RoÈ™ii' } },
    
    'cipolle': { name: 'Cipolle', category: 'Verdura', translations: { 'it': 'Cipolle', 'en': 'Onions', 'es': 'Cebollas', 'fr': 'Oignons', 'de': 'Zwiebeln', 'ro': 'CeapÄƒ' } },
    'onions': { name: 'Onions', category: 'Vegetables', translations: { 'it': 'Cipolle', 'en': 'Onions', 'es': 'Cebollas', 'fr': 'Oignons', 'de': 'Zwiebeln', 'ro': 'CeapÄƒ' } },
    
    'carote': { name: 'Carote', category: 'Verdura', translations: { 'it': 'Carote', 'en': 'Carrots', 'es': 'Zanahorias', 'fr': 'Carottes', 'de': 'Karotten', 'ro': 'Morcovi' } },
    'carrots': { name: 'Carrots', category: 'Vegetables', translations: { 'it': 'Carote', 'en': 'Carrots', 'es': 'Zanahorias', 'fr': 'Carottes', 'de': 'Karotten', 'ro': 'Morcovi' } },
    
    'insalata': { name: 'Insalata', category: 'Verdura', translations: { 'it': 'Insalata', 'en': 'Lettuce', 'es': 'Lechuga', 'fr': 'Salade', 'de': 'Salat', 'ro': 'SalatÄƒ' } },
    
    // BEVANDE
    'acqua': { name: 'Acqua', category: 'Bevande', translations: { 'it': 'Acqua', 'en': 'Water', 'es': 'Agua', 'fr': 'Eau', 'de': 'Wasser', 'ro': 'ApÄƒ' } },
    'water': { name: 'Water', category: 'Beverages', translations: { 'it': 'Acqua', 'en': 'Water', 'es': 'Agua', 'fr': 'Eau', 'de': 'Wasser', 'ro': 'ApÄƒ' } },
    'apa': { name: 'ApÄƒ', category: 'BÄƒuturi', translations: { 'it': 'Acqua', 'en': 'Water', 'es': 'Agua', 'fr': 'Eau', 'de': 'Wasser', 'ro': 'ApÄƒ' } },
    
    'caffÃ¨': { name: 'CaffÃ¨', category: 'Bevande', translations: { 'it': 'CaffÃ¨', 'en': 'Coffee', 'es': 'CafÃ©', 'fr': 'CafÃ©', 'de': 'Kaffee', 'ro': 'Cafea' } },
    'caffe': { name: 'CaffÃ¨', category: 'Bevande', translations: { 'it': 'CaffÃ¨', 'en': 'Coffee', 'es': 'CafÃ©', 'fr': 'CafÃ©', 'de': 'Kaffee', 'ro': 'Cafea' } },
    'coffee': { name: 'Coffee', category: 'Beverages', translations: { 'it': 'CaffÃ¨', 'en': 'Coffee', 'es': 'CafÃ©', 'fr': 'CafÃ©', 'de': 'Kaffee', 'ro': 'Cafea' } },
    'cafea': { name: 'Cafea', category: 'BÄƒuturi', translations: { 'it': 'CaffÃ¨', 'en': 'Coffee', 'es': 'CafÃ©', 'fr': 'CafÃ©', 'de': 'Kaffee', 'ro': 'Cafea' } },
    
    'vino': { name: 'Vino', category: 'Bevande', translations: { 'it': 'Vino', 'en': 'Wine', 'es': 'Vino', 'fr': 'Vin', 'de': 'Wein', 'ro': 'Vin' } },
    'wine': { name: 'Wine', category: 'Beverages', translations: { 'it': 'Vino', 'en': 'Wine', 'es': 'Vino', 'fr': 'Vin', 'de': 'Wein', 'ro': 'Vin' } },
    
    'birra': { name: 'Birra', category: 'Bevande', translations: { 'it': 'Birra', 'en': 'Beer', 'es': 'Cerveza', 'fr': 'BiÃ¨re', 'de': 'Bier', 'ro': 'Bere' } },
    'beer': { name: 'Beer', category: 'Beverages', translations: { 'it': 'Birra', 'en': 'Beer', 'es': 'Cerveza', 'fr': 'BiÃ¨re', 'de': 'Bier', 'ro': 'Bere' } },
    'bere': { name: 'Bere', category: 'BÄƒuturi', translations: { 'it': 'Birra', 'en': 'Beer', 'es': 'Cerveza', 'fr': 'BiÃ¨re', 'de': 'Bier', 'ro': 'Bere' } },
    
    'succo': { name: 'Succo', category: 'Bevande', translations: { 'it': 'Succo', 'en': 'Juice', 'es': 'Zumo', 'fr': 'Jus', 'de': 'Saft', 'ro': 'Suc' } },
    'juice': { name: 'Juice', category: 'Beverages', translations: { 'it': 'Succo', 'en': 'Juice', 'es': 'Zumo', 'fr': 'Jus', 'de': 'Saft', 'ro': 'Suc' } },
    
    // DOLCI
    'cioccolato': { name: 'Cioccolato', category: 'Dolci', translations: { 'it': 'Cioccolato', 'en': 'Chocolate', 'es': 'Chocolate', 'fr': 'Chocolat', 'de': 'Schokolade', 'ro': 'CiocolatÄƒ' } },
    'chocolate': { name: 'Chocolate', category: 'Sweets', translations: { 'it': 'Cioccolato', 'en': 'Chocolate', 'es': 'Chocolate', 'fr': 'Chocolat', 'de': 'Schokolade', 'ro': 'CiocolatÄƒ' } },
    
    'biscotti': { name: 'Biscotti', category: 'Dolci', translations: { 'it': 'Biscotti', 'en': 'Cookies', 'es': 'Galletas', 'fr': 'Biscuits', 'de': 'Kekse', 'ro': 'BiscuiÈ›i' } },
    'cookies': { name: 'Cookies', category: 'Sweets', translations: { 'it': 'Biscotti', 'en': 'Cookies', 'es': 'Galletas', 'fr': 'Biscuits', 'de': 'Kekse', 'ro': 'BiscuiÈ›i' } },
    
    'gelato': { name: 'Gelato', category: 'Dolci', translations: { 'it': 'Gelato', 'en': 'Ice Cream', 'es': 'Helado', 'fr': 'Glace', 'de': 'Eis', 'ro': 'ÃŽngheÈ›atÄƒ' } },
    'ice cream': { name: 'Ice Cream', category: 'Sweets', translations: { 'it': 'Gelato', 'en': 'Ice Cream', 'es': 'Helado', 'fr': 'Glace', 'de': 'Eis', 'ro': 'ÃŽngheÈ›atÄƒ' } },
    
    'marmellata': { name: 'Marmellata', category: 'Dolci', translations: { 'it': 'Marmellata', 'en': 'Jam', 'es': 'Mermelada', 'fr': 'Confiture', 'de': 'Marmelade', 'ro': 'Gem' } },
    'miele': { name: 'Miele', category: 'Dolci', translations: { 'it': 'Miele', 'en': 'Honey', 'es': 'Miel', 'fr': 'Miel', 'de': 'Honig', 'ro': 'Miere' } }
};

    // ==================== HELPER FUNCTIONS ====================
    function formatCurrency(amount) {
    // Gestisci valori null/undefined
    if (amount === null || amount === undefined || amount === '' || isNaN(amount)) {
        amount = 0;
    }
    
    const numAmount = parseFloat(amount);
    if (isNaN(numAmount)) {
        // Fallback sicuro
        return `${userProfile?.currencySymbol || 'â‚¬'}0,00`;
    }
    
    const fixedAmount = numAmount.toFixed(2);
    const parts = fixedAmount.toString().split('.');
    let integerPart = parts[0];
    const decimalPart = parts[1] || '00';
    
    // Usa oggetto sicuro
    const profile = userProfile || { language: 'it', currencySymbol: 'â‚¬' };
    let currencySymbol = profile.currencySymbol || 'â‚¬';
    
    // Se il simbolo non esiste, cerca nel dizionario corretto
    if (!currencySymbol && profile.currency) {
        const currencyInfo = currencies[profile.currency];
        currencySymbol = currencyInfo?.symbol || 'â‚¬';
    }
    
    // Formattazione
    if (profile.language === 'en' || profile.language === 'ro') {
        integerPart = integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        return `${currencySymbol}${integerPart}.${decimalPart}`;
    } else {
        integerPart = integerPart.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        return `${currencySymbol}${integerPart},${decimalPart}`;
    }
}
    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('it-IT', {
            day: '2-digit',
            month: '2-digit',
            year: 'numeric'
        });
    }
    function updateCurrencyLabel() {
    // Ottieni la valuta dal profilo utente
    const currency = userProfile?.currency || 'EUR';
    const code = currency;
    
    // Trova l'etichetta dell'importo nella schermata entrate
    const amountLabel = document.querySelector('[data-translate="amount-with-currency"]');
    if (amountLabel) {
        const lang = userProfile?.language || 'it';
        
        // Testo in base alla lingua
        if (lang === 'ro') {
            amountLabel.textContent = `SumÄƒ (${code}) *`;
        } else if (lang === 'en') {
            amountLabel.textContent = `Amount (${code}) *`;
        } else if (lang === 'es') {
            amountLabel.textContent = `Importe (${code}) *`;
        } else if (lang === 'fr') {
            amountLabel.textContent = `Montant (${code}) *`;
        } else if (lang === 'de') {
            amountLabel.textContent = `Betrag (${code}) *`;
        } else {
            // Italiano (default)
            amountLabel.textContent = `Importo (${code}) *`;
        }
    }
    
    // Fai lo stesso per la schermata uscite se necessario
    const expenseAmountLabel = document.querySelector('#expense-amount + label, label[for="expense-amount"]');
    if (expenseAmountLabel) {
        const lang = userProfile?.language || 'it';
        if (lang === 'ro') {
            expenseAmountLabel.textContent = `SumÄƒ (${code}) *`;
        } else if (lang === 'en') {
            expenseAmountLabel.textContent = `Amount (${code}) *`;
        } else {
            expenseAmountLabel.textContent = `Importo (${code}) *`;
        }
    }
}

    function showToast(message) {
        const toast = document.createElement('div');
        toast.className = 'fixed top-4 right-4 bg-gray-800 text-white px-4 py-3 rounded-lg shadow-lg z-50';
        toast.textContent = message;
        toast.style.animation = 'fadeIn 0.3s';
        
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.style.animation = 'fadeOut 0.3s';
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 300);
        }, 3000);
    }

    function levenshteinDistance(a, b) {
        const matrix = [];
        
        for (let i = 0; i <= b.length; i++) {
            matrix[i] = [i];
        }
        
        for (let j = 0; j <= a.length; j++) {
            matrix[0][j] = j;
        }
        
        for (let i = 1; i <= b.length; i++) {
            for (let j = 1; j <= a.length; j++) {
                if (b.charAt(i - 1) === a.charAt(j - 1)) {
                    matrix[i][j] = matrix[i - 1][j - 1];
                } else {
                    matrix[i][j] = Math.min(
                        matrix[i - 1][j - 1] + 1,
                        matrix[i][j - 1] + 1,
                        matrix[i - 1][j] + 1
                    );
                }
            }
        }
        
        return matrix[b.length][a.length];
    }

    function findSuggestions(input) {
    const inputLower = input.toLowerCase().trim();
    const suggestions = [];
    const lang = userProfile?.language || 'it';
    
    // Controllo esatto
    if (productDictionary[inputLower]) {
        const product = productDictionary[inputLower];
        return [{
            original: input,
            corrected: product.translations[lang] || product.name,
            confidence: 100,
            reason: 'Prodotto riconosciuto'
        }];
    }
    
    // Ricerca per similaritÃ 
    for (const [key, product] of Object.entries(productDictionary)) {
        const distance = levenshteinDistance(inputLower, key);
        const maxLength = Math.max(inputLower.length, key.length);
        const similarity = 100 - (distance / maxLength) * 100;
        
        if (similarity > 70) {
            suggestions.push({
                key: key,
                name: product.translations[lang] || product.name,
                category: product.category,
                distance: distance,
                similarity: similarity
            });
        }
    }
    
    suggestions.sort((a, b) => b.similarity - a.similarity);
    
    return suggestions.slice(0, 3).map(s => ({
        original: input,
        corrected: s.name,
        confidence: Math.round(s.similarity),
        reason: `Simile a "${s.key}" (${s.category})`
    }));
}

    function checkDuplicate(itemName) {
        const itemLower = itemName.toLowerCase().trim();
        return shoppingList.some(item => 
            item.name.toLowerCase() === itemLower && !item.checked
        );
    }

    function showProductSuggestionModal(input, suggestions, isDuplicate) {
    const lang = userProfile?.language || 'it';
    const t = getTranslations(lang);
    
    const modal = document.createElement('div');
    modal.id = 'product-suggestion-modal';
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
    modal.innerHTML = '';
    
    let modalContent = `
        <div class="bg-white rounded-xl shadow-lg max-w-md w-full">
            <div class="p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-exclamation-triangle ${isDuplicate ? 'text-yellow-500' : 'text-blue-500'} mr-2"></i>
                    ${isDuplicate ? t['duplicate-product'] : t['check-product']}
                </h3>
                
                <div class="mb-6">
                    <p class="text-gray-600 mb-2">${t['you-entered']}</p>
                    <div class="p-3 bg-gray-100 rounded-lg">
                        <p class="font-medium">"${input}"</p>
                    </div>
                </div>
    `;
    
    if (isDuplicate) {
        const existingItem = shoppingList.find(item => 
            item.name.toLowerCase() === input.toLowerCase().trim() && !item.checked
        );
        
        modalContent += `
            <div class="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                <div class="flex items-start">
                    <i class="fas fa-info-circle text-yellow-500 mt-1 mr-3"></i>
                    <div>
                        <p class="font-medium text-yellow-800">${t['already-in-list']}</p>
                        <p class="text-sm text-yellow-700 mt-1">
                            "${existingItem.name}" ${t['already-in-list']}
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="space-y-3">
                <button onclick="addDuplicateProduct('${input.replace(/'/g, "\\'")}')" 
                        class="w-full p-3 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 flex items-center justify-center gap-2">
                    <i class="fas fa-plus"></i> ${t['add-anyway']}
                </button>
                <button onclick="closeSuggestionModal()" 
                        class="w-full p-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300">
                    ${t['cancel']}
                </button>
            </div>
        `;
    } else if (suggestions.length > 0) {
        modalContent += `
            <div class="mb-6">
                <p class="text-gray-600 mb-3">${t['perhaps-you-meant']}</p>
                <div class="space-y-3">
        `;
        
        suggestions.forEach((suggestion, index) => {
            const confidenceColor = suggestion.confidence > 85 ? 'text-green-600' : 
                                   suggestion.confidence > 70 ? 'text-yellow-600' : 'text-blue-600';
            
            modalContent += `
                <button onclick="acceptSuggestion('${input.replace(/'/g, "\\'")}', '${suggestion.corrected.replace(/'/g, "\\'")}')" 
                        class="w-full p-4 border rounded-lg text-left hover:border-green-400 hover:bg-green-50 transition group">
                    <div class="flex justify-between items-center">
                        <div>
                            <p class="font-semibold text-gray-800">${suggestion.corrected}</p>
                            <p class="text-sm text-gray-500 mt-1">${suggestion.reason}</p>
                        </div>
                        <div class="text-right">
                            <span class="text-xs font-semibold ${confidenceColor}">${suggestion.confidence}%</span>
                            <i class="fas fa-chevron-right text-gray-400 group-hover:text-green-500 ml-2"></i>
                        </div>
                    </div>
                </button>
            `;
        });
        
        modalContent += `
                </div>
            </div>
            
            <div class="space-y-3">
                <button onclick="addAsIs('${input.replace(/'/g, "\\'")}')" 
                        class="w-full p-3 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 flex items-center justify-center gap-2">
                    <i class="fas fa-check"></i> ${t['use-as-is'].replace('{product}', input)}
                </button>
                <button onclick="closeSuggestionModal()" 
                        class="w-full p-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300">
                    ${t['cancel']}
                </button>
            </div>
        `;
    } else {
        modalContent += `
            <div class="mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                <div class="flex items-start">
                    <i class="fas fa-info-circle text-blue-500 mt-1 mr-3"></i>
                    <div>
                        <p class="font-medium text-blue-800">${t['product-not-recognized']}</p>
                        <p class="text-sm text-blue-700 mt-1">
                            ${t['not-in-database'].replace('{product}', input)}
                        </p>
                    </div>
                </div>
            </div>
            
            <div class="space-y-3">
                <button onclick="addAsIs('${input.replace(/'/g, "\\'")}')" 
                        class="w-full p-3 bg-green-500 text-white rounded-lg font-semibold hover:bg-green-600 flex items-center justify-center gap-2">
                    <i class="fas fa-plus"></i> ${t['add-product'].replace('{product}', input)}
                </button>
                <button onclick="closeSuggestionModal()" 
                        class="w-full p-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300">
                    ${t['edit']}
                </button>
            </div>
        `;
    }
    
    modalContent += `
                </div>
            </div>
        `;
    
    modal.innerHTML = modalContent;
    document.body.appendChild(modal);
}

// ðŸ”´ QUESTA DEVE ESSERE FUORI, NON DENTRO!
function closeSuggestionModal() {
    const modal = document.getElementById('product-suggestion-modal');
    if (modal) {
        document.body.removeChild(modal);
    }
}

    function addAsIs(productName) {
        closeSuggestionModal();
        
        const priceInfo = findBestPriceForItem(productName);
        
        shoppingList.push({
            id: Date.now(),
            name: productName,
            checked: false,
            bestPrice: priceInfo.bestPrice,
            bestStore: priceInfo.bestStore,
            prices: priceInfo.prices,
            recognized: priceInfo.recognized
        });
        
        document.getElementById('shopping-item').value = '';
        
        renderShoppingList();
        showToast(`ðŸ›’ ${productName} aggiunto - ${formatCurrency(priceInfo.bestPrice)} @ ${priceInfo.bestStore}`);
        
        // Aggiorna i prodotti nei negozi quando aggiungi un nuovo prodotto
        updateStoreProducts();
    }

    function addDuplicateProduct(productName) {
        closeSuggestionModal();
        addShoppingItemInternal(productName, true);
    }

    function addShoppingItemInternal(name, forceAdd = false) {
        const input = document.getElementById('shopping-item');
        const itemName = name || input.value.trim();
        
        if (!itemName) {
            showToast('âš ï¸ Inserisci un nome per l\'articolo');
            return;
        }
        
        if (!forceAdd && checkDuplicate(itemName)) {
            showProductSuggestionModal(itemName, [], true);
            return;
        }
        
        const suggestions = findSuggestions(itemName);
console.log('ðŸ” Suggerimenti per', itemName, ':', suggestions); // <-- AGGIUNGI

if (suggestions.length === 0) {
    console.log('âŒ Nessun suggerimento -> mostro modal prodotto non riconosciuto');
    showProductSuggestionModal(itemName, [], false);
    return;
}

if (suggestions[0].confidence < 95) {
    console.log('âš ï¸ Confidence bassa -> mostro modal con suggerimenti');
    showProductSuggestionModal(itemName, suggestions, false);
    return;
}
        
        const priceInfo = findBestPriceForItem(itemName);
        
        shoppingList.push({
            id: Date.now(),
            name: itemName,
            checked: false,
            bestPrice: priceInfo.bestPrice,
            bestStore: priceInfo.bestStore,
            prices: priceInfo.prices,
            recognized: priceInfo.recognized
        });
        
        input.value = '';
        renderShoppingList();
        showToast(`ðŸ›’ ${itemName} aggiunto - ${formatCurrency(priceInfo.bestPrice)} @ ${priceInfo.bestStore}`);
        
        // Aggiorna i prodotti nei negozi quando aggiungi un nuovo prodotto
        updateStoreProducts();
    }

    // ==================== SHOPPING PRICE FUNCTIONS ====================
    function findBestPriceForItem(itemName) {
        const itemLower = itemName.toLowerCase();
        let bestPrice = Infinity;
        let bestStore = null;
        let prices = [];

        const isRecognized = productDictionary[itemLower] || 
                            Object.keys(productDictionary).some(key => 
                                itemLower.includes(key) || key.includes(itemLower)
                            );

        if (!isRecognized) {
            bestPrice = 5.00;
            bestStore = stores[0].name;
            
            stores.forEach(store => {
                prices.push({
                    store: store.name,
                    price: bestPrice,
                    distance: store.distance,
                    rating: store.rating,
                    estimated: true
                });
            });
            
            return { bestPrice, bestStore, prices, recognized: false };
        }

        stores.forEach(store => {
            if (storePrices[store.name] && storePrices[store.name][itemLower]) {
                const price = storePrices[store.name][itemLower];
                prices.push({
                    store: store.name,
                    price: price,
                    distance: store.distance,
                    rating: store.rating,
                    estimated: false
                });
                
                if (price < bestPrice) {
                    bestPrice = price;
                    bestStore = store.name;
                }
            }
        });

        if (bestPrice === Infinity) {
            Object.keys(storePrices[stores[0].name]).forEach(productKey => {
                if (itemLower.includes(productKey) || productKey.includes(itemLower)) {
                    const price = storePrices[stores[0].name][productKey];
                    bestPrice = price;
                    bestStore = stores[0].name;
                    prices.push({
                        store: stores[0].name,
                        price: price,
                        distance: stores[0].distance,
                        rating: stores[0].rating,
                        estimated: true
                    });
                }
            });
        }

        if (bestPrice === Infinity) {
            bestPrice = 5.00;
            bestStore = 'Esselunga';
            prices.push({
                store: 'Esselunga',
                price: 5.00,
                distance: '1.2 km',
                rating: 4.2,
                estimated: true
            });
        }

        return { bestPrice, bestStore, prices, recognized: true };
    }

    function updateItemPrices() {
        shoppingList.forEach(item => {
            if (!item.checked) {
                const priceInfo = findBestPriceForItem(item.name);
                item.bestPrice = priceInfo.bestPrice;
                item.bestStore = priceInfo.bestStore;
                item.prices = priceInfo.prices;
                item.recognized = priceInfo.recognized;
            }
        });
        updateOptimizationPreview();
    }

    function updateOptimizationPreview() {
        const itemsToBuy = shoppingList.filter(item => !item.checked);
        
        if (itemsToBuy.length === 0) {
            document.getElementById('lowest-price-total').textContent = 'â‚¬0,00 / 0 negozi';
            document.getElementById('fewest-stores-count').textContent = 'â‚¬0,00 / 0 negozi';
            document.getElementById('balanced-optimization').textContent = 'â‚¬0,00 / 0 negozi';
            return;
        }

        const lowestPriceSolution = calculateLowestPriceSolution(itemsToBuy);
        document.getElementById('lowest-price-total').textContent = 
            `${formatCurrency(lowestPriceSolution.totalPrice)} / ${lowestPriceSolution.storeCount} negozi`;

        const fewestStoresSolution = calculateFewestStoresSolution(itemsToBuy);
        document.getElementById('fewest-stores-count').textContent = 
            `${formatCurrency(fewestStoresSolution.totalPrice)} / ${fewestStoresSolution.storeCount} negozi`;

        const balancedSolution = calculateBalancedSolution(itemsToBuy);
        document.getElementById('balanced-optimization').textContent = 
            `${formatCurrency(balancedSolution.totalPrice)} / ${balancedSolution.storeCount} negozi`;
    }

    function calculateLowestPriceSolution(items) {
        let totalPrice = 0;
        const storesUsed = new Set();
        
        items.forEach(item => {
            totalPrice += item.bestPrice;
            storesUsed.add(item.bestStore);
        });
        
        return {
            totalPrice: totalPrice,
            storeCount: storesUsed.size,
            stores: Array.from(storesUsed)
        };
    }

    function calculateFewestStoresSolution(items) {
        const storeProducts = {};
        const productStores = {};
        
        items.forEach(item => {
            productStores[item.name] = [];
            item.prices.forEach(price => {
                if (!storeProducts[price.store]) {
                    storeProducts[price.store] = [];
                }
                storeProducts[price.store].push({
                    name: item.name,
                    price: price.price
                });
                productStores[item.name].push(price.store);
            });
        });
        
        const selectedStores = [];
        const coveredProducts = new Set();
        let totalPrice = 0;
        
        while (coveredProducts.size < items.length && Object.keys(storeProducts).length > 0) {
            let bestStore = null;
            let bestCoverage = 0;
            let bestStorePrice = 0;
            
            Object.entries(storeProducts).forEach(([storeName, products]) => {
                const newProducts = products.filter(p => !coveredProducts.has(p.name));
                if (newProducts.length > bestCoverage) {
                    bestCoverage = newProducts.length;
                    bestStore = storeName;
                    bestStorePrice = products.reduce((sum, p) => sum + p.price, 0);
                }
            });
            
            if (bestStore) {
                selectedStores.push(bestStore);
                storeProducts[bestStore].forEach(product => {
                    if (!coveredProducts.has(product.name)) {
                        coveredProducts.add(product.name);
                        totalPrice += product.price;
                    }
                });
                delete storeProducts[bestStore];
            } else {
                break;
            }
        }
        
        return {
            totalPrice: totalPrice,
            storeCount: selectedStores.length,
            stores: selectedStores
        };
    }

    function calculateBalancedSolution(items) {
        if (items.length === 0) {
            return {
                totalPrice: 0,
                storeCount: 0,
                stores: []
            };
        }

        const allStores = new Set();
        items.forEach(item => {
            item.prices.forEach(price => {
                allStores.add(price.store);
            });
        });
        const storesArray = Array.from(allStores);
        
        let bestSolution = null;
        let bestScore = -Infinity;
        
        const maxStores = Math.min(3, storesArray.length);
        
        for (let numStores = 1; numStores <= maxStores; numStores++) {
            const combinations = getStoreCombinationsArray(storesArray, numStores);
            
            for (const storeCombo of combinations) {
                const solution = calculateSolutionForStores(storeCombo, items);
                
                const coverage = solution.items.length / items.length;
                const storePenalty = 1 / (storeCombo.length + 1);
                const priceScore = 100 / (solution.totalPrice + 1);
                
                const score = (coverage * 100) + (storePenalty * 50) + priceScore;
                
                if (score > bestScore) {
                    bestScore = score;
                    bestSolution = {
                        totalPrice: solution.totalPrice,
                        storeCount: storeCombo.length,
                        stores: storeCombo,
                        coverage: coverage
                    };
                }
            }
        }
        
        if (!bestSolution || bestSolution.coverage < 0.5) {
            const lowestPrice = calculateLowestPriceSolution(items);
            return lowestPrice;
        }
        
        return bestSolution;
    }

    // ==================== OPTIMIZATION ALGORITHMS ====================
    function optimizeLowestPrice() {
        const itemsToBuy = shoppingList.filter(item => !item.checked);
        
        if (itemsToBuy.length === 0) {
            showToast('âš ï¸ La lista della spesa Ã¨ vuota');
            return;
        }

        const solution = {
            name: 'Prezzo piÃ¹ basso',
            description: 'Ogni prodotto acquistato al prezzo minimo disponibile',
            totalPrice: 0,
            stores: new Set(),
            itemsByStore: {},
            items: []
        };

        itemsToBuy.forEach(item => {
            solution.totalPrice += item.bestPrice;
            solution.stores.add(item.bestStore);
            
            if (!solution.itemsByStore[item.bestStore]) {
                solution.itemsByStore[item.bestStore] = [];
            }
            solution.itemsByStore[item.bestStore].push({
                name: item.name,
                price: item.bestPrice
            });
            
            solution.items.push({
                name: item.name,
                store: item.bestStore,
                price: item.bestPrice
            });
        });

        solution.stores = Array.from(solution.stores);
        currentOptimization = solution;
        showOptimizationResults(solution);
    }

    function optimizeFewestStores() {
        const itemsToBuy = shoppingList.filter(item => !item.checked);
        
        if (itemsToBuy.length === 0) {
            showToast('âš ï¸ La lista della spesa Ã¨ vuota');
            return;
        }

        const storeProducts = {};
        
        itemsToBuy.forEach(item => {
            item.prices.forEach(price => {
                if (!storeProducts[price.store]) {
                    storeProducts[price.store] = [];
                }
                storeProducts[price.store].push({
                    name: item.name,
                    price: price.price,
                    itemId: item.id
                });
            });
        });

        const selectedStores = [];
        const coveredItems = new Set();
        let totalPrice = 0;

        while (coveredItems.size < itemsToBuy.length && Object.keys(storeProducts).length > 0) {
            let bestStore = null;
            let bestProducts = [];
            let bestStorePrice = 0;
            
            Object.entries(storeProducts).forEach(([storeName, products]) => {
                const newProducts = products.filter(p => !coveredItems.has(p.itemId));
                if (newProducts.length > bestProducts.length) {
                    bestStore = storeName;
                    bestProducts = newProducts;
                    bestStorePrice = products.reduce((sum, p) => sum + p.price, 0);
                }
            });
            
            if (bestStore && bestProducts.length > 0) {
                selectedStores.push({
                    name: bestStore,
                    products: bestProducts,
                    totalPrice: bestStorePrice
                });
                
                bestProducts.forEach(product => {
                    coveredItems.add(product.itemId);
                    totalPrice += product.price;
                });
                
                delete storeProducts[bestStore];
            } else {
                break;
            }
        }

        const solution = {
            name: 'Meno negozi possibili',
            description: `Completa la spesa in ${selectedStores.length} negozi`,
            totalPrice: totalPrice,
            stores: selectedStores.map(s => s.name),
            itemsByStore: {},
            items: []
        };

        selectedStores.forEach(store => {
            solution.itemsByStore[store.name] = store.products;
            store.products.forEach(product => {
                solution.items.push({
                    name: product.name,
                    store: store.name,
                    price: product.price
                });
            });
        });

        currentOptimization = solution;
        showOptimizationResults(solution);
    }

    function optimizeBalanced() {
        const itemsToBuy = shoppingList.filter(item => !item.checked);
        
        if (itemsToBuy.length === 0) {
            showToast('âš ï¸ La lista della spesa Ã¨ vuota');
            return;
        }

        const allPossibleSolutions = [];
        
        const productAvailability = {};
        itemsToBuy.forEach(item => {
            productAvailability[item.name] = new Set();
            item.prices.forEach(price => {
                productAvailability[item.name].add(price.store);
            });
        });
        
        const allStores = new Set();
        itemsToBuy.forEach(item => {
            item.prices.forEach(price => {
                allStores.add(price.store);
            });
        });
        const storesArray = Array.from(allStores);
        
        const maxStoresToTry = Math.min(4, storesArray.length);
        
        for (let numStores = 1; numStores <= maxStoresToTry; numStores++) {
            const combinations = getStoreCombinationsArray(storesArray, numStores);
            
            combinations.forEach(storeCombo => {
                let coversAll = true;
                for (const itemName in productAvailability) {
                    const storesWithProduct = productAvailability[itemName];
                    let productCovered = false;
                    
                    for (const store of storeCombo) {
                        if (storesWithProduct.has(store)) {
                            productCovered = true;
                            break;
                        }
                    }
                    
                    if (!productCovered) {
                        coversAll = false;
                        break;
                    }
                }
                
                if (coversAll) {
                    const solution = calculateSolutionForStores(storeCombo, itemsToBuy);
                    if (solution.items.length === itemsToBuy.length) {
                        allPossibleSolutions.push({
                            stores: storeCombo,
                            solution: solution
                        });
                    }
                }
            });
        }
        
        if (allPossibleSolutions.length > 0) {
            allPossibleSolutions.sort((a, b) => {
                if (a.stores.length !== b.stores.length) {
                    return a.stores.length - b.stores.length;
                }
                return a.solution.totalPrice - b.solution.totalPrice;
            });
            
            const bestSolution = allPossibleSolutions[0].solution;
            bestSolution.name = 'Ottimizzazione bilanciata';
            bestSolution.description = `Completa la spesa al miglior rapporto qualitÃ /prezzo`;
            bestSolution.stores = allPossibleSolutions[0].stores;
            
            currentOptimization = bestSolution;
            showOptimizationResults(bestSolution);
            return;
        }
        
        let bestCoverage = 0;
        let bestPartialSolution = null;
        let bestStores = [];
        
        for (let numStores = 1; numStores <= Math.min(3, storesArray.length); numStores++) {
            const combinations = getStoreCombinationsArray(storesArray, numStores);
            
            combinations.forEach(storeCombo => {
                const solution = calculateSolutionForStores(storeCombo, itemsToBuy);
                const coverage = solution.items.length;
                
                if (coverage > bestCoverage) {
                    bestCoverage = coverage;
                    bestPartialSolution = solution;
                    bestStores = storeCombo;
                } else if (coverage === bestCoverage && solution.totalPrice < bestPartialSolution.totalPrice) {
                    bestPartialSolution = solution;
                    bestStores = storeCombo;
                }
            });
        }
        
        if (bestPartialSolution) {
            bestPartialSolution.name = 'Ottimizzazione bilanciata';
            bestPartialSolution.description = `Copre ${bestCoverage} di ${itemsToBuy.length} prodotti`;
            bestPartialSolution.stores = bestStores;
            
            currentOptimization = bestPartialSolution;
            showOptimizationResults(bestPartialSolution);
            return;
        }
        
        showToast('âš ï¸ Usando strategia prezzo piÃ¹ basso come fallback');
        optimizeLowestPrice();
    }

    function getStoreCombinationsArray(arr, k) {
        const result = [];
        
        function backtrack(start, current) {
            if (current.length === k) {
                result.push([...current]);
                return;
            }
            
            for (let i = start; i < arr.length; i++) {
                current.push(arr[i]);
                backtrack(i + 1, current);
                current.pop();
            }
        }
        
        backtrack(0, []);
        return result;
    }

    function calculateSolutionForStores(storeCombo, items) {
        const solution = {
            totalPrice: 0,
            itemsByStore: {},
            items: []
        };
        
        storeCombo.forEach(store => {
            solution.itemsByStore[store] = [];
        });
        
        items.forEach(item => {
            let bestPrice = Infinity;
            let bestStore = null;
            
            item.prices.forEach(price => {
                if (storeCombo.includes(price.store) && price.price < bestPrice) {
                    bestPrice = price.price;
                    bestStore = price.store;
                }
            });
            
            if (bestStore && bestPrice < Infinity) {
                solution.totalPrice += bestPrice;
                solution.itemsByStore[bestStore].push({
                    name: item.name,
                    price: bestPrice
                });
                solution.items.push({
                    name: item.name,
                    store: bestStore,
                    price: bestPrice
                });
            }
        });
        
        return solution;
    }

    function showOptimizationResults(solution) {
        document.getElementById('optimization-title').textContent = solution.name;
        document.getElementById('opt-total-price').textContent = formatCurrency(solution.totalPrice);
        document.getElementById('opt-store-count').textContent = solution.stores.length;
        
        const detailsContainer = document.getElementById('optimization-details');
        detailsContainer.innerHTML = '';
        
        detailsContainer.innerHTML += `
            <div class="p-3 bg-white rounded-lg mb-3">
                <p class="text-sm text-gray-600">${solution.description}</p>
                <p class="text-xs text-gray-500 mt-1">
                    <i class="fas fa-info-circle mr-1"></i>
                    ${solution.items.length} prodotti coperti su ${shoppingList.filter(item => !item.checked).length}
                </p>
            </div>
        `;
        
        if (solution.stores && solution.stores.length > 0) {
            solution.stores.forEach(storeName => {
                const storeItems = [];
                let storeTotal = 0;
                
                if (solution.itemsByStore && solution.itemsByStore[storeName]) {
                    solution.itemsByStore[storeName].forEach(item => {
                        storeItems.push({
                            name: item.name,
                            price: item.price
                        });
                        storeTotal += item.price;
                    });
                } else {
                    solution.items.forEach(item => {
                        if (item.store === storeName) {
                            storeItems.push({
                                name: item.name,
                                price: item.price
                            });
                            storeTotal += item.price;
                        }
                    });
                }
                
                if (storeItems.length > 0) {
                    const storeHTML = `
                        <div class="p-3 bg-white rounded-lg border mb-3">
                            <div class="flex justify-between items-center mb-2">
                                <div class="flex items-center gap-2">
                                    <p class="font-semibold">${storeName}</p>
                                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                        ${storeItems.length} prodotti
                                    </span>
                                </div>
                                <p class="font-bold text-green-600">${formatCurrency(storeTotal)}</p>
                            </div>
                            <div class="space-y-2">
                                ${storeItems.map(item => `
                                    <div class="flex justify-between text-sm items-center">
                                        <span>${item.name}</span>
                                        <span class="text-gray-600">${formatCurrency(item.price)}</span>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="mt-2 pt-2 border-t text-xs text-gray-500">
                                Totale negozio: ${formatCurrency(storeTotal)}
                            </div>
                        </div>
                    `;
                    detailsContainer.innerHTML += storeHTML;
                }
            });
        } else if (solution.itemsByStore) {
            Object.keys(solution.itemsByStore).forEach(storeName => {
                const storeItems = solution.itemsByStore[storeName] || [];
                if (storeItems.length > 0) {
                    const storeTotal = storeItems.reduce((sum, item) => sum + item.price, 0);
                    
                    const storeHTML = `
                        <div class="p-3 bg-white rounded-lg border mb-3">
                            <div class="flex justify-between items-center mb-2">
                                <div class="flex items-center gap-2">
                                    <p class="font-semibold">${storeName}</p>
                                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">
                                        ${storeItems.length} prodotti
                                    </span>
                                </div>
                                <p class="font-bold text-green-600">${formatCurrency(storeTotal)}</p>
                            </div>
                            <div class="space-y-2">
                                ${storeItems.map(item => `
                                    <div class="flex justify-between text-sm items-center">
                                        <span>${item.name}</span>
                                        <span class="text-gray-600">${formatCurrency(item.price)}</span>
                                    </div>
                                `).join('')}
                            </div>
                            <div class="mt-2 pt-2 border-t text-xs text-gray-500">
                                Totale negozio: ${formatCurrency(storeTotal)}
                            </div>
                        </div>
                    `;
                    detailsContainer.innerHTML += storeHTML;
                }
            });
        }
        
        const allItemsInList = shoppingList.filter(item => !item.checked).map(item => item.name);
        const coveredItems = solution.items.map(item => item.name);
        const missingItems = allItemsInList.filter(item => !coveredItems.includes(item));
        
        if (missingItems.length > 0) {
            const missingHTML = `
                <div class="p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fas fa-exclamation-triangle text-yellow-500"></i>
                        <p class="font-semibold text-yellow-800">Attenzione: prodotti mancanti</p>
                    </div>
                    <p class="text-sm text-yellow-700">
                        ${missingItems.length} prodotti non sono coperti da questa soluzione:
                        <span class="font-medium">${missingItems.join(', ')}</span>
                    </p>
                    <p class="text-xs text-yellow-600 mt-1">
                        Questi prodotti non sono disponibili nei negozi selezionati
                    </p>
                </div>
            `;
            detailsContainer.innerHTML += missingHTML;
        }
        
        const summaryHTML = `
            <div class="grid grid-cols-2 gap-2 mt-4">
                <div class="p-2 bg-green-50 rounded text-center">
                    <p class="text-xs text-gray-600">Prezzo Totale</p>
                    <p class="font-bold text-green-600">${formatCurrency(solution.totalPrice)}</p>
                </div>
                <div class="p-2 bg-blue-50 rounded text-center">
                    <p class="text-xs text-gray-600">Negozi</p>
                    <p class="font-bold text-blue-600">${solution.stores.length}</p>
                </div>
            </div>
        `;
        detailsContainer.innerHTML += summaryHTML;
        
        document.getElementById('optimization-results').classList.remove('hidden');
    }

    function closeOptimizationResults() {
        document.getElementById('optimization-results').classList.add('hidden');
    }

    function applyOptimization() {
        if (!currentOptimization) return;
        
        currentOptimization.items.forEach(item => {
            transactions.push({
                id: Date.now(),
                amount: item.price,
                description: `Spesa: ${item.name} (${item.store})`,
                category: 'Alimentari',
                type: 'uscita',
                date: new Date().toISOString().split('T')[0]
            });
        });
        
        shoppingList.forEach(item => {
            if (!item.checked) {
                item.checked = true;
            }
        });
        
        showToast(`âœ… Spesa ottimizzata applicata! Totale: ${formatCurrency(currentOptimization.totalPrice)}`);
        renderShoppingList();
        updateDashboard();
        closeOptimizationResults();
    }

    // ==================== SCREEN MANAGEMENT ====================
    function showScreen(screenName) {
        document.querySelectorAll('.screen').forEach(screen => {
            screen.classList.remove('active');
        });
        
        document.getElementById(`screen-${screenName}`).classList.add('active');
        
        if (screenName === 'dashboard') {
            updateDashboard();
        } else if (screenName === 'shopping') {
            renderShoppingList();
            // Aggiorna automaticamente i prodotti nei negozi
            updateStoreProducts();
            // Piccolo ritardo per assicurarsi che tutto sia caricato
            setTimeout(() => {
                renderNearbyStores();
            }, 100);
        } else if (screenName === 'budget') {
            renderBudget();
        } else if (screenName === 'transactions') {
            renderAllTransactions();
        } else if (screenName === 'profile') {
            loadProfileToForm();
        }
    }

    function askExpenseType() {
        showScreen('expense-choice');
    }
// ==================== SCELTA TIPO TRANSAZIONE ====================
function askTransactionType() {
    // Crea un modal per scegliere il tipo di transazione
    const modal = document.createElement('div');
    modal.id = 'transaction-type-modal';
    modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
    modal.innerHTML = '';
    
    // Ottieni le traduzioni corrette in base alla lingua
    const lang = userProfile?.language || 'it';
    
    const translations = {
        'it': {
            'title': 'Aggiungi Transazione',
            'income': 'Entrata',
            'expense': 'Uscita',
            'income-desc': 'Stipendio, vendite, investimenti...',
            'expense-desc': 'Spese, acquisti, bollette...',
            'cancel': 'Annulla'
        },
        'en': {
            'title': 'Add Transaction',
            'income': 'Income',
            'expense': 'Expense',
            'income-desc': 'Salary, sales, investments...',
            'expense-desc': 'Expenses, purchases, bills...',
            'cancel': 'Cancel'
        },
        'es': {
            'title': 'AÃ±adir TransacciÃ³n',
            'income': 'Ingreso',
            'expense': 'Gasto',
            'income-desc': 'Salario, ventas, inversiones...',
            'expense-desc': 'Gastos, compras, facturas...',
            'cancel': 'Cancelar'
        },
        'fr': {
            'title': 'Ajouter Transaction',
            'income': 'Revenu',
            'expense': 'DÃ©pense',
            'income-desc': 'Salaire, ventes, investissements...',
            'expense-desc': 'DÃ©penses, achats, factures...',
            'cancel': 'Annuler'
        },
        'de': {
            'title': 'Transaktion HinzufÃ¼gen',
            'income': 'Einnahme',
            'expense': 'Ausgabe',
            'income-desc': 'Gehalt, VerkÃ¤ufe, Investitionen...',
            'expense-desc': 'Ausgaben, EinkÃ¤ufe, Rechnungen...',
            'cancel': 'Abbrechen'
        },
        'ro': {
            'title': 'AdÄƒugÄƒ TranzacÈ›ie',
            'income': 'Venit',
            'expense': 'CheltuialÄƒ',
            'income-desc': 'Salariu, vÃ¢nzÄƒri, investiÈ›ii...',
            'expense-desc': 'Cheltuieli, achiziÈ›ii, facturi...',
            'cancel': 'AnuleazÄƒ'
        }
    };
    
    const t = translations[lang] || translations['it'];
    
    const modalContent = `
        <div class="bg-white rounded-xl shadow-lg max-w-md w-full">
            <div class="p-6">
                <h3 class="text-xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-exchange-alt mr-2"></i>${t['title']}
                </h3>
                
                <div class="space-y-4 mb-6">
                    <button onclick="closeTransactionTypeModal(); showScreen('add-income')" 
                            class="w-full p-5 border-2 border-dashed border-green-300 rounded-xl text-left hover:border-green-500 hover:bg-green-50 transition group">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center group-hover:bg-green-200">
                                <i class="fas fa-money-bill-wave text-green-500 text-xl"></i>
                            </div>
                            <div>
                                <p class="font-bold text-gray-800">${t['income']}</p>
                                <p class="text-sm text-gray-500">${t['income-desc']}</p>
                            </div>
                            <div class="ml-auto">
                                <i class="fas fa-chevron-right text-gray-400 group-hover:text-green-500"></i>
                            </div>
                        </div>
                    </button>
                    
                    <button onclick="closeTransactionTypeModal(); showScreen('expense-choice')" 
                            class="w-full p-5 border-2 border-dashed border-red-300 rounded-xl text-left hover:border-red-500 hover:bg-red-50 transition group">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center group-hover:bg-red-200">
                                <i class="fas fa-shopping-cart text-red-500 text-xl"></i>
                            </div>
                            <div>
                                <p class="font-bold text-gray-800">${t['expense']}</p>
                                <p class="text-sm text-gray-500">${t['expense-desc']}</p>
                            </div>
                            <div class="ml-auto">
                                <i class="fas fa-chevron-right text-gray-400 group-hover:text-red-500"></i>
                            </div>
                        </div>
                    </button>
                </div>
                
                <button onclick="closeTransactionTypeModal()" 
                        class="w-full py-3 bg-gray-200 text-gray-700 rounded-lg font-semibold hover:bg-gray-300">
                    ${t['cancel']}
                </button>
            </div>
        </div>
    `;
    
    modal.innerHTML = modalContent;
    document.body.appendChild(modal);
}

// Funzione per chiudere il modal
function closeTransactionTypeModal() {
    const modal = document.getElementById('transaction-type-modal');
    if (modal) {
        document.body.removeChild(modal);
    }
}
    // ==================== DASHBOARD FUNCTIONS ====================
    function updateDashboard() {
        const totalIncome = transactions
            .filter(t => t.type === 'entrata')
            .reduce((sum, t) => sum + t.amount, 0);
        
        const totalExpenses = transactions
            .filter(t => t.type === 'uscita')
            .reduce((sum, t) => sum + t.amount, 0);
        
        const balance = totalIncome - totalExpenses;
        const totalBudget = Object.values(budget).reduce((a, b) => a + b, 0);
        
        document.getElementById('dashboard-income').textContent = formatCurrency(totalIncome);
        document.getElementById('dashboard-expenses').textContent = formatCurrency(totalExpenses);
        document.getElementById('dashboard-balance').textContent = formatCurrency(balance);
        document.getElementById('dashboard-budget').textContent = formatCurrency(totalBudget);
        
        const uncheckedItems = shoppingList.filter(item => !item.checked).length;
const shoppingCountEl = document.getElementById('shopping-count');
if (shoppingCountEl) {
    // Ottieni la parola corretta per "articoli" in base alla lingua
    const itemsText = userProfile?.language === 'en' ? 'items' :
                     userProfile?.language === 'es' ? 'artÃ­culos' :
                     userProfile?.language === 'fr' ? 'articles' :
                     userProfile?.language === 'de' ? 'Artikel' :
                     userProfile?.language === 'ro' ? 'articole' :
                     'articoli';
    shoppingCountEl.textContent = `${uncheckedItems} ${itemsText}`;
}
        
        const alertDiv = document.getElementById('budgetAlert');
        if (totalBudget > totalIncome) {
            alertDiv.classList.remove('hidden');
        } else {
            alertDiv.classList.add('hidden');
        }
        
        renderRecentTransactions();
    }

    function renderRecentTransactions() {
    const container = document.getElementById('recent-transactions');
    container.innerHTML = '';
    
    const recent = [...transactions]
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .slice(0, 3);
    
    if (recent.length === 0) {
        // Usa le traduzioni dal sistema di lingua
        const noTransactionsText = userProfile?.language === 'en' ? 'No transactions' :
                                 userProfile?.language === 'es' ? 'Sin transacciones' :
                                 userProfile?.language === 'fr' ? 'Aucune transaction' :
                                 userProfile?.language === 'de' ? 'Keine Transaktionen' :
                                 userProfile?.language === 'ro' ? 'FÄƒrÄƒ tranzacÈ›ii' :
                                 'Nessuna transazione';
        container.innerHTML = `<p class="text-gray-500 text-center py-2">${noTransactionsText}</p>`;
        return;
    }
    
    recent.forEach(trans => {
        const isIncome = trans.type === 'entrata';
        const transactionHTML = `
            <div class="flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 rounded-full ${isIncome ? 'bg-green-100' : 'bg-red-100'} flex items-center justify-center">
                        <i class="fas ${isIncome ? 'fa-arrow-down' : 'fa-arrow-up'} ${isIncome ? 'text-green-500' : 'text-red-500'}"></i>
                    </div>
                    <div>
                        <p class="font-medium">${trans.description}</p>
                        <p class="text-sm text-gray-500">${trans.category} â€¢ ${formatDate(trans.date)}</p>
                    </div>
                </div>
                <p class="font-bold ${isIncome ? 'text-green-600' : 'text-red-600'}">
                    ${isIncome ? '+' : '-'}${formatCurrency(trans.amount)}
                </p>
            </div>
        `;
        container.innerHTML += transactionHTML;
    });
}

    // ==================== INCOME FUNCTIONS ====================
    function addIncome() {
        const desc = document.getElementById('income-desc').value.trim();
        const amount = parseFloat(document.getElementById('income-amount').value);
        const category = document.getElementById('income-category').value;
        const date = document.getElementById('income-date').value;
        
        if (!desc || !amount || amount <= 0) {
            showToast('âš ï¸ Compila tutti i campi correttamente');
            return;
        }
        
        transactions.push({
            id: Date.now(),
            amount: amount,
            description: desc,
            category: category,
            type: 'entrata',
            date: date
        });
        
        document.getElementById('income-desc').value = '';
        document.getElementById('income-amount').value = '';
        
        showToast('ðŸ’° Entrata registrata con successo!');
        showScreen('dashboard');
    }

    // ==================== EXPENSE FUNCTIONS ====================
    function addExpense() {
        const desc = document.getElementById('expense-desc').value.trim();
        const amount = parseFloat(document.getElementById('expense-amount').value);
        const category = document.getElementById('expense-category').value;
        const date = document.getElementById('expense-date').value;
        const suggestedCategory = suggestCategory(desc);
        
        if (!desc || !amount || amount <= 0) {
            showToast('âš ï¸ Compila tutti i campi correttamente');
            return;
        }
        
        if (suggestedCategory !== 'Altro' && category !== suggestedCategory) {
            learnCategory(desc, category);
            showToast('âœ… Sistema imparato! Prossima volta suggerirÃ² "' + category + '"');
        }
        
        transactions.push({
            id: Date.now(),
            amount: amount,
            description: desc,
            category: category,
            type: 'uscita',
            date: date,
            suggestedCategory: suggestedCategory
        });
        
        document.getElementById('expense-desc').value = '';
        document.getElementById('expense-amount').value = '';
        document.getElementById('expense-category').value = 'Altro';
        document.getElementById('category-suggestion-hint').classList.add('hidden');
        
        showToast('ðŸ“¤ Uscita registrata con successo!');
        showScreen('dashboard');
    }

    // ==================== SHOPPING LIST FUNCTIONS ====================
    function renderShoppingList() {
    // ðŸ”¥ AGGIUNGI QUESTE 2 RIGHE ALL'INIZIO
    const lang = userProfile?.language || 'it';
    const t = getTranslations(lang);
        const container = document.getElementById('shopping-list-items');
        container.innerHTML = '';
        
        if (shoppingList.length === 0) {
            container.innerHTML = '<p class="text-gray-500 text-center py-4">La lista Ã¨ vuota</p>';
            return;
        }
        
        const uncheckedItems = shoppingList.filter(item => !item.checked);
        if (uncheckedItems.length === 0) {
            container.innerHTML = '<p class="text-gray-500 text-center py-4">Tutti gli articoli sono stati acquistati</p>';
            return;
        }
        
        uncheckedItems.forEach(item => {
            const priceInfo = item.bestPrice ? 
                `<span class="text-sm font-semibold text-green-600">${formatCurrency(item.bestPrice)}</span>
                 <span class="text-xs text-gray-500">@ ${item.bestStore}</span>` :
                `<span class="text-xs text-gray-400">Cerca prezzi...</span>`;
            
            const unrecognizedBadge = !item.recognized ? 
                `<span class="ml-2 text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded">Non riconosciuto</span>` : '';
            
            const itemHTML = `
                <div class="flex items-center justify-between p-3 border rounded-lg">
                    <div class="flex items-center gap-3">
                        <button onclick="toggleShoppingItem(${item.id})" 
                                class="w-8 h-8 rounded border-2 border-gray-300 flex items-center justify-center hover:border-green-500">
                            <i class="fas fa-shopping-cart text-gray-400"></i>
                        </button>
                        <div>
                            <div class="flex items-center">
                                <span class="font-medium">${item.name}</span>
                                ${unrecognizedBadge}
                            </div>
                            <div class="flex items-center gap-2 mt-1">
                                ${priceInfo}
                            </div>
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <button onclick="showPriceDetails(${item.id})" 
                                class="px-3 py-1 text-xs bg-blue-100 text-blue-600 rounded hover:bg-blue-200">
                                <i class="fas fa-chart-bar mr-1"></i>${t['price-button']}
                        </button>
                        <button onclick="removeShoppingItem(${item.id})" 
                                class="text-red-500 hover:text-red-700">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            container.innerHTML += itemHTML;
        });
        
        updateItemPrices();
    }

    function showPriceDetails(itemId) {
        const item = shoppingList.find(i => i.id === itemId);
        if (!item || item.prices.length === 0) {
            showToast('âš ï¸ Nessun prezzo disponibile per questo articolo');
            return;
        }
        
        let message = `Prezzi per ${item.name}:\n\n`;
        
        if (!item.recognized) {
            message += `âš ï¸ Prodotto non riconosciuto - Prezzi stimati\n\n`;
        }
        
        item.prices.forEach(price => {
            const estimatedTag = price.estimated ? ' (stimato)' : '';
            message += `â€¢ ${price.store}: ${formatCurrency(price.price)}${estimatedTag} (${price.distance})\n`;
        });
        
        if (item.bestPrice) {
            message += `\nMiglior prezzo: ${item.bestStore} - ${formatCurrency(item.bestPrice)}`;
            if (item.prices.some(p => p.estimated)) {
                message += `\n\nâš ï¸ Alcuni prezzi sono stimati in base a prodotti simili`;
            }
        }
        
        alert(message);
    }

    function addShoppingItem() {
        const input = document.getElementById('shopping-item');
        const itemName = input.value.trim();
        
        if (!itemName) {
            showToast('âš ï¸ Inserisci un nome per l\'articolo');
            return;
        }
        
        addShoppingItemInternal(itemName);
    }

    function toggleShoppingItem(id) {
        const item = shoppingList.find(i => i.id === id);
        if (item) {
            item.checked = !item.checked;
            
            if (item.checked && item.bestPrice) {
                transactions.push({
                    id: Date.now(),
                    amount: item.bestPrice,
                    description: `Spesa: ${item.name} (${item.bestStore})`,
                    category: 'Alimentari',
                    type: 'uscita',
                    date: new Date().toISOString().split('T')[0]
                });
                
                showToast(`ðŸ’° ${item.name} aggiunto alle transazioni - ${formatCurrency(item.bestPrice)}`);
                updateDashboard();
            }
            
            renderShoppingList();
        }
    }

    function removeShoppingItem(id) {
        shoppingList = shoppingList.filter(item => item.id !== id);
        renderShoppingList();
        showToast('ðŸ—‘ï¸ Articolo rimosso');
    }

    // ==================== BUDGET FUNCTIONS ====================
    function renderBudget() {
        const container = document.getElementById('budget-items');
        container.innerHTML = '';
        
        const expensesByCategory = {};
        transactions
            .filter(t => t.type === 'uscita')
            .forEach(t => {
                expensesByCategory[t.category] = (expensesByCategory[t.category] || 0) + t.amount;
            });
        
        Object.entries(budget).forEach(([category, budgetAmount]) => {
            const spent = expensesByCategory[category] || 0;
            const percentage = budgetAmount > 0 ? (spent / budgetAmount) * 100 : 0;
            
            const budgetHTML = `
                <div class="space-y-2">
                    <div class="flex justify-between items-center">
                        <span class="font-medium">${category}</span>
                        <div class="flex items-center gap-3">
                            <span class="text-sm text-gray-500">â‚¬</span>
                            <input type="number" value="${budgetAmount}" 
                                   onchange="updateBudget('${category}', this.value)"
                                   class="w-24 p-2 border rounded text-right">
                        </div>
                    </div>
                    
                    <div class="flex justify-between text-sm text-gray-500">
                        <span>Speso: ${formatCurrency(spent)}</span>
                        <span>${percentage.toFixed(1)}%</span>
                    </div>
                    
                    <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                        <div class="h-full ${percentage > 100 ? 'bg-red-500' : 'bg-green-500'} progress-bar"
                             style="width: ${Math.min(percentage, 100)}%">
                        </div>
                    </div>
                </div>
            `;
            container.innerHTML += budgetHTML;
        });
    }

    function updateBudget(category, value) {
        budget[category] = parseFloat(value) || 0;
        updateDashboard();
    }

    // ==================== PROFILE FUNCTIONS ====================
    function loadProfileToForm() {
        document.getElementById('profile-firstname').value = userProfile.firstName;
        document.getElementById('profile-lastname').value = userProfile.lastName;
        document.getElementById('profile-email').value = userProfile.email;
        
        document.getElementById('home-street').value = userProfile.homeStreet;
        document.getElementById('home-number').value = userProfile.homeNumber;
        document.getElementById('home-city').value = userProfile.homeCity;
        document.getElementById('home-province').value = userProfile.homeProvince;
        document.getElementById('home-country').value = userProfile.homeCountry || 'IT';
        
        document.getElementById('work-street').value = userProfile.workStreet;
        document.getElementById('work-number').value = userProfile.workNumber;
        document.getElementById('work-city').value = userProfile.workCity;
        document.getElementById('work-province').value = userProfile.workProvince;
        document.getElementById('work-country').value = userProfile.workCountry || '';
        document.getElementById('work-company').value = userProfile.workCompany;
        document.getElementById('profile-firstname').value = userProfile.firstName;
    document.getElementById('profile-lastname').value = userProfile.lastName;
    document.getElementById('profile-email').value = userProfile.email;
     // NUOVI CAMPI: Lingua e Valuta
     document.getElementById('profile-language').value = userProfile.language || 'it';
    document.getElementById('profile-currency').value = userProfile.currency || 'EUR';
      // Aggiorna anteprima valuta
      updateCurrencyPreview();
    }
    function updateCurrencyPreview() {
    const currencySelect = document.getElementById('profile-currency');
    const languageSelect = document.getElementById('profile-language');
    const previewDiv = document.getElementById('currency-preview');
    const previewAmount = document.getElementById('preview-amount');
    const previewInfo = document.getElementById('preview-info');
    
    if (!currencySelect || !languageSelect) return;
    
    const currencyCode = currencySelect.value;
    const languageCode = languageSelect.value;
    
    if (currencyCode && currencies[currencyCode]) {
        const currency = currencies[currencyCode];
        const lang = languages[languageCode] || languages['it'];
        
        // Simula formattazione
        let formattedAmount;
        if (languageCode === 'en' || languageCode === 'ro') {
            formattedAmount = `${currency.symbol}1,234.56`;
        } else {
            formattedAmount = `${currency.symbol}1.234,56`;
        }
        
        previewAmount.textContent = formattedAmount;
        previewInfo.textContent = `${currency.name} (${currencyCode}) - ${lang.name}`;
        previewDiv.classList.remove('hidden');
    }
}
function saveProfile() {
    console.log('ðŸ’¾ SALVATAGGIO PROFILO CON VALIDAZIONE COMPLETA');
    
    // Raccogli TUTTI i dati (compreso indirizzo completo!)
    const firstName = document.getElementById('profile-firstname').value.trim();
    const lastName = document.getElementById('profile-lastname').value.trim();
    const email = document.getElementById('profile-email').value.trim();
    
    // ðŸ”´ QUESTI MANCANO NEL TUO! AGGIUNGILI!
    const homeStreet = document.getElementById('home-street').value.trim();
    const homeNumber = document.getElementById('home-number').value.trim();
    const homeCity = document.getElementById('home-city').value.trim();
    const homeProvince = document.getElementById('home-province').value.trim();
    const homeCountry = document.getElementById('home-country').value;
    
    const language = document.getElementById('profile-language').value;
    const currency = document.getElementById('profile-currency').value;
    
    // VALIDAZIONE COMPLETA - tutti i campi obbligatori!
    const errors = [];
    if (!firstName) errors.push('Nome');
    if (!lastName) errors.push('Cognome');
    if (!email) errors.push('Email');
    if (!homeStreet) errors.push('Via');
    if (!homeNumber) errors.push('Numero');
    if (!homeCity) errors.push('CittÃ ');
    if (!homeProvince) errors.push('Provincia');
    if (!homeCountry) errors.push('Paese');
    
    if (errors.length > 0) {
        showToast(`âš ï¸ Campi obbligatori mancanti: ${errors.join(', ')}`);
        return;
    }
    
    if (!email.includes('@') || !email.includes('.')) {
        showToast('âš ï¸ Inserisci un\'email valida');
        return;
    }
    
    // ðŸ”´ AGGIORNA TUTTI I CAMPI, non solo alcuni!
    userProfile.firstName = firstName;
    userProfile.lastName = lastName;
    userProfile.email = email;
    
    // Indirizzo casa - COMPLETO!
    userProfile.homeStreet = homeStreet;
    userProfile.homeNumber = homeNumber;
    userProfile.homeCity = homeCity;
    userProfile.homeProvince = homeProvince;
    userProfile.homeCountry = homeCountry;
    userProfile.homeFullAddress = `${homeStreet} ${homeNumber}, ${homeCity} (${homeProvince})`;
    
    // Lingua e valuta
    userProfile.language = language;
    userProfile.currency = currency;
    userProfile.currencySymbol = currencies[currency]?.symbol || 'â‚¬';
    
    console.log('âœ… Profilo aggiornato:', {
        nome: firstName,
        cognome: lastName,
        indirizzo: userProfile.homeFullAddress,
        lingua: userProfile.language,
        valuta: userProfile.currency,
        simbolo: userProfile.currencySymbol
    });
    
    // SALVA in localStorage
    try {
        localStorage.setItem('smart_billing_profile_v2', JSON.stringify(userProfile));
        console.log('ðŸ’¾ Salvato in localStorage');
    } catch (e) {
        console.log('âš ï¸ localStorage fallito:', e);
        showToast('âš ï¸ Errore nel salvataggio');
        return;
    }
    
    // ðŸ”´ QUESTA Ãˆ LA RIGA FONDAMENTALE PER TRADURRE!
    applyLanguageSettings();
    updateCurrencyLabel();
    // ðŸ”¥ AGGIUNGI ANCHE QUESTE PER I MENU A TENDINA
    translateCategoryDropdowns();
    translateSelectPlaceholders();
    
    showScreen('dashboard');
    
    setTimeout(() => {
        updateDashboard();
        renderRecentTransactions();
        renderShoppingList();
        renderBudget();
        renderAllTransactions();
        
        const langName = languages[language]?.name || language;
        const currName = currencies[currency]?.name || currency;
        showToast(`âœ… Profilo salvato! Lingua: ${langName}, Valuta: ${currName}`);
    }, 100);
}
function checkProfile() {
    const saved = sessionStorage.getItem('smartBillingProfile');
    if (saved) {
        const profile = JSON.parse(saved);
        console.log('PROFILO SALVATO:', profile);
        console.log('Lingua:', profile.language);
        console.log('Valuta:', profile.currency);
        console.log('Simbolo:', profile.currencySymbol);
        return true;
    } else {
        console.log('Nessun profilo salvato');
        return false;
    }
}
    // ==================== TRANSACTIONS FUNCTIONS ====================
    function renderAllTransactions() {
        const container = document.getElementById('all-transactions');
        container.innerHTML = '';
        
        const sorted = [...transactions].sort((a, b) => new Date(b.date) - new Date(a.date));
        
        if (sorted.length === 0) {
            container.innerHTML = '<p class="text-gray-500 text-center py-4">Nessuna transazione registrata</p>';
            return;
        }
        
        sorted.forEach(trans => {
            const isIncome = trans.type === 'entrata';
            const transactionHTML = `
                <div class="flex items-center justify-between p-4 border rounded-lg">
                    <div>
                        <p class="font-semibold">${trans.description}</p>
                        <p class="text-sm text-gray-500">${trans.category} â€¢ ${formatDate(trans.date)}</p>
                    </div>
                    <p class="font-bold text-lg ${isIncome ? 'text-green-600' : 'text-red-600'}">
                        ${isIncome ? '+' : '-'}${formatCurrency(trans.amount)}
                    </p>
                </div>
            `;
            container.innerHTML += transactionHTML;
        });
    }

    // ==================== STORE FUNCTIONS - CORRETTE ====================
    function findNearbyStores() {
        if (!userProfile.homeFullAddress || !userProfile.homeStreet) {
            showToast('âš ï¸ Imposta prima il tuo indirizzo nel profilo');
            showScreen('profile');
            return;
        }
        
        showScreen('shopping');
        
        setTimeout(() => {
            renderNearbyStores();
        }, 100);
    }

    function renderNearbyStores() {
        const container = document.getElementById('nearby-stores');
        const searchBtn = document.getElementById('search-stores-btn');
        
        // Mostra loader durante la ricerca
        const originalBtnText = searchBtn.innerHTML;
        searchBtn.innerHTML = '<div class="store-loader"></div> Ricerca in corso...';
        searchBtn.disabled = true;
        
        // Simula un piccolo ritardo per la ricerca
        setTimeout(() => {
            container.innerHTML = '';
            
            if (!userProfile.homeFullAddress || !userProfile.homeStreet) {
                container.innerHTML = `
                    <div class="text-center py-6">
                        <i class="fas fa-map-marker-alt text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500 mb-2">Imposta il tuo indirizzo nel profilo</p>
                        <p class="text-sm text-gray-400 mb-4">Per trovare i negozi piÃ¹ vicini a te</p>
                        <button onclick="showScreen('profile')" 
                                class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                            <i class="fas fa-user-cog mr-2"></i>Vai al Profilo
                        </button>
                    </div>
                `;
                
                // Ripristina il pulsante
                searchBtn.innerHTML = originalBtnText;
                searchBtn.disabled = false;
                return;
            }
            
            // Aggiorna i prodotti nei negozi prima di mostrarli
            updateStoreProducts();
            
            // Add address info
            const addressHTML = `
    <div class="p-3 bg-blue-50 rounded-lg mb-4">
        <div class="flex justify-between items-start">
            <div>
                <p class="text-sm text-gray-600">Negozi vicini a:</p>
                <p class="font-semibold text-blue-800">${userProfile.homeFullAddress}</p>
            </div>
            <button onclick="showScreen('profile')" 
                    class="text-xs text-blue-500 hover:text-blue-700">
                <i class="fas fa-edit"></i>
            </button>
        </div>
    </div>
`;
            container.innerHTML = addressHTML;
            
            // Get current shopping items
            const uncheckedItems = shoppingList.filter(item => !item.checked);
            const groceryItems = uncheckedItems.map(item => item.name.toLowerCase());
            
            if (groceryItems.length === 0) {
                container.innerHTML += `
                    <div class="text-center py-6">
                        <i class="fas fa-shopping-basket text-4xl text-gray-300 mb-3"></i>
                        <p class="text-gray-500 mb-2">La tua lista della spesa Ã¨ vuota</p>
                        <p class="text-sm text-gray-400">Aggiungi prodotti per vedere i negozi che li hanno</p>
                    </div>
                `;
                
                // Ripristina il pulsante
                searchBtn.innerHTML = originalBtnText;
                searchBtn.disabled = false;
                return;
            }
            
            // Filtra negozi che hanno almeno un prodotto della lista
            const relevantStores = stores.filter(store => {
                return groceryItems.some(item => 
                    store.items.some(storeItem => {
                        // Controlla se il negozio ha il prodotto esatto o simile
                        return storeItem.toLowerCase() === item.toLowerCase() || 
                               item.toLowerCase().includes(storeItem.toLowerCase()) ||
                               storeItem.toLowerCase().includes(item.toLowerCase());
                    })
                );
            });
            
            const storesToShow = relevantStores.length > 0 ? relevantStores : stores.slice(0, 3);
            
            if (storesToShow.length === 0) {
                container.innerHTML += `
                    <div class="text-center py-4">
                        <i class="fas fa-store-slash text-2xl text-gray-300 mb-2"></i>
                        <p class="text-gray-500">Nessun negozio trovato nella tua zona</p>
                    </div>
                `;
                
                // Ripristina il pulsante
                searchBtn.innerHTML = originalBtnText;
                searchBtn.disabled = false;
                return;
            }
            
            storesToShow.forEach(store => {
                // Trova quali prodotti della lista sono disponibili in questo negozio
                const availableItems = [];
                let storeTotal = 0;
                
                uncheckedItems.forEach(item => {
                    const itemLower = item.name.toLowerCase();
                    
                    // Controlla se il negozio ha questo prodotto
                    const hasItem = store.items.some(storeItem => 
                        storeItem.toLowerCase() === itemLower || 
                        itemLower.includes(storeItem.toLowerCase()) ||
                        storeItem.toLowerCase().includes(itemLower)
                    );
                    
                    if (hasItem) {
                        // Trova il prezzo per questo prodotto in questo negozio
                        let itemPrice = null;
                        if (storePrices[store.name] && storePrices[store.name][itemLower]) {
                            itemPrice = storePrices[store.name][itemLower];
                        } else {
                            // Stima il prezzo basato su prodotti simili
                            itemPrice = estimatePriceForItem(itemLower, store.name);
                        }
                        
                        if (itemPrice) {
                            availableItems.push({
                                name: item.name,
                                price: itemPrice,
                                recognized: storePrices[store.name] && storePrices[store.name][itemLower] ? true : false
                            });
                            storeTotal += itemPrice;
                        }
                    }
                });
                
                const hasShoppingItems = availableItems.length > 0;
                
                const storeHTML = `
                    <div class="p-4 border rounded-lg mb-3 hover:shadow-md transition ${hasShoppingItems ? 'bg-green-50 border-green-200' : ''}">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <div class="flex items-center gap-2">
                                    <p class="font-bold text-gray-800">${store.name}</p>
                                    ${hasShoppingItems ? 
                                        `<span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">
                                            ${availableItems.length} dei tuoi prodotti
                                        </span>` : 
                                        ''}
                                    <span class="text-xs bg-gray-100 text-gray-800 px-2 py-1 rounded">
                                        ${store.type}
                                    </span>
                                </div>
                                <div class="flex items-center gap-3 mt-1">
                                    <span class="text-sm text-gray-600">
                                        <i class="fas fa-road mr-1"></i>${store.distance}
                                    </span>
                                    <span class="text-sm text-gray-600">
                                        <i class="fas fa-star text-yellow-500 mr-1"></i>${store.rating}
                                    </span>
                                </div>
                            </div>
                            <div class="text-right">
                                ${storeTotal > 0 ? 
                                    `<p class="font-bold text-green-600 text-lg">${formatCurrency(storeTotal)}</p>
                                     <p class="text-xs text-gray-500">prezzo stimato</p>` :
                                    `<p class="text-sm text-gray-500">Nessun prodotto</p>`
                                }
                            </div>
                        </div>
                        
                        ${hasShoppingItems && availableItems.length > 0 ? `
                            <div class="mt-2 pt-2 border-t border-green-200">
                                <p class="text-xs text-green-700 mb-1">
                                    <i class="fas fa-check-circle mr-1"></i>
                                    Trovi qui: ${availableItems.slice(0, 3).map(i => i.name).join(', ')}${availableItems.length > 3 ? '...' : ''}
                                </p>
                                <p class="text-xs text-gray-500 mt-1">
                                    Prezzo totale stimato: ${formatCurrency(storeTotal)} per ${availableItems.length} prodotti
                                </p>
                            </div>
                        ` : ''}
                        
                        ${!hasShoppingItems ? `
                            <div class="mt-2 pt-2 border-t border-gray-200">
                                <p class="text-xs text-gray-500">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    Questo negozio non ha i prodotti della tua lista
                                </p>
                            </div>
                        ` : ''}
                    </div>
                `;
                container.innerHTML += storeHTML;
            });
            
            // Add refresh button
            container.innerHTML += `
                <div class="mt-4 pt-4 border-t">
                    <div class="flex gap-2">
                        <button onclick="renderNearbyStores()" 
                                class="flex-1 py-2 border border-blue-300 text-blue-600 rounded-lg hover:bg-blue-50 flex items-center justify-center gap-2">
                            <i class="fas fa-sync-alt"></i> Aggiorna
                        </button>
                        <button onclick="showOptimizationTips()" 
                                class="flex-1 py-2 border border-purple-300 text-purple-600 rounded-lg hover:bg-purple-50 flex items-center justify-center gap-2">
                            <i class="fas fa-lightbulb"></i> Consigli
                        </button>
                    </div>
                </div>
            `;
            
            // Ripristina il pulsante
            searchBtn.innerHTML = originalBtnText;
            searchBtn.disabled = false;
            
            // Mostra statistiche
            showToast(`âœ… Trovati ${storesToShow.length} negozi vicini`);
        }, 800); // Simula un piccolo ritardo di ricerca
    }

    // Funzione per stimare il prezzo di un prodotto non nel database
    function estimatePriceForItem(itemName, storeName) {
        const itemLower = itemName.toLowerCase();
        
        // Prima cerca nel database dei prezzi
        if (storePrices[storeName] && storePrices[storeName][itemLower]) {
            return storePrices[storeName][itemLower];
        }
        
        // Se non trovato, cerca prodotti simili
        let estimatedPrice = 5.00; // Prezzo di default
        
        // Cerca per categorie simili
        if (itemLower.includes('pane') || itemLower.includes('biscotti') || itemLower.includes('crackers')) {
            estimatedPrice = storePrices[storeName]?.['pane'] || 2.00;
        } else if (itemLower.includes('latte') || itemLower.includes('yogurt') || itemLower.includes('formaggio')) {
            estimatedPrice = storePrices[storeName]?.['latte'] || 1.50;
        } else if (itemLower.includes('frutta') || itemLower.includes('verdura')) {
            estimatedPrice = storePrices[storeName]?.['frutta'] || 3.00;
        } else if (itemLower.includes('carne') || itemLower.includes('pollo') || itemLower.includes('pesce')) {
            estimatedPrice = storePrices[storeName]?.['carne'] || 10.00;
        } else if (itemLower.includes('acqua') || itemLower.includes('succo') || itemLower.includes('bevanda')) {
            estimatedPrice = storePrices[storeName]?.['acqua'] || 0.50;
        }
        
        return estimatedPrice;
    }

    // Mostra consigli di ottimizzazione
    function showOptimizationTips() {
        const uncheckedItems = shoppingList.filter(item => !item.checked);
        
        if (uncheckedItems.length === 0) {
            showToast('âš ï¸ La lista della spesa Ã¨ vuota');
            return;
        }
        
        let message = "ðŸ’¡ CONSIGLI PER LA SPESA:\n\n";
        
        // Suggerisci ottimizzazione in base al numero di prodotti
        if (uncheckedItems.length <= 3) {
            message += "â€¢ Hai pochi prodotti: acquista tutto nello stesso negozio\n";
            message += "â€¢ Scegli il negozio piÃ¹ vicino per risparmiare tempo\n";
        } else if (uncheckedItems.length <= 8) {
            message += "â€¢ Considera l'ottimizzazione 'Meno negozi'\n";
            message += "â€¢ Risparmierai tempo visitando meno punti vendita\n";
        } else {
            message += "â€¢ Usa l'ottimizzazione 'Bilanciata' per il miglior compromesso\n";
            message += "â€¢ O 'Prezzo piÃ¹ basso' per risparmiare di piÃ¹\n";
        }
        
        message += "\nðŸ“Š STATISTICHE:\n";
        message += `â€¢ Prodotti da acquistare: ${uncheckedItems.length}\n`;
        
        // Calcola il prezzo totale stimato
        const totalPrice = uncheckedItems.reduce((sum, item) => sum + (item.bestPrice || 0), 0);
        message += `â€¢ Prezzo totale stimato: ${formatCurrency(totalPrice)}\n`;
        
        // Trova il negozio con piÃ¹ prodotti
        const storeProductCount = {};
        uncheckedItems.forEach(item => {
            if (item.bestStore) {
                storeProductCount[item.bestStore] = (storeProductCount[item.bestStore] || 0) + 1;
            }
        });
        
        const bestStore = Object.entries(storeProductCount).sort((a, b) => b[1] - a[1])[0];
        if (bestStore) {
            message += `â€¢ Migliore negozio unico: ${bestStore[0]} (${bestStore[1]} prodotti)\n`;
        }
        
        alert(message);
    }
// Aggiungi queste funzioni prima di initApp()
function acceptSuggestion(original, corrected) {
    closeSuggestionModal();
    addShoppingItemInternal(corrected, true);
}

// ==================== FUNZIONI AGGIUNTE ====================

function addDuplicateProduct(productName) {
    closeSuggestionModal();
    
    // Forza l'aggiunta nonostante il duplicato
    const priceInfo = findBestPriceForItem(productName);
    
    shoppingList.push({
        id: Date.now(),
        name: productName,
        checked: false,
        bestPrice: priceInfo.bestPrice,
        bestStore: priceInfo.bestStore,
        prices: priceInfo.prices,
        recognized: priceInfo.recognized
    });
    
    document.getElementById('shopping-item').value = '';
    renderShoppingList();
    showToast(`ðŸ›’ ${productName} aggiunto (duplicato) - ${formatCurrency(priceInfo.bestPrice)}`);
}
      // ==================== APPLICA LINGUA ALL'INTERFACCIA ====================
      function applyLanguageSettings() {
    // Se userProfile non esiste, esci
    if (!userProfile) {
        console.log('âš ï¸ userProfile non definito');
        return;
        updateCurrencyLabel();
    }
    
    const lang = userProfile.language || 'it';
    console.log('ðŸŒ Applico lingua:', lang);
    
    // Traduzioni complete per tutte le lingue
    const translations = {
        'it': {
            // Dashboard
            'app-subtitle': 'Gestisci le tue finanze in modo intelligente',
            'incomes': 'Entrate',
            'income': 'Entrata',
            'expense': 'Uscita',
            'expenses': 'Uscite',
            'balance': 'Saldo',
            'budget': 'Budget',
            'add-income': 'Aggiungi entrata',
            'add-expense': 'Aggiungi spesa',
            'view-details': 'Vedi dettagli',
            'monthly-summary': 'Riepilogo mensile',
            'total-income': 'Entrate totali',
            'total-expenses': 'Uscite totali',
            'net-balance': 'Saldo netto',
            'recent-transactions': 'Ultime Transazioni',
            
            // ðŸ”¥ NUOVE TRADUZIONI AGGIUNTE ðŸ”¥
            'shopping': 'Lista Spesa',
            'stores': 'Negozi Vicini',
            'new-transaction': 'Aggiungi Transazione',
            'shopping-placeholder': 'Cosa devi comprare?',
            'items': 'articoli',
            'income-minus-expenses': 'Entrate - Uscite',
            'no-transactions': 'Nessuna transazione',
            'add-new-transaction': 'Aggiungi Nuova Transazione',
            'find-prices': 'Trova prezzi',
            // ðŸ”¥ FINE NUOVE TRADUZIONI ðŸ”¥
            
            // Nuove traduzioni per le schermate
            'new-income': 'Nuova Entrata',
            'register-income': 'Registra una nuova entrata',
            'description': 'Descrizione',
            'amount': 'Importo',
            'category': 'Categoria',
            'date': 'Data',
            'save-income': 'Salva Entrata',
            'cancel': 'Annulla',
            'back-to-dashboard': 'Torna alla Dashboard',
            'new-expense': 'Nuova Uscita',
            'register-expense': 'Registra una nuova spesa',
            'save-expense': 'Salva Uscita',
            'shopping-list': 'Lista della Spesa',
            'optimize-purchases': 'Ottimizza Acquisti',
            'lowest-price': 'Prezzo piÃ¹ basso',
            'min-total': 'Spesa minima totale',
            'fewest-stores': 'Meno negozi',
            'fewer-stores': 'Visita meno punti vendita',
            'optimized': 'Ottimizzato',
            'price-stores-balanced': 'Prezzo e negozi bilanciati',
            'optimization-result': 'Risultato Ottimizzazione',
            'total-price': 'Prezzo Totale',
            'stores': 'Negozi',
            'apply-solution': 'Applica questa soluzione',
            'nearby-stores': 'Negozi Vicini',
            'find-nearby-stores': 'Trova negozi vicini',
            'budget-management': 'Gestione Budget',
            'set-monthly-budgets': 'Imposta i budget mensili per categoria',
            'confirm-budget': 'Conferma Budget',
            'your-profile': 'Il Tuo Profilo',
            'configure-data': 'Configura i tuoi dati per un\'esperienza personalizzata',
            'personal-data': 'Dati Personali',
            'home-address': 'Indirizzo di Casa',
            'work-address': 'Indirizzo di Lavoro',
            'international-preferences': 'Preferenze Internazionali',
            'preferred-language': 'Lingua Preferita',
            'default-currency': 'Valuta Predefinita',
            'formatting-preview': 'Anteprima formattazione',
            'name': 'Nome',
            'surname': 'Cognome',
            'street': 'Via',
            'number': 'Numero',
            'city': 'CittÃ ',
            'province': 'Provincia',
            'country': 'Paese',
            'company': 'Nome Azienda',
            'all-transactions': 'Tutte le Transazioni',
            'description-placeholder-income': 'Stipendio, Bonus, Vendita...',
            'description-placeholder-expense': 'Cena, Benzina, Bolletta...',
            'shopping-item-placeholder': 'Cosa devi comprare?',
            'shopping-list': 'Lista della Spesa',
            'shopping-placeholder': 'Cosa devi comprare?',
            'optimize-purchases': 'Ottimizza Acquisti',
            'lowest-price': 'Prezzo piÃ¹ basso',
            'fewest-stores': 'Meno negozi',
            'optimized': 'Ottimizzato',
            'nearby-stores': 'Negozi Vicini',
            'find-nearby-stores': 'Cerca Negozi Vicini',
            'budget-management': 'Gestione Budget',
            'set-monthly-budgets': 'Imposta i budget mensili per categoria',
            'confirm-budget': 'Conferma Budget',
            'your-profile': 'Il Tuo Profilo',
            'configure-data': 'Configura i tuoi dati per un\'esperienza personalizzata',
            'all-transactions': 'Tutte le Transazioni',
            'new-income': 'Nuova Entrata',
            'register-income': 'Registra una nuova entrata',
            'new-expense': 'Nuova Uscita',
            'register-expense': 'Registra una nuova spesa',
            'save-income': 'Salva Entrata',
            'save-expense': 'Salva Uscita',
            'description-placeholder-income': 'Stipendio, Bonus, Vendita...',
            'description-placeholder-expense': 'Cena, Benzina, Bolletta...',
    
            // Sidebar/Navigation
            'dashboard': 'Dashboard',
            'transactions': 'Transazioni',
            'budgets': 'Budget',
            'categories': 'Categorie',
            'reports': 'Report',
            'settings': 'Impostazioni',
            'profile': 'Profilo',
            'logout': 'Esci',
            
            // Form comuni
            'save': 'Salva',
            'cancel': 'Annulla',
            'edit': 'Modifica',
            'delete': 'Elimina',
            'confirm': 'Conferma',
            'add': 'Aggiungi',
            'update': 'Aggiorna',
            'search': 'Cerca',
            'filter': 'Filtra',
            'reset': 'Reset',
            
            // Budget
            'create-budget': 'Crea budget',
            'budget-category': 'Categoria budget',
            'budget-amount': 'Importo budget',
            'current-spending': 'Spesa attuale',
            'remaining': 'Residuo',
            'budget-overview': 'Panoramica budget',
            'set-budget': 'Imposta budget',
            'budget-period': 'Periodo budget',
            
            // Transazioni
            'date': 'Data',
            'description': 'Descrizione',
            'amount': 'Importo',
            'category': 'Categoria',
            'type': 'Tipo',
            'income-type': 'Entrata',
            'expense-type': 'Spesa',
            'transaction-history': 'Cronologia transazioni',
            'payment-method': 'Metodo di pagamento',
            'recurring': 'Ricorrente',
            
            // ðŸ”¥ CATEGORIE USCITE (COMPLETO) ðŸ”¥
            'food': 'Cibo',
            'transport': 'Trasporti',
            'housing': 'Abitazione',
            'mortgage': 'Mutuo',                 // <-- AGGIUNTO
            'rent': 'Affitto',                    // <-- AGGIUNTO
            'utilities': 'UtilitÃ ',
            'electricity': 'Luce',                 // <-- AGGIUNTO
            'water': 'Acqua',                      // <-- AGGIUNTO
            'gas': 'Gas',                          // <-- AGGIUNTO
            'internet': 'Internet',                // <-- AGGIUNTO
            'phone': 'Telefono',                   // <-- AGGIUNTO
            'entertainment': 'Intrattenimento',
            'restaurant': 'Ristorante',            // <-- AGGIUNTO
            'cinema': 'Cinema',                    // <-- AGGIUNTO
            'travel': 'Viaggi',                    // <-- AGGIUNTO
            'health': 'Salute',
            'doctor': 'Medico',                    // <-- AGGIUNTO
            'pharmacy': 'Farmacia',                // <-- AGGIUNTO
            'gym': 'Palestra',                     // <-- AGGIUNTO
            'shopping-cat': 'Shopping',
            'clothing': 'Abbigliamento',           // <-- AGGIUNTO
            'electronics': 'Elettronica',          // <-- AGGIUNTO
            'education': 'Educazione',
            'books': 'Libri',                      // <-- AGGIUNTO
            'courses': 'Corsi',                    // <-- AGGIUNTO
            'insurance': 'Assicurazione',          // <-- AGGIUNTO
            'taxes': 'Tasse',                      // <-- AGGIUNTO
            'savings': 'Risparmi',                 // <-- AGGIUNTO
            'emergency': 'Fondo Emergenza',        // <-- AGGIUNTO
            'charity': 'Donazioni',                // <-- AGGIUNTO
            'other-expense': 'Altro',
            
            // Messaggi
            'no-data': 'Nessun dato disponibile',
            'loading': 'Caricamento...',
            'error': 'Errore',
            'success': 'Successo',
            'warning': 'Attenzione',
            'info': 'Informazioni',
            'confirm-delete': 'Sei sicuro di voler eliminare?',
            'saved-successfully': 'Salvato con successo',
            
            // Periodi
            'daily': 'Giornaliero',
            'weekly': 'Settimanale',
            'monthly': 'Mensile',
            'yearly': 'Annuale',
            
            // Impostazioni
            'language': 'Lingua',
            'currency': 'Valuta',
            'theme': 'Tema',
            'notifications': 'Notifiche',
            'export-data': 'Esporta dati',
            'import-data': 'Importa dati'
            
        },
        'en': {
            // Dashboard
            'app-subtitle': 'Manage your finances intelligently',
            'income': 'Income',
            'expense': 'Expense',
            'expenses': 'Expenses',
            'balance': 'Balance',
            'budget': 'Budget',
            'add-income': 'Add income',
            'add-expense': 'Add expense',
            'view-details': 'View details',
            'monthly-summary': 'Monthly summary',
            'total-income': 'Total income',
            'total-expenses': 'Total expenses',
            'net-balance': 'Net balance',
            'recent-transactions': 'Recent Transactions',
            
            // ðŸ”¥ NUOVE TRADUZIONI AGGIUNTE ðŸ”¥
            'shopping': 'Shopping List',
            'stores': 'Nearby Stores',
            'new-transaction': 'Add Transaction',
            'shopping-placeholder': 'What do you need to buy?',
            'items': 'items',
            'income-minus-expenses': 'Income - Expenses',
            'no-transactions': 'No transactions',
            'add-new-transaction': 'Add New Transaction',
            'find-prices': 'Find prices',
            // ðŸ”¥ FINE NUOVE TRADUZIONI ðŸ”¥
            
            // New translations for screens
            'new-income': 'New Income',
            'register-income': 'Register a new income',
            'description': 'Description',
            'amount': 'Amount',
            'category': 'Category',
            'date': 'Date',
            'save-income': 'Save Income',
            'cancel': 'Cancel',
            'back-to-dashboard': 'Back to Dashboard',
            'new-expense': 'New Expense',
            'register-expense': 'Register a new expense',
            'save-expense': 'Save Expense',
            'shopping-list': 'Shopping List',
            'optimize-purchases': 'Optimize Purchases',
            'lowest-price': 'Lowest price',
            'min-total': 'Minimum total expense',
            'fewest-stores': 'Fewest stores',
            'fewer-stores': 'Visit fewer stores',
            'optimized': 'Optimized',
            'price-stores-balanced': 'Price and stores balanced',
            'optimization-result': 'Optimization Result',
            'total-price': 'Total Price',
            'stores': 'Stores',
            'apply-solution': 'Apply this solution',
            'nearby-stores': 'Nearby Stores',
            'find-nearby-stores': 'Find nearby stores',
            'budget-management': 'Budget Management',
            'set-monthly-budgets': 'Set monthly budgets by category',
            'confirm-budget': 'Confirm Budget',
            'your-profile': 'Your Profile',
            'configure-data': 'Configure your data for a personalized experience',
            'personal-data': 'Personal Data',
            'home-address': 'Home Address',
            'work-address': 'Work Address',
            'international-preferences': 'International Preferences',
            'preferred-language': 'Preferred Language',
            'default-currency': 'Default Currency',
            'formatting-preview': 'Formatting preview',
            'name': 'Name',
            'surname': 'Surname',
            'street': 'Street',
            'number': 'Number',
            'city': 'City',
            'province': 'Province',
            'country': 'Country',
            'company': 'Company Name',
            'all-transactions': 'All Transactions',
            'description-placeholder-income': 'Salary, Bonus, Sale...',
            'description-placeholder-expense': 'Dinner, Gas, Bill...',
            'shopping-item-placeholder': 'What do you need to buy?',
            'shopping-list': 'Shopping List',
            'shopping-placeholder': 'What do you need to buy?',
            'optimize-purchases': 'Optimize Purchases',
            'lowest-price': 'Lowest price',
            'fewest-stores': 'Fewest stores',
            'optimized': 'Optimized',
            'nearby-stores': 'Nearby Stores',
            'find-nearby-stores': 'Find Nearby Stores',
            'budget-management': 'Budget Management',
            'set-monthly-budgets': 'Set monthly budgets by category',
            'confirm-budget': 'Confirm Budget',
            'your-profile': 'Your Profile',
            'configure-data': 'Configure your data for a personalized experience',
            'all-transactions': 'All Transactions',
            'new-income': 'New Income',
            'register-income': 'Register a new income',
            'new-expense': 'New Expense',
            'register-expense': 'Register a new expense',
            'save-income': 'Save Income',
            'save-expense': 'Save Expense',
            'description-placeholder-income': 'Salary, Bonus, Sale...',
            'description-placeholder-expense': 'Dinner, Gas, Bill...',

            // Sidebar/Navigation
            'dashboard': 'Dashboard',
            'transactions': 'Transactions',
            'budgets': 'Budgets',
            'categories': 'Categories',
            'reports': 'Reports',
            'settings': 'Settings',
            'profile': 'Profile',
            'logout': 'Logout',
            
            // Form comuni
            'save': 'Save',
            'cancel': 'Cancel',
            'edit': 'Edit',
            'delete': 'Delete',
            'confirm': 'Confirm',
            'add': 'Add',
            'update': 'Update',
            'search': 'Search',
            'filter': 'Filter',
            'reset': 'Reset',
            
            // Budget
            'create-budget': 'Create budget',
            'budget-category': 'Budget category',
            'budget-amount': 'Budget amount',
            'current-spending': 'Current spending',
            'remaining': 'Remaining',
            'budget-overview': 'Budget overview',
            'set-budget': 'Set budget',
            'budget-period': 'Budget period',
            
            // Transazioni
            'date': 'Date',
            'description': 'Description',
            'amount': 'Amount',
            'category': 'Category',
            'type': 'Type',
            'income-type': 'Income',
            'expense-type': 'Expense',
            'transaction-history': 'Transaction history',
            'payment-method': 'Payment method',
            'recurring': 'Recurring',
            
            // ðŸ”¥ EXPENSE CATEGORIES (COMPLETE) ðŸ”¥
            'food': 'Food',
            'transport': 'Transport',
            'housing': 'Housing',
            'mortgage': 'Mortgage',               // <-- ADDED
            'rent': 'Rent',                        // <-- ADDED
            'utilities': 'Utilities',
            'electricity': 'Electricity',          // <-- ADDED
            'water': 'Water',                      // <-- ADDED
            'gas': 'Gas',                          // <-- ADDED
            'internet': 'Internet',                // <-- ADDED
            'phone': 'Phone',                      // <-- ADDED
            'entertainment': 'Entertainment',
            'restaurant': 'Restaurant',            // <-- ADDED
            'cinema': 'Cinema',                    // <-- ADDED
            'travel': 'Travel',                    // <-- ADDED
            'health': 'Health',
            'doctor': 'Doctor',                    // <-- ADDED
            'pharmacy': 'Pharmacy',                // <-- ADDED
            'gym': 'Gym',                          // <-- ADDED
            'shopping-cat': 'Shopping',
            'clothing': 'Clothing',                // <-- ADDED
            'electronics': 'Electronics',          // <-- ADDED
            'education': 'Education',
            'books': 'Books',                      // <-- ADDED
            'courses': 'Courses',                  // <-- ADDED
            'insurance': 'Insurance',              // <-- ADDED
            'taxes': 'Taxes',                      // <-- ADDED
            'savings': 'Savings',                  // <-- ADDED
            'emergency': 'Emergency Fund',         // <-- ADDED
            'charity': 'Charity',                  // <-- ADDED
            'other-expense': 'Other',
            
            // Messaggi
            'no-data': 'No data available',
            'loading': 'Loading...',
            'error': 'Error',
            'success': 'Success',
            'warning': 'Warning',
            'info': 'Information',
            'confirm-delete': 'Are you sure you want to delete?',
            'saved-successfully': 'Saved successfully',
            
            // Periodi
            'daily': 'Daily',
            'weekly': 'Weekly',
            'monthly': 'Monthly',
            'yearly': 'Yearly',
            
            // Impostazioni
            'language': 'Language',
            'currency': 'Currency',
            'theme': 'Theme',
            'notifications': 'Notifications',
            'export-data': 'Export data',
            'import-data': 'Import data'
        },
        'es': {
            // Dashboard
            'app-subtitle': 'Gestiona tus finanzas de manera inteligente',
            'incomes': 'Ingresos',
            'income': 'Ingreso',
            'expense': 'Gasto',
            'expenses': 'Gastos',
            'balance': 'Saldo',
            'budget': 'Presupuesto',
            'add-income': 'AÃ±adir ingreso',
            'add-expense': 'AÃ±adir gasto',
            'view-details': 'Ver detalles',
            'monthly-summary': 'Resumen mensual',
            'total-income': 'Ingresos totales',
            'total-expenses': 'Gastos totales',
            'net-balance': 'Saldo neto',
            'recent-transactions': 'Transacciones Recientes',
            
            // ðŸ”¥ NUOVE TRADUZIONI AGGIUNTE ðŸ”¥
            'shopping': 'Lista de Compras',
            'stores': 'Tiendas Cercanas',
            'new-transaction': 'AÃ±adir TransacciÃ³n',
            'shopping-placeholder': 'Â¿QuÃ© necesitas comprar?',
            'items': 'artÃ­culos',
            'income-minus-expenses': 'Ingresos - Gastos',
            'no-transactions': 'Sin transacciones',
            'add-new-transaction': 'AÃ±adir Nueva TransacciÃ³n',
            'find-prices': 'Encontrar precios',
            // ðŸ”¥ FINE NUOVE TRADUZIONI ðŸ”¥
            
            // New translations for screens
            'new-income': 'Nuevo Ingreso',
            'register-income': 'Registra un nuevo ingreso',
            'description': 'DescripciÃ³n',
            'amount': 'Cantidad',
            'category': 'CategorÃ­a',
            'date': 'Fecha',
            'save-income': 'Guardar Ingreso',
            'cancel': 'Cancelar',
            'back-to-dashboard': 'Volver al Panel',
            'new-expense': 'Nuevo Gasto',
            'register-expense': 'Registra un nuevo gasto',
            'save-expense': 'Guardar Gasto',
            'shopping-list': 'Lista de Compras',
            'optimize-purchases': 'Optimizar Compras',
            'lowest-price': 'Precio mÃ¡s bajo',
            'min-total': 'Gasto mÃ­nimo total',
            'fewest-stores': 'Menos tiendas',
            'fewer-stores': 'Visita menos tiendas',
            'optimized': 'Optimizado',
            'price-stores-balanced': 'Precio y tiendas equilibrados',
            'optimization-result': 'Resultado de OptimizaciÃ³n',
            'total-price': 'Precio Total',
            'stores': 'Tiendas',
            'apply-solution': 'Aplicar esta soluciÃ³n',
            'nearby-stores': 'Tiendas Cercanas',
            'find-nearby-stores': 'Encontrar tiendas cercanas',
            'budget-management': 'GestiÃ³n de Presupuesto',
            'set-monthly-budgets': 'Establece presupuestos mensuales por categorÃ­a',
            'confirm-budget': 'Confirmar Presupuesto',
            'your-profile': 'Tu Perfil',
            'configure-data': 'Configura tus datos para una experiencia personalizada',
            'personal-data': 'Datos Personales',
            'home-address': 'DirecciÃ³n de Casa',
            'work-address': 'DirecciÃ³n de Trabajo',
            'international-preferences': 'Preferencias Internacionales',
            'preferred-language': 'Idioma Preferido',
            'default-currency': 'Moneda Predeterminada',
            'formatting-preview': 'Vista previa de formato',
            'name': 'Nombre',
            'surname': 'Apellido',
            'street': 'Calle',
            'number': 'NÃºmero',
            'city': 'Ciudad',
            'province': 'Provincia',
            'country': 'PaÃ­s',
            'company': 'Nombre de la Empresa',
            'all-transactions': 'Todas las Transacciones',
            'description-placeholder-income': 'Salario, Bono, Venta...',
            'description-placeholder-expense': 'Cena, Gasolina, Factura...',
            'shopping-item-placeholder': 'Â¿QuÃ© necesitas comprar?',
            'description-placeholder-income': 'Salario, Bono, Venta...',
            'description-placeholder-expense': 'Cena, Gasolina, Factura...',
            'shopping-item-placeholder': 'Â¿QuÃ© necesitas comprar?',
            'shopping-list': 'Lista de Compras',
            'shopping-placeholder': 'Â¿QuÃ© necesitas comprar?',
            'optimize-purchases': 'Optimizar Compras',
            'lowest-price': 'Precio mÃ¡s bajo',
            'fewest-stores': 'Menos tiendas',
            'optimized': 'Optimizado',
            'nearby-stores': 'Tiendas Cercanas',
            'find-nearby-stores': 'Buscar Tiendas Cercanas',
            'budget-management': 'GestiÃ³n de Presupuesto',
            'set-monthly-budgets': 'Establece presupuestos mensuales por categorÃ­a',
            'confirm-budget': 'Confirmar Presupuesto',
            'your-profile': 'Tu Perfil',
            'configure-data': 'Configura tus datos para una experiencia personalizada',
            'all-transactions': 'Todas las Transacciones',
            'new-income': 'Nuevo Ingreso',
            'register-income': 'Registra un nuevo ingreso',
            'new-expense': 'Nuevo Gasto',
            'register-expense': 'Registra un nuevo gasto',
            'save-income': 'Guardar Ingreso',
            'save-expense': 'Guardar Gasto',
            'description-placeholder-income': 'Salario, Bono, Venta...',
            'description-placeholder-expense': 'Cena, Gasolina, Factura...',

            // Sidebar/Navigation
            'dashboard': 'Panel',
            'transactions': 'Transacciones',
            'budgets': 'Presupuestos',
            'categories': 'CategorÃ­as',
            'reports': 'Informes',
            'settings': 'Ajustes',
            'profile': 'Perfil',
            'logout': 'Cerrar sesiÃ³n',
            
            // Form comuni
            'save': 'Guardar',
            'cancel': 'Cancelar',
            'edit': 'Editar',
            'delete': 'Eliminar',
            'confirm': 'Confirmar',
            'add': 'AÃ±adir',
            'update': 'Actualizar',
            'search': 'Buscar',
            'filter': 'Filtrar',
            'reset': 'Reiniciar',
            
            // Budget
            'create-budget': 'Crear presupuesto',
            'budget-category': 'CategorÃ­a de presupuesto',
            'budget-amount': 'Cantidad del presupuesto',
            'current-spending': 'Gasto actual',
            'remaining': 'Restante',
            'budget-overview': 'Resumen del presupuesto',
            'set-budget': 'Establecer presupuesto',
            'budget-period': 'PerÃ­odo del presupuesto',
            
            // Transacciones
            'date': 'Fecha',
            'description': 'DescripciÃ³n',
            'amount': 'Cantidad',
            'category': 'CategorÃ­a',
            'type': 'Tipo',
            'income-type': 'Ingreso',
            'expense-type': 'Gasto',
            'transaction-history': 'Historial de transacciones',
            'payment-method': 'MÃ©todo de pago',
            'recurring': 'Recurrente',
            
            // ðŸ”¥ CATEGORIAS DE GASTOS (COMPLETO) ðŸ”¥
            'food': 'AlimentaciÃ³n',
            'transport': 'Transporte',
            'housing': 'Vivienda',
            'mortgage': 'Hipoteca',                // <-- AÃ‘ADIDO
            'rent': 'Alquiler',                     // <-- AÃ‘ADIDO
            'utilities': 'Servicios',
            'electricity': 'Electricidad',          // <-- AÃ‘ADIDO
            'water': 'Agua',                        // <-- AÃ‘ADIDO
            'gas': 'Gas',                           // <-- AÃ‘ADIDO
            'internet': 'Internet',                 // <-- AÃ‘ADIDO
            'phone': 'TelÃ©fono',                    // <-- AÃ‘ADIDO
            'entertainment': 'Entretenimiento',
            'restaurant': 'Restaurante',            // <-- AÃ‘ADIDO
            'cinema': 'Cine',                       // <-- AÃ‘ADIDO
            'travel': 'Viajes',                     // <-- AÃ‘ADIDO
            'health': 'Salud',
            'doctor': 'MÃ©dico',                     // <-- AÃ‘ADIDO
            'pharmacy': 'Farmacia',                 // <-- AÃ‘ADIDO
            'gym': 'Gimnasio',                      // <-- AÃ‘ADIDO
            'shopping-cat': 'Compras',
            'clothing': 'Ropa',                      // <-- AÃ‘ADIDO
            'electronics': 'ElectrÃ³nica',           // <-- AÃ‘ADIDO
            'education': 'EducaciÃ³n',
            'books': 'Libros',                      // <-- AÃ‘ADIDO
            'courses': 'Cursos',                    // <-- AÃ‘ADIDO
            'insurance': 'Seguro',                   // <-- AÃ‘ADIDO
            'taxes': 'Impuestos',                    // <-- AÃ‘ADIDO
            'savings': 'Ahorros',                    // <-- AÃ‘ADIDO
            'emergency': 'Fondo de Emergencia',     // <-- AÃ‘ADIDO
            'charity': 'Donaciones',                 // <-- AÃ‘ADIDO
            'other-expense': 'Otro',
            
            // Mensajes
            'no-data': 'No hay datos disponibles',
            'loading': 'Cargando...',
            'error': 'Error',
            'success': 'Ã‰xito',
            'warning': 'Advertencia',
            'info': 'InformaciÃ³n',
            'confirm-delete': 'Â¿EstÃ¡s seguro de que quieres eliminar?',
            'saved-successfully': 'Guardado correctamente',
            
            // PerÃ­odos
            'daily': 'Diario',
            'weekly': 'Semanal',
            'monthly': 'Mensual',
            'yearly': 'Anual',
            
            // Ajustes
            'language': 'Idioma',
            'currency': 'Moneda',
            'theme': 'Tema',
            'notifications': 'Notificaciones',
            'export-data': 'Exportar datos',
            'import-data': 'Importar datos'
        },
        'fr': {
            // Dashboard
            'app-subtitle': 'GÃ©rez vos finances intelligemment',
            'incomes': 'Revenus',
            'income': 'Revenu',
            'expense': 'DÃ©pense',
            'expenses': 'DÃ©penses',
            'balance': 'Solde',
            'budget': 'Budget',
            'add-income': 'Ajouter un revenu',
            'add-expense': 'Ajouter une dÃ©pense',
            'view-details': 'Voir les dÃ©tails',
            'monthly-summary': 'RÃ©sumÃ© mensuel',
            'total-income': 'Revenus totaux',
            'total-expenses': 'DÃ©penses totales',
            'net-balance': 'Solde net',
            'recent-transactions': 'Transactions RÃ©centes',
            
            // ðŸ”¥ NUOVE TRADUZIONI AGGIUNTE ðŸ”¥
            'shopping': 'Liste de Courses',
            'stores': 'Magasins Proches',
            'new-transaction': 'Ajouter Transaction',
            'shopping-placeholder': 'Que devez-vous acheter?',
            'items': 'articles',
            'income-minus-expenses': 'Revenus - DÃ©penses',
            'no-transactions': 'Aucune transaction',
            'add-new-transaction': 'Ajouter Nouvelle Transaction',
            'find-prices': 'Trouver des prix',
            // ðŸ”¥ FINE NUOVE TRADUZIONI ðŸ”¥

            // ðŸ”¥ ULTERIORI TRADUZIONI AGGIUNTE ðŸ”¥
            'new-income': 'Nouveau Revenu',
            'register-income': 'Enregistrer un nouveau revenu',
            'description': 'Description',
            'amount': 'Montant',
            'category': 'CatÃ©gorie',
            'date': 'Date',
            'save-income': 'Enregistrer le Revenu',
            'cancel': 'Annuler',
            'back-to-dashboard': 'Retour au Tableau de bord',
            'new-expense': 'Nouvelle DÃ©pense',
            'register-expense': 'Enregistrer une nouvelle dÃ©pense',
            'save-expense': 'Enregistrer la DÃ©pense',
            'shopping-list': 'Liste de Courses',
            'optimize-purchases': 'Optimiser les Achats',
            'lowest-price': 'Prix le plus bas',
            'min-total': 'DÃ©pense totale minimale',
            'fewest-stores': 'Moins de magasins',
            'fewer-stores': 'Visitez moins de magasins',
            'optimized': 'OptimisÃ©',
            'price-stores-balanced': 'Prix et magasins Ã©quilibrÃ©s',
            'optimization-result': 'RÃ©sultat d\'Optimisation',
            'total-price': 'Prix Total',
            'stores': 'Magasins',
            'apply-solution': 'Appliquer cette solution',
            'nearby-stores': 'Magasins Ã  ProximitÃ©',
            'find-nearby-stores': 'Trouver des magasins Ã  proximitÃ©',
            'budget-management': 'Gestion du Budget',
            'set-monthly-budgets': 'DÃ©finir les budgets mensuels par catÃ©gorie',
            'confirm-budget': 'Confirmer le Budget',
            'your-profile': 'Votre Profil',
            'configure-data': 'Configurez vos donnÃ©es pour une expÃ©rience personnalisÃ©e',
            'personal-data': 'DonnÃ©es Personnelles',
            'home-address': 'Adresse du Domicile',
            'work-address': 'Adresse Professionnelle',
            'international-preferences': 'PrÃ©fÃ©rences Internationales',
            'preferred-language': 'Langue PrÃ©fÃ©rÃ©e',
            'default-currency': 'Devise par DÃ©faut',
            'formatting-preview': 'AperÃ§u du formatage',
            'name': 'PrÃ©nom',
            'surname': 'Nom',
            'street': 'Rue',
            'number': 'NumÃ©ro',
            'city': 'Ville',
            'province': 'Province',
            'country': 'Pays',
            'company': 'Nom de l\'Entreprise',
            'all-transactions': 'Toutes les Transactions',
            'description-placeholder-income': 'Salaire, Bonus, Vente...',
            'description-placeholder-expense': 'DÃ®ner, Essence, Facture...',
            'shopping-item-placeholder': 'Que devez-vous acheter?',
            'description-placeholder-income': 'Salaire, Bonus, Vente...',
            'description-placeholder-expense': 'DÃ®ner, Essence, Facture...',
            'shopping-item-placeholder': 'Que devez-vous acheter?',
            'shopping-list': 'Liste de Courses',
            'shopping-placeholder': 'Que devez-vous acheter?',
            'optimize-purchases': 'Optimiser les Achats',
            'lowest-price': 'Prix le plus bas',
            'fewest-stores': 'Moins de magasins',
            'optimized': 'OptimisÃ©',
            'nearby-stores': 'Magasins Proches',
            'find-nearby-stores': 'Trouver des Magasins Proches',
            'budget-management': 'Gestion du Budget',
            'set-monthly-budgets': 'DÃ©finir les budgets mensuels par catÃ©gorie',
            'confirm-budget': 'Confirmer le Budget',
            'your-profile': 'Votre Profil',
            'configure-data': 'Configurez vos donnÃ©es pour une expÃ©rience personnalisÃ©e',
            'all-transactions': 'Toutes les Transactions',
            'new-income': 'Nouveau Revenu',
            'register-income': 'Enregistrer un nouveau revenu',
            'new-expense': 'Nouvelle DÃ©pense',
            'register-expense': 'Enregistrer une nouvelle dÃ©pense',
            'save-income': 'Enregistrer le Revenu',
            'save-expense': 'Enregistrer la DÃ©pense',
            'description-placeholder-income': 'Salaire, Bonus, Vente...',
            'description-placeholder-expense': 'DÃ®ner, Essence, Facture...',

            // Sidebar/Navigation
            'dashboard': 'Tableau de bord',
            'transactions': 'Transactions',
            'budgets': 'Budgets',
            'categories': 'CatÃ©gories',
            'reports': 'Rapports',
            'settings': 'ParamÃ¨tres',
            'profile': 'Profil',
            'logout': 'DÃ©connexion',
            
            // Form comuni
            'save': 'Enregistrer',
            'cancel': 'Annuler',
            'edit': 'Modifier',
            'delete': 'Supprimer',
            'confirm': 'Confirmer',
            'add': 'Ajouter',
            'update': 'Mettre Ã  jour',
            'search': 'Rechercher',
            'filter': 'Filtrer',
            'reset': 'RÃ©initialiser',
            
            // Budget
            'create-budget': 'CrÃ©er un budget',
            'budget-category': 'CatÃ©gorie de budget',
            'budget-amount': 'Montant du budget',
            'current-spending': 'DÃ©penses actuelles',
            'remaining': 'Restant',
            'budget-overview': 'AperÃ§u du budget',
            'set-budget': 'DÃ©finir le budget',
            'budget-period': 'PÃ©riode du budget',
            
            // Transactions
            'date': 'Date',
            'description': 'Description',
            'amount': 'Montant',
            'category': 'CatÃ©gorie',
            'type': 'Type',
            'income-type': 'Revenu',
            'expense-type': 'DÃ©pense',
            'transaction-history': 'Historique des transactions',
            'payment-method': 'MÃ©thode de paiement',
            'recurring': 'RÃ©current',
            
            // ðŸ”¥ CATÃ‰GORIES DE DÃ‰PENSES (COMPLET) ðŸ”¥
            'food': 'Alimentation',
            'transport': 'Transport',
            'housing': 'Logement',
            'mortgage': 'PrÃªt Immobilier',          // <-- AJOUTÃ‰
            'rent': 'Loyer',                         // <-- AJOUTÃ‰
            'utilities': 'Services Publics',
            'electricity': 'Ã‰lectricitÃ©',            // <-- AJOUTÃ‰
            'water': 'Eau',                          // <-- AJOUTÃ‰
            'gas': 'Gaz',                            // <-- AJOUTÃ‰
            'internet': 'Internet',                  // <-- AJOUTÃ‰
            'phone': 'TÃ©lÃ©phone',                    // <-- AJOUTÃ‰
            'entertainment': 'Divertissement',
            'restaurant': 'Restaurant',              // <-- AJOUTÃ‰
            'cinema': 'CinÃ©ma',                      // <-- AJOUTÃ‰
            'travel': 'Voyages',                     // <-- AJOUTÃ‰
            'health': 'SantÃ©',
            'doctor': 'MÃ©decin',                     // <-- AJOUTÃ‰
            'pharmacy': 'Pharmacie',                 // <-- AJOUTÃ‰
            'gym': 'Salle de Sport',                 // <-- AJOUTÃ‰
            'shopping-cat': 'Shopping',
            'clothing': 'VÃªtements',                 // <-- AJOUTÃ‰
            'electronics': 'Ã‰lectronique',           // <-- AJOUTÃ‰
            'education': 'Ã‰ducation',
            'books': 'Livres',                       // <-- AJOUTÃ‰
            'courses': 'Cours',                      // <-- AJOUTÃ‰
            'insurance': 'Assurance',                 // <-- AJOUTÃ‰
            'taxes': 'ImpÃ´ts',                        // <-- AJOUTÃ‰
            'savings': 'Ã‰pargne',                    // <-- AJOUTÃ‰
            'emergency': 'Fonds d\'Urgence',         // <-- AJOUTÃ‰
            'charity': 'Dons',                        // <-- AJOUTÃ‰
            'other-expense': 'Autre',
            
            // Messages
            'no-data': 'Aucune donnÃ©e disponible',
            'loading': 'Chargement...',
            'error': 'Erreur',
            'success': 'SuccÃ¨s',
            'warning': 'Avertissement',
            'info': 'Information',
            'confirm-delete': 'ÃŠtes-vous sÃ»r de vouloir supprimer ?',
            'saved-successfully': 'EnregistrÃ© avec succÃ¨s',
            
            // PÃ©riodes
            'daily': 'Quotidien',
            'weekly': 'Hebdomadaire',
            'monthly': 'Mensuel',
            'yearly': 'Annuel',
            
            // ParamÃ¨tres
            'language': 'Langue',
            'currency': 'Devise',
            'theme': 'ThÃ¨me',
            'notifications': 'Notifications',
            'export-data': 'Exporter les donnÃ©es',
            'import-data': 'Importer les datos'
        },
        'de': {
            // Dashboard
            'app-subtitle': 'Verwalten Sie Ihre Finanzen intelligent',
            'incomes': 'Einkommen',
            'income': 'Einnahme',
            'expense': 'Ausgabe',
            'expenses': 'Ausgaben',
            'balance': 'Kontostand',
            'budget': 'Budget',
            'add-income': 'Einkommen hinzufÃ¼gen',
            'add-expense': 'Ausgabe hinzufÃ¼gen',
            'view-details': 'Details anzeigen',
            'monthly-summary': 'Monatszusammenfassung',
            'total-income': 'Gesamteinkommen',
            'total-expenses': 'Gesamtausgaben',
            'net-balance': 'Netto-Kontostand',
            'recent-transactions': 'Letzte Transaktionen',
            
            // ðŸ”¥ NUOVE TRADUZIONI AGGIUNTE ðŸ”¥
            'shopping': 'Einkaufsliste',
            'stores': 'Nahe GeschÃ¤fte',
            'new-transaction': 'Transaktion HinzufÃ¼gen',
            'shopping-placeholder': 'Was mÃ¼ssen Sie kaufen?',
            'items': 'Artikel',
            'income-minus-expenses': 'Einnahmen - Ausgaben',
            'no-transactions': 'Keine Transaktionen',
            'add-new-transaction': 'Neue Transaktion HinzufÃ¼gen',
            'find-prices': 'Preise finden',
            // ðŸ”¥ FINE NUOVE TRADUZIONI ðŸ”¥
            
            // ðŸ”¥ ULTERIORI TRADUZIONI AGGIUNTE ðŸ”¥
            'new-income': 'Neue Einnahme',
            'register-income': 'Eine neue Einnahme erfassen',
            'description': 'Beschreibung',
            'amount': 'Betrag',
            'category': 'Kategorie',
            'date': 'Datum',
            'save-income': 'Einnahme Speichern',
            'cancel': 'Abbrechen',
            'back-to-dashboard': 'ZurÃ¼ck zum Dashboard',
            'new-expense': 'Neue Ausgabe',
            'register-expense': 'Eine neue Ausgabe erfassen',
            'save-expense': 'Ausgabe Speichern',
            'shopping-list': 'Einkaufsliste',
            'optimize-purchases': 'EinkÃ¤ufe Optimieren',
            'lowest-price': 'Niedrigster Preis',
            'min-total': 'Minimale Gesamtausgaben',
            'fewest-stores': 'Weniger GeschÃ¤fte',
            'fewer-stores': 'Besuchen Sie weniger GeschÃ¤fte',
            'optimized': 'Optimiert',
            'price-stores-balanced': 'Preis und GeschÃ¤fte ausgeglichen',
            'optimization-result': 'Optimierungsergebnis',
            'total-price': 'Gesamtpreis',
            'stores': 'GeschÃ¤fte',
            'apply-solution': 'Diese LÃ¶sung anwenden',
            'nearby-stores': 'Nahegelegene GeschÃ¤fte',
            'find-nearby-stores': 'GeschÃ¤fte in der NÃ¤he finden',
            'budget-management': 'Budgetverwaltung',
            'set-monthly-budgets': 'Monatliche Budgets nach Kategorie festlegen',
            'confirm-budget': 'Budget BestÃ¤tigen',
            'your-profile': 'Ihr Profil',
            'configure-data': 'Konfigurieren Sie Ihre Daten fÃ¼r ein personalisiertes Erlebnis',
            'personal-data': 'PersÃ¶nliche Daten',
            'home-address': 'Heimatadresse',
            'work-address': 'GeschÃ¤ftsadresse',
            'international-preferences': 'Internationale PrÃ¤ferenzen',
            'preferred-language': 'Bevorzugte Sprache',
            'default-currency': 'StandardwÃ¤hrung',
            'formatting-preview': 'Formatierungsvorschau',
            'name': 'Vorname',
            'surname': 'Nachname',
            'street': 'StraÃŸe',
            'number': 'Hausnummer',
            'city': 'Stadt',
            'province': 'Provinz',
            'country': 'Land',
            'company': 'Firmenname',
            'all-transactions': 'Alle Transaktionen',
            'description-placeholder-income': 'Gehalt, Bonus, Verkauf...',
            'description-placeholder-expense': 'Abendessen, Benzin, Rechnung...',
            'shopping-item-placeholder': 'Was mÃ¼ssen Sie kaufen?',
            'description-placeholder-income': 'Gehalt, Bonus, Verkauf...',
            'description-placeholder-expense': 'Abendessen, Benzin, Rechnung...',
            'shopping-item-placeholder': 'Was mÃ¼ssen Sie kaufen?',
            'shopping-list': 'Einkaufsliste',
            'shopping-placeholder': 'Was mÃ¼ssen Sie kaufen?',
            'optimize-purchases': 'EinkÃ¤ufe Optimieren',
            'lowest-price': 'Niedrigster Preis',
            'fewest-stores': 'Weniger GeschÃ¤fte',
            'optimized': 'Optimiert',
            'nearby-stores': 'Nahe GeschÃ¤fte',
            'find-nearby-stores': 'GeschÃ¤fte in der NÃ¤he finden',
            'budget-management': 'Budgetverwaltung',
            'set-monthly-budgets': 'Monatliche Budgets nach Kategorie festlegen',
            'confirm-budget': 'Budget BestÃ¤tigen',
            'your-profile': 'Ihr Profil',
            'configure-data': 'Konfigurieren Sie Ihre Daten fÃ¼r ein personalisiertes Erlebnis',
            'all-transactions': 'Alle Transaktionen',
            'new-income': 'Neue Einnahme',
            'register-income': 'Eine neue Einnahme erfassen',
            'new-expense': 'Neue Ausgabe',
            'register-expense': 'Eine neue Ausgabe erfassen',
            'save-income': 'Einnahme Speichern',
            'save-expense': 'Ausgabe Speichern',
            'description-placeholder-income': 'Gehalt, Bonus, Verkauf...',
            'description-placeholder-expense': 'Abendessen, Benzin, Rechnung...',

            // Sidebar/Navigation
            'dashboard': 'Dashboard',
            'transactions': 'Transaktionen',
            'budgets': 'Budgets',
            'categories': 'Kategorien',
            'reports': 'Berichte',
            'settings': 'Einstellungen',
            'profile': 'Profil',
            'logout': 'Abmelden',
            
            // Form comuni
            'save': 'Speichern',
            'cancel': 'Abbrechen',
            'edit': 'Bearbeiten',
            'delete': 'LÃ¶schen',
            'confirm': 'BestÃ¤tigen',
            'add': 'HinzufÃ¼gen',
            'update': 'Aktualisieren',
            'search': 'Suchen',
            'filter': 'Filtern',
            'reset': 'ZurÃ¼cksetzen',
            
            // Budget
            'create-budget': 'Budget erstellen',
            'budget-category': 'Budget-Kategorie',
            'budget-amount': 'Budget-Betrag',
            'current-spending': 'Aktuelle Ausgaben',
            'remaining': 'Verbleibend',
            'budget-overview': 'Budget-Ãœbersicht',
            'set-budget': 'Budget festlegen',
            'budget-period': 'Budget-Zeitraum',
            
            // Transaktionen
            'date': 'Datum',
            'description': 'Beschreibung',
            'amount': 'Betrag',
            'category': 'Kategorie',
            'type': 'Typ',
            'income-type': 'Einkommen',
            'expense-type': 'Ausgabe',
            'transaction-history': 'Transaktionsverlauf',
            'payment-method': 'Zahlungsmethode',
            'recurring': 'Wiederkehrend',
            
             // ðŸ”¥ AUSGABENKATEGORIEN (VOLLSTÃ„NDIG) ðŸ”¥
             'food': 'Lebensmittel',
            'transport': 'Transport',
            'housing': 'Wohnen',
            'mortgage': 'Hypothek',                  // <-- HINZUGEFÃœGT
            'rent': 'Miete',                          // <-- HINZUGEFÃœGT
            'utilities': 'Nebenkosten',
            'electricity': 'Strom',                   // <-- HINZUGEFÃœGT
            'water': 'Wasser',                        // <-- HINZUGEFÃœGT
            'gas': 'Gas',                             // <-- HINZUGEFÃœGT
            'internet': 'Internet',                   // <-- HINZUGEFÃœGT
            'phone': 'Telefon',                       // <-- HINZUGEFÃœGT
            'entertainment': 'Unterhaltung',
            'restaurant': 'Restaurant',               // <-- HINZUGEFÃœGT
            'cinema': 'Kino',                         // <-- HINZUGEFÃœGT
            'travel': 'Reisen',                       // <-- HINZUGEFÃœGT
            'health': 'Gesundheit',
            'doctor': 'Arzt',                         // <-- HINZUGEFÃœGT
            'pharmacy': 'Apotheke',                   // <-- HINZUGEFÃœGT
            'gym': 'Fitnessstudio',                   // <-- HINZUGEFÃœGT
            'shopping-cat': 'Einkaufen',
            'clothing': 'Kleidung',                   // <-- HINZUGEFÃœGT
            'electronics': 'Elektronik',              // <-- HINZUGEFÃœGT
            'education': 'Bildung',
            'books': 'BÃ¼cher',                        // <-- HINZUGEFÃœGT
            'courses': 'Kurse',                       // <-- HINZUGEFÃœGT
            'insurance': 'Versicherung',               // <-- HINZUGEFÃœGT
            'taxes': 'Steuern',                       // <-- HINZUGEFÃœGT
            'savings': 'Ersparnisse',                 // <-- HINZUGEFÃœGT
            'emergency': 'Notfallfonds',              // <-- HINZUGEFÃœGT
            'charity': 'Spenden',                     // <-- HINZUGEFÃœGT
            'other-expense': 'Sonstiges',
            
            // Nachrichten
            'no-data': 'Keine Daten verfÃ¼gbar',
            'loading': 'Wird geladen...',
            'error': 'Fehler',
            'success': 'Erfolg',
            'warning': 'Warnung',
            'info': 'Information',
            'confirm-delete': 'Sind Sie sicher, dass Sie lÃ¶schen mÃ¶chten?',
            'saved-successfully': 'Erfolgreich gespeichert',
            
            // ZeitrÃ¤ume
            'daily': 'TÃ¤glich',
            'weekly': 'WÃ¶chentlich',
            'monthly': 'Monatlich',
            'yearly': 'JÃ¤hrlich',
            
            // Einstellungen
            'language': 'Sprache',
            'currency': 'WÃ¤hrung',
            'theme': 'Thema',
            'notifications': 'Benachrichtigungen',
            'export-data': 'Daten exportieren',
            'import-data': 'Daten importieren'
        },
        'ro': {
            // Dashboard
            'app-subtitle': 'GestioneazÄƒ-È›i finanÈ›ele inteligent',
            'incomes': 'Venituri',
            'income': 'Venit',
            'expense': 'CheltuialÄƒ',
            'expenses': 'Cheltuieli',
            'balance': 'Sold',
            'budget': 'Buget',
            'add-income': 'AdaugÄƒ venit',
            'add-expense': 'AdaugÄƒ cheltuialÄƒ',
            'view-details': 'Vezi detalii',
            'monthly-summary': 'Rezumat lunar',
            'total-income': 'Venituri totale',
            'total-expenses': 'Cheltuieli totale',
            'net-balance': 'Sold net',
            'recent-transactions': 'TranzacÈ›ii Recente',
            
            // ðŸ”¥ NUOVE TRADUZIONI AGGIUNTE ðŸ”¥
            'shopping': 'Lista de CumpÄƒrÄƒturi',
            'stores': 'Magazine Apropiate',
            'new-transaction': 'AdaugÄƒ TranzacÈ›ie',
            'shopping-placeholder': 'Ce trebuie sÄƒ cumperi?',
            'items': 'articole',
            'income-minus-expenses': 'Venituri - Cheltuieli',
            'no-transactions': 'FÄƒrÄƒ tranzacÈ›ii',
            'add-new-transaction': 'AdÄƒugÄƒ TranzacÈ›ie NouÄƒ',
            'find-prices': 'GÄƒseÈ™te preÈ›uri',
            // ðŸ”¥ FINE NUOVE TRADUZIONI ðŸ”¥

            // ðŸ”¥ ULTERIORI TRADUZIONI AGGIUNTE ðŸ”¥
            'new-income': 'Venit Nou',
            'register-income': 'ÃŽnregistreazÄƒ un venit nou',
            'description': 'Descriere',
            'amount': 'SumÄƒ',
            'category': 'Categorie',
            'date': 'DatÄƒ',
            'save-income': 'SalveazÄƒ Venit',
            'cancel': 'AnuleazÄƒ',
            'back-to-dashboard': 'ÃŽnapoi la Tablou de bord',
            'new-expense': 'CheltuialÄƒ NouÄƒ',
            'register-expense': 'ÃŽnregistreazÄƒ o cheltuialÄƒ nouÄƒ',
            'save-expense': 'SalveazÄƒ CheltuialÄƒ',
            'shopping-list': 'ListÄƒ de CumpÄƒrÄƒturi',
            'optimize-purchases': 'OptimizeazÄƒ AchiziÈ›ii',
            'lowest-price': 'Cel mai mic preÈ›',
            'min-total': 'CheltuialÄƒ totalÄƒ minimÄƒ',
            'fewest-stores': 'Mai puÈ›ine magazine',
            'fewer-stores': 'ViziteazÄƒ mai puÈ›ine magazine',
            'optimized': 'Optimizat',
            'price-stores-balanced': 'PreÈ› È™i magazine echilibrate',
            'optimization-result': 'Rezultat Optimizare',
            'total-price': 'PreÈ› Total',
            'stores': 'Magazine',
            'apply-solution': 'AplicÄƒ aceastÄƒ soluÈ›ie',
            'nearby-stores': 'Magazine Apropiate',
            'find-nearby-stores': 'GÄƒseÈ™te magazine apropiate',
            'budget-management': 'Gestionare Buget',
            'set-monthly-budgets': 'SeteazÄƒ bugete lunare pe categorii',
            'confirm-budget': 'ConfirmÄƒ Buget',
            'your-profile': 'Profilul TÄƒu',
            'configure-data': 'ConfigureazÄƒ-È›i datele pentru o experienÈ›Äƒ personalizatÄƒ',
            'personal-data': 'Date Personale',
            'home-address': 'Adresa de Domiciliu',
            'work-address': 'Adresa de MuncÄƒ',
            'international-preferences': 'PreferinÈ›e InternaÈ›ionale',
            'preferred-language': 'Limba PreferatÄƒ',
            'default-currency': 'Moneda ImplicitÄƒ',
            'formatting-preview': 'Previzualizare formatare',
            'name': 'Prenume',
            'surname': 'Nume',
            'street': 'StradÄƒ',
            'number': 'NumÄƒr',
            'city': 'OraÈ™',
            'province': 'Provincie',
            'country': 'ÈšarÄƒ',
            'company': 'Nume Companie',
            'all-transactions': 'Toate TranzacÈ›iile',
            'description-placeholder-income': 'Salariu, Bonus, VÃ¢nzare...',
            'description-placeholder-expense': 'CinÄƒ, BenzinÄƒ, FacturÄƒ...',
            'shopping-item-placeholder': 'Ce trebuie sÄƒ cumperi?',
            'description-placeholder-income': 'Salariu, Bonus, VÃ¢nzare...',
            'description-placeholder-expense': 'CinÄƒ, BenzinÄƒ, FacturÄƒ...',
            'shopping-item-placeholder': 'Ce trebuie sÄƒ cumperi?',
            'shopping-list': 'Lista de CumpÄƒrÄƒturi',
            'shopping-placeholder': 'Ce trebuie sÄƒ cumperi?',
            'optimize-purchases': 'OptimizeazÄƒ AchiziÈ›ii',
            'lowest-price': 'Cel mai mic preÈ›',
            'fewest-stores': 'Mai puÈ›ine magazine',
            'optimized': 'Optimizat',
            'nearby-stores': 'Magazine Apropiate',
            'find-nearby-stores': 'GÄƒseÈ™te Magazine Apropiate',
            'budget-management': 'Gestionare Buget',
            'set-monthly-budgets': 'SeteazÄƒ bugete lunare pe categorii',
            'confirm-budget': 'ConfirmÄƒ Buget',
            'your-profile': 'Profilul TÄƒu',
            'configure-data': 'ConfigureazÄƒ-È›i datele pentru o experienÈ›Äƒ personalizatÄƒ',
            'all-transactions': 'Toate TranzacÈ›iile',
            'new-income': 'Venit Nou',
            'register-income': 'ÃŽnregistreazÄƒ un venit nou',
            'new-expense': 'CheltuialÄƒ NouÄƒ',
            'register-expense': 'ÃŽnregistreazÄƒ o cheltuialÄƒ nouÄƒ',
            'save-income': 'SalveazÄƒ Venit',
            'save-expense': 'SalveazÄƒ CheltuialÄƒ',
            'description-placeholder-income': 'Salariu, Bonus, VÃ¢nzare...',
            'description-placeholder-expense': 'CinÄƒ, BenzinÄƒ, FacturÄƒ...',
            'company-placeholder': 'Numele companiei tale',
            'street-placeholder': 'StradÄƒ',
            'number-placeholder': 'NumÄƒr',
            'city-placeholder': 'OraÈ™',
            'province-placeholder': 'Provincie',
            'select': '-- SelecteazÄƒ --',

            // Sidebar/Navigation
            'dashboard': 'Tablou de bord',
            'transactions': 'TranzacÈ›ii',
            'budgets': 'Bugete',
            'categories': 'Categorii',
            'reports': 'Rapoarte',
            'settings': 'SetÄƒri',
            'profile': 'Profil',
            'logout': 'Deconectare',
            
            // Form comuni
            'save': 'SalveazÄƒ',
            'cancel': 'AnuleazÄƒ',
            'edit': 'EditeazÄƒ',
            'delete': 'È˜terge',
            'confirm': 'ConfirmÄƒ',
            'add': 'AdaugÄƒ',
            'update': 'ActualizeazÄƒ',
            'search': 'CautÄƒ',
            'filter': 'FiltreazÄƒ',
            'reset': 'ReseteazÄƒ',
            
            // Budget
            'create-budget': 'CreazÄƒ buget',
            'budget-category': 'Categorie buget',
            'budget-amount': 'SumÄƒ buget',
            'current-spending': 'Cheltuieli curente',
            'remaining': 'RÄƒmas',
            'budget-overview': 'Prezentare buget',
            'set-budget': 'SeteazÄƒ buget',
            'budget-period': 'PerioadÄƒ buget',
            
            // TranzacÈ›ii
            'date': 'DatÄƒ',
            'description': 'Descriere',
            'amount': 'SumÄƒ',
            'category': 'Categorie',
            'type': 'Tip',
            'income-type': 'Venit',
            'expense-type': 'CheltuialÄƒ',
            'transaction-history': 'Istoric tranzacÈ›ii',
            'payment-method': 'MetodÄƒ de platÄƒ',
            'recurring': 'Recurent',
            
            // ðŸ”¥ CATEGORII DE CHELTUIELI (COMPLET) ðŸ”¥
            'food': 'AlimentaÈ›ie',
            'transport': 'Transport',
            'housing': 'LocuinÈ›Äƒ',
            'mortgage': 'Credit Ipotecar',           // <-- ADÄ‚UGAT
            'rent': 'Chirie',                         // <-- ADÄ‚UGAT
            'utilities': 'UtilitÄƒÈ›i',
            'electricity': 'Electricitate',           // <-- ADÄ‚UGAT
            'water': 'ApÄƒ',                           // <-- ADÄ‚UGAT
            'gas': 'Gaz',                             // <-- ADÄ‚UGAT
            'internet': 'Internet',                   // <-- ADÄ‚UGAT
            'phone': 'Telefon',                       // <-- ADÄ‚UGAT
            'entertainment': 'Divertisment',
            'restaurant': 'Restaurant',               // <-- ADÄ‚UGAT
            'cinema': 'Cinema',                       // <-- ADÄ‚UGAT
            'travel': 'CÄƒlÄƒtorii',                    // <-- ADÄ‚UGAT
            'health': 'SÄƒnÄƒtate',
            'doctor': 'Medic',                        // <-- ADÄ‚UGAT
            'pharmacy': 'Farmacie',                   // <-- ADÄ‚UGAT
            'gym': 'SalÄƒ de Sport',                   // <-- ADÄ‚UGAT
            'shopping-cat': 'CumpÄƒrÄƒturi',
            'clothing': 'ÃŽmbrÄƒcÄƒminte',               // <-- ADÄ‚UGAT
            'electronics': 'Electronice',             // <-- ADÄ‚UGAT
            'education': 'EducaÈ›ie',
            'books': 'CÄƒrÈ›i',                         // <-- ADÄ‚UGAT
            'courses': 'Cursuri',                     // <-- ADÄ‚UGAT
            'insurance': 'Asigurare',                  // <-- ADÄ‚UGAT
            'taxes': 'Taxe',                          // <-- ADÄ‚UGAT
            'savings': 'Economii',                    // <-- ADÄ‚UGAT
            'emergency': 'Fond de UrgenÈ›Äƒ',           // <-- ADÄ‚UGAT
            'charity': 'DonaÈ›ii',                     // <-- ADÄ‚UGAT
            'other-expense': 'Altele',
            
            // Mesaje
            'no-data': 'Nicio datÄƒ disponibilÄƒ',
            'loading': 'Se Ã®ncarcÄƒ...',
            'error': 'Eroare',
            'success': 'Succes',
            'warning': 'AtenÈ›ie',
            'info': 'InformaÈ›ii',
            'confirm-delete': 'Sigur doriÈ›i sÄƒ È™tergeÈ›i?',
            'saved-successfully': 'Salvat cu succes',
            
            // Perioade
            'daily': 'Zilnic',
            'weekly': 'SÄƒptÄƒmÃ¢nal',
            'monthly': 'Lunar',
            'yearly': 'Anual',
            
            // SetÄƒri
            'language': 'LimbÄƒ',
            'currency': 'MonedÄƒ',
            'theme': 'TemÄƒ',
            'notifications': 'NotificÄƒri',
            'export-data': 'ExportÄƒ date',
            'import-data': 'ImportÄƒ date'
        }
    };
    
    const t = translations[lang] || translations['it'];
    
    // 1. Traduci elementi con data-translate
    document.querySelectorAll('[data-translate]').forEach(element => {
        const key = element.getAttribute('data-translate');
        if (t[key]) {
            element.textContent = t[key];
        }
    });
    
    // 2. Traduci placeholder
    document.querySelectorAll('[data-translate-placeholder]').forEach(element => {
        const key = element.getAttribute('data-translate-placeholder');
        if (t[key]) {
            element.placeholder = t[key];
        }
    });
    
    // 3. Traduci titoli
    document.querySelectorAll('[data-translate-title]').forEach(element => {
        const key = element.getAttribute('data-translate-title');
        if (t[key]) {
            element.title = t[key];
        }
    });
    
    // ==================== TRADUZIONI ESTESE ====================
    
    // 1. Dashboard - Elementi principali
    const subtitle = document.querySelector('p.text-gray-500.mt-2');
    if (subtitle && t['app-subtitle']) {
        subtitle.textContent = t['app-subtitle'];
    }
    
    // 2. Card labels
    const labels = document.querySelectorAll('.text-gray-500.text-sm.uppercase');
    if (labels.length >= 4) {
        if (t['income']) labels[0].textContent = t['income'];
        if (t['expenses']) labels[1].textContent = t['expenses'];
        if (t['balance']) labels[2].textContent = t['balance'];
        if (t['budget']) labels[3].textContent = t['budget'];
    }
    
    // 3. Sezione "Entrate - Uscite" nella card saldo
    const incomeExpenseText = document.querySelector('.card-balance .text-sm.text-gray-500');
    if (incomeExpenseText && t['income-minus-expenses']) {
        const icon = incomeExpenseText.querySelector('i');
        if (icon) {
            incomeExpenseText.innerHTML = `<i class="fas fa-info-circle mr-1"></i> ${t['income-minus-expenses']}`;
        } else {
            incomeExpenseText.textContent = t['income-minus-expenses'];
        }
    }
    
    // 4. Bottoni principali
    document.querySelectorAll('button').forEach(button => {
        const html = button.innerHTML;
        
        // Bottoni della dashboard
        if (html.includes('Aggiungi Entrata') || html.includes('Add income') || html.includes('AÃ±adir ingreso') || html.includes('Ajouter un revenu') || html.includes('Einkommen hinzufÃ¼gen') || html.includes('AdaugÄƒ venit')) {
            button.innerHTML = `<i class="fas fa-plus"></i> ${t['add-income']}`;
        }
        if (html.includes('Aggiungi Uscita') || html.includes('Add expense') || html.includes('AÃ±adir gasto') || html.includes('Ajouter une dÃ©pense') || html.includes('Ausgabe hinzufÃ¼gen') || html.includes('AdaugÄƒ cheltuialÄƒ')) {
            button.innerHTML = `<i class="fas fa-plus"></i> ${t['add-expense']}`;
        }
        if (html.includes('Gestisci Budget') || html.includes('Manage Budget') || html.includes('Gestionar Presupuesto') || html.includes('GÃ©rer Budget') || html.includes('Budget verwalten') || html.includes('GestioneazÄƒ Buget')) {
            button.innerHTML = `<i class="fas fa-cog"></i> ${t['budget']}`;
        }
        if (html.includes('Vedi tutte') || html.includes('View details') || html.includes('Ver detalles') || html.includes('Voir les dÃ©tails') || html.includes('Details anzeigen') || html.includes('Vezi detalii')) {
            button.innerHTML = `${t['view-details']} â†’`;
        }
        if (html.includes('Aggiungi Nuova Transazione') || html.includes('Add New Transaction') || html.includes('AÃ±adir Nueva TransacciÃ³n') || html.includes('Ajouter Nouvelle Transaction') || html.includes('Neue Transaktion hinzufÃ¼gen') || html.includes('AdaugÄƒ TranzacÈ›ie NouÄƒ')) {
            button.innerHTML = `<i class="fas fa-plus mr-2"></i>${t['new-transaction']}`;
        }
        
        // Titoli nei bottoni
        const spans = button.querySelectorAll('p.font-semibold');
        spans.forEach(span => {
            if (span.textContent.includes('Lista Spesa') || span.textContent.includes('Shopping List') || span.textContent.includes('Lista de Compras') || span.textContent.includes('Liste de Courses') || span.textContent.includes('Einkaufsliste') || span.textContent.includes('Lista de CumpÄƒrÄƒturi')) {
                span.textContent = t['shopping'];
            }
            if (span.textContent.includes('Negozi Vicini') || span.textContent.includes('Nearby Stores') || span.textContent.includes('Tiendas Cercanas') || span.textContent.includes('Magasins Proches') || span.textContent.includes('Nahe GeschÃ¤fte') || span.textContent.includes('Magazine Apropiate')) {
                span.textContent = t['stores'];
            }
            // Bottoni della dashboard - AGGIORNA QUESTA PARTE
            if (html.includes('Aggiungi Entrata') || html.includes('Add income') || html.includes('AÃ±adir ingreso') || html.includes('Ajouter un revenu') || html.includes('Einkommen hinzufÃ¼gen') || html.includes('AdaugÄƒ venit')) {
                button.innerHTML = `<i class="fas fa-plus"></i> ${t['add-income']}`;
            }
            if (html.includes('Aggiungi Uscita') || html.includes('Add expense') || html.includes('AÃ±adir gasto') || html.includes('Ajouter une dÃ©pense') || html.includes('Ausgabe hinzufÃ¼gen') || html.includes('AdaugÄƒ cheltuialÄƒ')) {
                button.innerHTML = `<i class="fas fa-plus"></i> ${t['add-expense']}`;
            }   
        });
    });
    
    // 5. Testi dinamici
    const shoppingCount = shoppingList.filter(item => !item.checked).length;
const shoppingCountEl = document.getElementById('shopping-count');
if (shoppingCountEl) {
    const itemsText = t['items'] || 'articoli';
    shoppingCountEl.textContent = `${shoppingCount} ${itemsText}`;
}
    
    // 6. Placeholder
    const placeholders = document.querySelectorAll('input[placeholder]');
    placeholders.forEach(input => {
        const placeholder = input.getAttribute('placeholder');
        if (placeholder.includes('Cosa devi comprare') || placeholder.includes('What do you need to buy') || placeholder.includes('Â¿QuÃ© necesitas comprar') || placeholder.includes('Que devez-vous acheter') || placeholder.includes('Was mÃ¼ssen Sie kaufen') || placeholder.includes('Ce trebuie sÄƒ cumperi')) {
            input.placeholder = t['shopping-placeholder'];
        }
        // Placeholder per le schermate
        if (placeholder.includes('Stipendio, Bonus, Vendita') || placeholder.includes('Salary, Bonus, Sale') || placeholder.includes('Salario, Bono, Venta') || placeholder.includes('Salaire, Bonus, Vente') || placeholder.includes('Gehalt, Bonus, Verkauf') || placeholder.includes('Salariu, Bonus, VÃ¢nzare')) {
            input.placeholder = t['description-placeholder-income'] || 'Salary, Bonus, Sale...';
        }
        if (placeholder.includes('Cena, Benzina, Bolletta') || placeholder.includes('Dinner, Gas, Bill') || placeholder.includes('Cena, Gasolina, Factura') || placeholder.includes('DÃ®ner, Essence, Facture') || placeholder.includes('Abendessen, Benzin, Rechnung') || placeholder.includes('CinÄƒ, BenzinÄƒ, FacturÄƒ')) {
            input.placeholder = t['description-placeholder-expense'] || 'Dinner, Gas, Bill...';
        }
        if (placeholder.includes('Cosa devi comprare?') && t['shopping-placeholder']) {
        input.placeholder = t['shopping-placeholder'];
    }
});
    
    // 7. Imposta la lingua sul tag html
    document.documentElement.lang = lang;
    
    // 8. Aggiorna i testi dinamici delle transazioni
    updateRecentTransactionsText();
    
    console.log('âœ… Lingua applicata con successo:', lang);
        // 9. Traduci tutte le schermate
        translateAllScreens();
    
    console.log('âœ… Lingua applicata con successo:', lang);

    translateAllScreens();
    console.log('âœ… Lingua applicata e schermate tradotte');
    // ðŸ”´ AGGIUNGI QUI LA CHIAMATA PER I MENU A TENDINA
    translateCategoryDropdowns();
    translateSelectPlaceholders();  // <-- AGGIUNGI QUESTA RIGA
    // Alla fine di applyLanguageSettings(), PRIMA dell'ultima parentesi graffa
    fixBalanceTranslation();
    console.log('âœ… Lingua applicata e schermate tradotte');
}
// ==================== TRADUZIONE MENU A TENDINA ====================
function translateCategoryDropdowns() {
    const lang = userProfile?.language || 'it';
    const t = getTranslations(lang);
    
    console.log('ðŸ”„ Traduco menu a tendina categorie in:', lang);
    
    // Traduci menu entrate
    const incomeSelect = document.getElementById('income-category');
    if (incomeSelect) {
        Array.from(incomeSelect.options).forEach(option => {
            const key = option.getAttribute('data-translate');
            if (key && t[key]) {
                option.textContent = t[key];
            }
        });
        console.log('âœ… Menu entrate tradotto');
    }
    
    // Traduci menu uscite
    const expenseSelect = document.getElementById('expense-category');
    if (expenseSelect) {
        Array.from(expenseSelect.options).forEach(option => {
            const key = option.getAttribute('data-translate');
            if (key && t[key]) {
                option.textContent = t[key];
            }
        });
        console.log('âœ… Menu uscite tradotto');
    }
    
    // Traduci anche i menu dei budget se presenti
    const budgetCategorySelects = document.querySelectorAll('[id^="budget-category-"]');
    budgetCategorySelects.forEach(select => {
        Array.from(select.options).forEach(option => {
            const key = option.getAttribute('data-translate');
            if (key && t[key]) {
                option.textContent = t[key];
            }
        });
    });
}
// ==================== TRADUZIONE PLACEHOLDER SELECT ====================
function translateSelectPlaceholders() {
    const lang = userProfile?.language || 'it';
    const t = getTranslations(lang);
    
    // Traduci il placeholder del select entrate
    const incomeSelect = document.getElementById('income-category');
    if (incomeSelect && t['select-category']) {
        // Se vuoi un'opzione placeholder "Seleziona categoria"
        const placeholderOption = incomeSelect.querySelector('option[value=""]');
        if (placeholderOption) {
            placeholderOption.textContent = t['select-category'];
        }
    }
    
    // Traduci il placeholder del select uscite
    const expenseSelect = document.getElementById('expense-category');
    if (expenseSelect && t['select-category']) {
        const placeholderOption = expenseSelect.querySelector('option[value=""]');
        if (placeholderOption) {
            placeholderOption.textContent = t['select-category'];
        }
    }
}

// ==================== TRADUZIONE COMPLETA INTERFACCIA ====================
function translateAllScreens() {
    const lang = userProfile?.language || 'it';
    const t = getTranslations(lang);
    
    console.log('ðŸŒ Traduco interfaccia in:', lang);
    
    // DEBUG - Controllo schermate
    console.log('screen-add-income:', document.getElementById('screen-add-income') ? 'TROVATO' : 'NON TROVATO');
    console.log('screen-add-expense:', document.getElementById('screen-add-expense') ? 'TROVATO' : 'NON TROVATO');
    console.log('screen-shopping:', document.getElementById('screen-shopping') ? 'TROVATO' : 'NON TROVATO');
    console.log('screen-budget:', document.getElementById('screen-budget') ? 'TROVATO' : 'NON TROVATO');
    
    // ===== SCHERMATA NUOVA ENTRATA =====
    const incomeScreen = document.getElementById('screen-add-income');
    if (incomeScreen) {
        // Titolo - FORZA MODIFICA
        const title = incomeScreen.querySelector('h2.text-xl');
        if (title) {
            title.innerHTML = `<i class="fas fa-money-bill-wave text-green-500 mr-2"></i>${t['new-income'] || 'NUOVA ENTRATA'}`;
            console.log('âœ… Titolo entrata modificato:', title.innerHTML);
        }
        
        // Sottotitolo
        const subtitle = incomeScreen.querySelector('p.text-gray-500.mb-6');
        if (subtitle) subtitle.textContent = t['register-income'] || 'Registra una nuova entrata';
        
        // Placeholder
        const descInput = incomeScreen.querySelector('#income-desc');
        if (descInput) descInput.placeholder = t['description-placeholder-income'] || 'Stipendio, Bonus, Vendita...';
        
        // Bottone salva
        const saveBtn = incomeScreen.querySelector('button.btn-income');
        if (saveBtn) saveBtn.innerHTML = `<i class="fas fa-save mr-2"></i>${t['save-income'] || 'Salva Entrata'}`;
        
        // Bottone annulla
        const cancelBtn = incomeScreen.querySelector('button.bg-gray-200');
        if (cancelBtn) cancelBtn.innerHTML = `${t['cancel'] || 'Annulla'}`;
        
        // Bottone back
        const backBtn = incomeScreen.querySelector('button.flex.items-center.gap-2');
        if (backBtn) backBtn.innerHTML = `<i class="fas fa-arrow-left"></i> ${t['back-to-dashboard'] || 'Torna alla Dashboard'}`;
    }
    
    // ===== SCHERMATA NUOVA USCITA =====
    const expenseScreen = document.getElementById('screen-add-expense');
    if (expenseScreen) {
        // Titolo
        const title = expenseScreen.querySelector('h2.text-xl');
        if (title) {
            title.innerHTML = `<i class="fas fa-receipt text-red-500 mr-2"></i>${t['new-expense'] || 'NUOVA USCITA'}`;
            console.log('âœ… Titolo uscita modificato:', title.innerHTML);
        }
        
        // Sottotitolo
        const subtitle = expenseScreen.querySelector('p.text-gray-500.mb-6');
        if (subtitle) subtitle.textContent = t['register-expense'] || 'Registra una nuova spesa';
        
        // Placeholder
        const descInput = expenseScreen.querySelector('#expense-desc');
        if (descInput) descInput.placeholder = t['description-placeholder-expense'] || 'Cena, Benzina, Bolletta...';
        
        // Bottone salva
        const saveBtn = expenseScreen.querySelector('button.btn-expense');
        if (saveBtn) saveBtn.innerHTML = `<i class="fas fa-save mr-2"></i>${t['save-expense'] || 'Salva Uscita'}`;
        
        // Bottone back
        const backBtn = expenseScreen.querySelector('button.flex.items-center.gap-2');
        if (backBtn) backBtn.innerHTML = `<i class="fas fa-arrow-left"></i> ${t['back-to-dashboard'] || 'Torna alla Dashboard'}`;
    }
    
    // ===== SCHERMATA LISTA SPESA =====
const shoppingScreen = document.getElementById('screen-shopping');
if (shoppingScreen) {
    // Titolo principale
    const title = shoppingScreen.querySelector('.bg-white.rounded-xl.shadow.p-6 h2.text-xl');
    if (title) {
        title.innerHTML = `<i class="fas fa-shopping-basket text-green-500 mr-2"></i>${t['shopping-list'] || 'LISTA SPESA'}`;
        console.log('âœ… Titolo lista spesa modificato:', title.innerHTML);
    }
    
    // Placeholder input
    const input = shoppingScreen.querySelector('#shopping-item');
    if (input) input.placeholder = t['shopping-placeholder'] || 'Cosa devi comprare?';
    
    // ðŸ”¥ NUOVO: Titolo Ottimizza Acquisti
    const optimizeTitle = shoppingScreen.querySelector('#optimization-section h3');
    if (optimizeTitle) {
        optimizeTitle.innerHTML = `<i class="fas fa-chart-line text-purple-500 mr-2"></i>${t['optimize-purchases'] || 'OTTIMIZZA ACQUISTI'}`;
        console.log('âœ… Titolo ottimizzazione modificato:', optimizeTitle.innerHTML);
    }
    
    // ðŸ”¥ NUOVO: Card ottimizzazione - TITOLI
    const cardTitles = shoppingScreen.querySelectorAll('.optimization-card p.font-bold');
    if (cardTitles.length >= 3) {
        if (cardTitles[0]) cardTitles[0].textContent = t['lowest-price'] || 'Prezzo piÃ¹ basso';
        if (cardTitles[1]) cardTitles[1].textContent = t['fewest-stores'] || 'Meno negozi';
        if (cardTitles[2]) cardTitles[2].textContent = t['optimized'] || 'Ottimizzato';
        console.log('âœ… Card ottimizzazione titoli modificati');
    }
    
    // ðŸ”¥ NUOVO: Card ottimizzazione - DESCRIZIONI
    const cardDescs = shoppingScreen.querySelectorAll('.optimization-card p.text-sm');
    if (cardDescs.length >= 3) {
        if (cardDescs[0]) cardDescs[0].textContent = t['min-total'] || 'Spesa minima totale';
        if (cardDescs[1]) cardDescs[1].textContent = t['fewer-stores'] || 'Visita meno punti vendita';
        if (cardDescs[2]) cardDescs[2].textContent = t['price-stores-balanced'] || 'Prezzo e negozi bilanciati';
        console.log('âœ… Card ottimizzazione descrizioni modificate');
    }
    
    // ðŸ”¥ NUOVO: Titolo Negozi Vicini
    const storesTitle = shoppingScreen.querySelector('.bg-white.rounded-xl.shadow.p-6 h2:not(.text-xl)');
    if (storesTitle) {
        storesTitle.innerHTML = `<i class="fas fa-store text-blue-500 mr-2"></i>${t['nearby-stores'] || 'NEGOZI VICINI'}`;
        console.log('âœ… Titolo negozi vicini modificato:', storesTitle.innerHTML);
    }
    
    // ðŸ”¥ NUOVO: Bottone Cerca Negozi
    const searchBtn = shoppingScreen.querySelector('#search-stores-btn');
    if (searchBtn) {
        searchBtn.innerHTML = `<i class="fas fa-search mr-2"></i>${t['find-nearby-stores'] || 'Cerca Negozi Vicini'}`;
        console.log('âœ… Bottone cerca negozi modificato');
    }
    
    // Bottone back
    const backBtn = shoppingScreen.querySelector('button.flex.items-center.gap-2');
    if (backBtn) backBtn.innerHTML = `<i class="fas fa-arrow-left"></i> ${t['back-to-dashboard'] || 'Torna alla Dashboard'}`;
}
// ===== SCHERMATA SCELTA TIPO USCITA =====
const choiceScreen = document.getElementById('screen-expense-choice');
if (choiceScreen) {
    const title = choiceScreen.querySelector('h2.text-xl');
    if (title) {
        title.innerHTML = `<i class="fas fa-shopping-cart text-red-500 mr-2"></i>${t['add-expense'] || 'Aggiungi Uscita'}`;
        console.log('âœ… Titolo scelta uscita modificato:', title.innerHTML);
    }
    
    const subtitle = choiceScreen.querySelector('p.text-gray-500.mb-8');
    if (subtitle) subtitle.textContent = t['choose-expense-type'] || 'Cosa vuoi aggiungere?';
    
    // Bottone Lista Spesa
    const shoppingBtn = choiceScreen.querySelector('button[onclick*="showScreen(\'shopping\')"] p.font-bold');
    if (shoppingBtn) shoppingBtn.textContent = t['shopping-list'] || 'Lista della Spesa';
    
    // Bottone Uscita Generica
    const expenseBtn = choiceScreen.querySelector('button[onclick*="showScreen(\'add-expense\')"] p.font-bold');
    if (expenseBtn) expenseBtn.textContent = t['generic-expense'] || 'Uscita Generica';
    
    const backBtn = choiceScreen.querySelector('button.flex.items-center.gap-2');
    if (backBtn) backBtn.innerHTML = `<i class="fas fa-arrow-left"></i> ${t['back-to-dashboard'] || 'Torna alla Dashboard'}`;
}
    
    // ===== SCHERMATA BUDGET =====
    const budgetScreen = document.getElementById('screen-budget');
    if (budgetScreen) {
        const title = budgetScreen.querySelector('h2.text-xl');
        if (title) {
            title.innerHTML = `<i class="fas fa-piggy-bank text-purple-500 mr-2"></i>${t['budget-management'] || 'GESTIONE BUDGET'}`;
            console.log('âœ… Titolo budget modificato:', title.innerHTML);
        }
        
        const subtitle = budgetScreen.querySelector('p.text-gray-500.mb-6');
        if (subtitle) subtitle.textContent = t['set-monthly-budgets'] || 'Imposta i budget mensili per categoria';
        
        const button = budgetScreen.querySelector('button.w-full.py-3');
        if (button) button.innerHTML = `<i class="fas fa-check mr-2"></i>${t['confirm-budget'] || 'Conferma Budget'}`;
        
        const backBtn = budgetScreen.querySelector('button.flex.items-center.gap-2');
        if (backBtn) backBtn.innerHTML = `<i class="fas fa-arrow-left"></i> ${t['back-to-dashboard'] || 'Torna alla Dashboard'}`;
    }
    
    // ===== SCHERMATA PROFILO =====
const profileScreen = document.getElementById('screen-profile');
if (profileScreen) {
    // Titolo principale
    const title = profileScreen.querySelector('h2.text-xl');
    if (title) {
        title.innerHTML = `<i class="fas fa-user text-blue-500 mr-2"></i>${t['your-profile'] || 'IL TUO PROFILO'}`;
        console.log('âœ… Titolo profilo modificato:', title.innerHTML);
    }
    
    // Sottotitolo
    const subtitle = profileScreen.querySelector('p.text-gray-500.mb-6');
    if (subtitle) subtitle.textContent = t['configure-data'] || 'Configura i tuoi dati per un\'esperienza personalizzata';
    
    // ðŸ”¥ TRADUCI TUTTE LE ETICHETTE DEI CAMPI
    const labels = profileScreen.querySelectorAll('label');
    labels.forEach(label => {
        const text = label.textContent.trim();
        
        // Dati Personali
        if (text.includes('Nome') || text.includes('First Name') || text.includes('Prenume')) {
            label.textContent = t['name'] + ' *';
        }
        else if (text.includes('Cognome') || text.includes('Last Name') || text.includes('Nume')) {
            label.textContent = t['surname'] + ' *';
        }
        else if (text.includes('Email')) {
            label.textContent = t['email'] + ' *';
        }
        
        // Indirizzo Casa
        else if (text.includes('Via') || text.includes('Street') || text.includes('StradÄƒ')) {
            label.textContent = t['street'] + ' *';
        }
        else if (text.includes('Numero') || text.includes('Number') || text.includes('NumÄƒr')) {
            label.textContent = t['number'] + ' *';
        }
        else if (text.includes('CittÃ ') || text.includes('City') || text.includes('OraÈ™')) {
            label.textContent = t['city'] + ' *';
        }
        else if (text.includes('Provincia') || text.includes('Province') || text.includes('Provincie')) {
            label.textContent = t['province'] + ' *';
        }
        else if (text.includes('Paese') || text.includes('Country') || text.includes('ÈšarÄƒ')) {
            label.textContent = t['country'] + ' *';
        }
        
        // Indirizzo Lavoro
        else if (text.includes('Via') && text.includes('Lavoro')) {
            label.textContent = t['street'];
        }
        else if (text.includes('Numero') && text.includes('Lavoro')) {
            label.textContent = t['number'];
        }
        else if (text.includes('CittÃ ') && text.includes('Lavoro')) {
            label.textContent = t['city'];
        }
        else if (text.includes('Provincia') && text.includes('Lavoro')) {
            label.textContent = t['province'];
        }
        else if (text.includes('Paese') && text.includes('Lavoro')) {
            label.textContent = t['country'];
        }
        else if (text.includes('Nome Azienda') || text.includes('Company') || text.includes('Companie')) {
            label.textContent = t['company'];
        }
        
        // Preferenze Internazionali
        else if (text.includes('Lingua Preferita') || text.includes('Preferred Language') || text.includes('Limba PreferatÄƒ')) {
            label.innerHTML = `<i class="fas fa-language mr-1"></i>${t['preferred-language']} *`;
        }
        else if (text.includes('Valuta Predefinita') || text.includes('Default Currency') || text.includes('Moneda ImplicitÄƒ')) {
            label.innerHTML = `<i class="fas fa-money-bill-wave mr-1"></i>${t['default-currency']} *`;
        }
    });
    
    // ðŸ”¥ TRADUCI I TITOLI DELLE SEZIONI
    const sectionTitles = profileScreen.querySelectorAll('h3.text-lg');
    sectionTitles.forEach(section => {
        const html = section.innerHTML;
        if (html.includes('Dati Personali') || html.includes('Personal Data') || html.includes('Date Personale')) {
            section.innerHTML = `<i class="fas fa-id-card mr-2"></i>${t['personal-data']}`;
        }
        else if (html.includes('Indirizzo di Casa') || html.includes('Home Address') || html.includes('Adresa de Domiciliu')) {
            section.innerHTML = `<i class="fas fa-home mr-2"></i>${t['home-address']}`;
        }
        else if (html.includes('Indirizzo di Lavoro') || html.includes('Work Address') || html.includes('Adresa de MuncÄƒ')) {
            section.innerHTML = `<i class="fas fa-briefcase mr-2"></i>${t['work-address']}`;
        }
        else if (html.includes('Preferenze Internazionali') || html.includes('International Preferences') || html.includes('PreferinÈ›e InternaÈ›ionale')) {
            section.innerHTML = `<i class="fas fa-globe mr-2"></i>${t['international-preferences']}`;
        }
    });
    
    // ðŸ”¥ TRADUCI I BOTTONI
    const buttons = profileScreen.querySelectorAll('button');
    buttons.forEach(button => {
        const html = button.innerHTML;
        if (html.includes('Salva Profilo') || html.includes('Save Profile') || html.includes('SalveazÄƒ Profil')) {
            button.innerHTML = `<i class="fas fa-save"></i> ${t['save-profile'] || 'Save Profile'}`;
        }
        else if (html.includes('Annulla') || html.includes('Cancel') || html.includes('AnuleazÄƒ')) {
            button.innerHTML = `<i class="fas fa-times"></i> ${t['cancel'] || 'Cancel'}`;
        }
        else if (html.includes('Torna alla Dashboard') || html.includes('Back to Dashboard') || html.includes('ÃŽnapoi la Tablou de bord')) {
            button.innerHTML = `<i class="fas fa-arrow-left"></i> ${t['back-to-dashboard'] || 'Back to Dashboard'}`;
        }
    });
    
    // ðŸ”¥ TRADUCI L'ANTEPRIMA VALUTA
    const previewLabel = profileScreen.querySelector('#currency-preview p.text-sm');
    if (previewLabel && t['formatting-preview']) {
        previewLabel.textContent = t['formatting-preview'] + ':';
    }
    
    console.log('âœ… Profilo tradotto completamente');
}
    
    // ===== SCHERMATA TRANSAZIONI =====
    const transactionsScreen = document.getElementById('screen-transactions');
    if (transactionsScreen) {
        const title = transactionsScreen.querySelector('h2.text-xl');
        if (title) {
            title.innerHTML = `<i class="fas fa-exchange-alt mr-2"></i>${t['all-transactions'] || 'TUTTE LE TRANSAZIONI'}`;
            console.log('âœ… Titolo transazioni modificato:', title.innerHTML);
        }
        
        const backBtn = transactionsScreen.querySelector('button.flex.items-center.gap-2');
        if (backBtn) backBtn.innerHTML = `<i class="fas fa-arrow-left"></i> ${t['back-to-dashboard'] || 'Torna alla Dashboard'}`;
    }
    
    console.log('âœ… Traduzione completata');
}

// Funzione helper per ottenere le traduzioni
// Funzione helper per ottenere le traduzioni
// Funzione helper per ottenere le traduzioni
function getTranslations(lang) {
    const translations = {
        'it': {
            'shopping-list': 'Lista della Spesa',
            'shopping-placeholder': 'Cosa devi comprare?',
            'optimize-purchases': 'Ottimizza Acquisti',
            'lowest-price': 'Prezzo piÃ¹ basso',
            'fewest-stores': 'Meno negozi',
            'optimized': 'Ottimizzato',
            'nearby-stores': 'Negozi Vicini',
            'find-nearby-stores': 'Cerca Negozi Vicini',
            'budget-management': 'Gestione Budget',
            'set-monthly-budgets': 'Imposta i budget mensili per categoria',
            'confirm-budget': 'Conferma Budget',
            'your-profile': 'Il Tuo Profilo',
            'configure-data': 'Configura i tuoi dati per un\'esperienza personalizzata',
            'all-transactions': 'Tutte le Transazioni',
            'new-income': 'Nuova Entrata',
            'register-income': 'Registra una nuova entrata',
            'new-expense': 'Nuova Uscita',
            'register-expense': 'Registra una nuova spesa',
            'save-income': 'Salva Entrata',
            'save-expense': 'Salva Uscita',
            'description-placeholder-income': 'Stipendio, Bonus, Vendita...',
            'description-placeholder-expense': 'Cena, Benzina, Bolletta...',
            'cancel': 'Annulla',
            'back-to-dashboard': 'Torna alla Dashboard',
            'min-total': 'Spesa minima totale',
            'fewer-stores': 'Visita meno punti vendita',
            'price-stores-balanced': 'Prezzo e negozi bilanciati',
            'choose-expense-type': 'Cosa vuoi aggiungere?',
            'generic-expense': 'Uscita Generica',
            'add-expense': 'Aggiungi Uscita',
            'back-to-choice': 'Torna alla scelta',
            'save-profile': 'Salva Profilo',
            'email': 'Email',
            'price-button': 'Prezzi',
            'duplicate-product': 'Prodotto Duplicato',
            'check-product': 'Controlla il Prodotto',
            'you-entered': 'Hai inserito:',
            'already-in-list': 'Questo prodotto Ã¨ giÃ  nella lista!',
            'add-anyway': 'Aggiungi comunque (duplicato)',
            'cancel': 'Annulla',
            'perhaps-you-meant': 'Forse intendevi:',
            'use-as-is': 'Usa "{product}" cosÃ¬ com\'Ã¨',
            'product-not-recognized': 'Prodotto non riconosciuto',
            'not-in-database': '"{product}" non Ã¨ nel nostro database. VerrÃ  aggiunto con prezzo di default.',
            'add-product': 'Aggiungi "{product}"',
            'edit': 'Modifica',
            'close': 'Chiudi',
            'duplicate-product': 'Produs Duplicat',
            'check-product': 'VerificÄƒ Produsul',
            'you-entered': 'Ai introdus:',
            'already-in-list': 'Acest produs este deja Ã®n listÄƒ!',
            'add-anyway': 'AdaugÄƒ oricum (duplicat)',
            'perhaps-you-meant': 'Poate ai vrut sÄƒ spui:',
            'use-as-is': 'FoloseÈ™te "{product}" aÈ™a cum este',
            'product-not-recognized': 'Produs nerecunoscut',
            'not-in-database': '"{product}" nu este Ã®n baza noastrÄƒ de date. Va fi adÄƒugat cu preÈ› implicit.',
            'add-product': 'AdaugÄƒ "{product}"',
            'edit': 'EditeazÄƒ',
            'close': 'ÃŽnchide',
            'balance': 'Saldo',
            'set-address-message': 'Imposta il tuo indirizzo nel profilo per trovare negozi',
            'name': 'Nome',
            'surname': 'Cognome',
            'email': 'Email',
            'street': 'Via',
            'number': 'Numero',
            'city': 'CittÃ ',
            'province': 'Provincia',
            'country': 'Paese',
            'company': 'Nome Azienda',
            'personal-data': 'Dati Personali',
            'home-address': 'Indirizzo di Casa',
            'work-address': 'Indirizzo di Lavoro',
            'international-preferences': 'Preferenze Internazionali',
            'preferred-language': 'Lingua Preferita',
            'default-currency': 'Valuta Predefinita',
            'formatting-preview': 'Anteprima formattazione',
            'save-profile': 'Salva Profilo',
            'salary': 'Stipendio',
            'bonus': 'Bonus',
            'investments': 'Investimenti',
            'rental-income': 'Rendite',
            'food': 'Alimentari',
            'utilities': 'Bollette',
            'transport': 'Trasporti',
            'entertainment': 'Svago',
            'health': 'Salute',
            'shopping': 'Shopping',
            'rent': 'Affitto',
            'mortgage': 'Mutuo',  // NUOVA!
            'select-category': 'Seleziona categoria',  // per IT
            'first-name': 'Nome',           // per IT
            'last-name': 'Cognome',         // per IT
            'used-for-stores': 'Usato per trovare negozi',  // per IT
            'optional': 'Facoltativo',      // per IT
            'amount-with-currency': 'Importo (â‚¬)', // per IT
            'income-placeholder': 'Stipendio, Bonus, Vendita...', // per IT
            'other': 'Altro',
        },
        'en': {
            'shopping-list': 'Shopping List',
            'shopping-placeholder': 'What do you need to buy?',
            'optimize-purchases': 'Optimize Purchases',
            'lowest-price': 'Lowest price',
            'fewest-stores': 'Fewest stores',
            'optimized': 'Optimized',
            'nearby-stores': 'Nearby Stores',
            'find-nearby-stores': 'Find Nearby Stores',
            'budget-management': 'Budget Management',
            'set-monthly-budgets': 'Set monthly budgets by category',
            'confirm-budget': 'Confirm Budget',
            'your-profile': 'Your Profile',
            'configure-data': 'Configure your data for a personalized experience',
            'all-transactions': 'All Transactions',
            'new-income': 'New Income',
            'register-income': 'Register a new income',
            'new-expense': 'New Expense',
            'register-expense': 'Register a new expense',
            'save-income': 'Save Income',
            'save-expense': 'Save Expense',
            'description-placeholder-income': 'Salary, Bonus, Sale...',
            'description-placeholder-expense': 'Dinner, Gas, Bill...',
            'cancel': 'Cancel',
            'back-to-dashboard': 'Back to Dashboard',
            'min-total': 'Minimum total expense',
            'fewer-stores': 'Visit fewer stores',
            'price-stores-balanced': 'Price and stores balanced',
            'choose-expense-type': 'What do you want to add?',
            'generic-expense': 'Generic Expense',
            'add-expense': 'Add Expense',
            'back-to-choice': 'Back to choice',
            'save-profile': 'Save Profile',
            'email': 'Email',
            'price-button': 'Prices',
            'duplicate-product': 'Duplicate Product',
            'check-product': 'Check Product',
            'you-entered': 'You entered:',
            'already-in-list': 'This product is already in the list!',
            'add-anyway': 'Add anyway (duplicate)',
            'cancel': 'Cancel',
            'perhaps-you-meant': 'Perhaps you meant:',
            'use-as-is': 'Use "{product}" as is',
            'product-not-recognized': 'Product not recognized',
            'not-in-database': '"{product}" is not in our database. It will be added with default price.',
            'add-product': 'Add "{product}"',
            'edit': 'Edit',
            'close': 'Close',
            'balance': 'Balance',
            'set-address-message': 'Set your address in the profile to find stores',
            'name': 'First Name',
            'surname': 'Last Name',
            'email': 'Email',
            'street': 'Street',
            'number': 'Number',
            'city': 'City',
            'province': 'Province',
            'country': 'Country',
            'company': 'Company Name',
            'personal-data': 'Personal Data',
            'home-address': 'Home Address',
            'work-address': 'Work Address',
            'international-preferences': 'International Preferences',
            'preferred-language': 'Preferred Language',
            'default-currency': 'Default Currency',
            'formatting-preview': 'Formatting preview',
            'save-profile': 'Save Profile',
            'salary': 'Salary',
            'bonus': 'Bonus',
            'investments': 'Investments',
            'rental-income': 'Rental Income',
            'food': 'Food',
            'utilities': 'Utilities',
            'transport': 'Transport',
            'entertainment': 'Entertainment',
            'health': 'Health',
            'shopping': 'Shopping',
            'rent': 'Rent',
            'mortgage': 'Mortgage',  // NUOVA!
            'select-category': 'Select category',      // per EN
            'first-name': 'First Name',     // per EN
            'last-name': 'Last Name',       // per EN
            'used-for-stores': 'Used to find stores',       // per EN
            'optional': 'Optional',         // per EN
            'amount-with-currency': 'Amount (â‚¬)',  // per EN
            'income-placeholder': 'Salary, Bonus, Sale...',       // per EN
            'other': 'Other',
        },
        'es': {
            'shopping-list': 'Lista de Compras',
            'shopping-placeholder': 'Â¿QuÃ© necesitas comprar?',
            'optimize-purchases': 'Optimizar Compras',
            'lowest-price': 'Precio mÃ¡s bajo',
            'fewest-stores': 'Menos tiendas',
            'optimized': 'Optimizado',
            'nearby-stores': 'Tiendas Cercanas',
            'find-nearby-stores': 'Buscar Tiendas Cercanas',
            'budget-management': 'GestiÃ³n de Presupuesto',
            'set-monthly-budgets': 'Establece presupuestos mensuales por categorÃ­a',
            'confirm-budget': 'Confirmar Presupuesto',
            'your-profile': 'Tu Perfil',
            'configure-data': 'Configura tus datos para una experiencia personalizada',
            'all-transactions': 'Todas las Transacciones',
            'new-income': 'Nuevo Ingreso',
            'register-income': 'Registra un nuevo ingreso',
            'new-expense': 'Nuevo Gasto',
            'register-expense': 'Registra un nuevo gasto',
            'save-income': 'Guardar Ingreso',
            'save-expense': 'Guardar Gasto',
            'description-placeholder-income': 'Salario, Bono, Venta...',
            'description-placeholder-expense': 'Cena, Gasolina, Factura...',
            'cancel': 'Cancelar',
            'back-to-dashboard': 'Volver al Panel',
            'min-total': 'Gasto mÃ­nimo total',
            'fewer-stores': 'Visita menos tiendas',
            'price-stores-balanced': 'Precio y tiendas equilibrados',
            'choose-expense-type': 'Â¿QuÃ© quieres aÃ±adir?',
            'generic-expense': 'Gasto GenÃ©rico',
            'add-expense': 'AÃ±adir Gasto',
            'back-to-choice': 'Volver a la selecciÃ³n',
            'save-profile': 'Guardar Perfil',
            'email': 'Correo electrÃ³nico',
            'price-button': 'Precios',
            'duplicate-product': 'Producto Duplicado',
            'check-product': 'Verificar Producto',
            'you-entered': 'Has introducido:',
            'already-in-list': 'Â¡Este producto ya estÃ¡ en la lista!',
            'add-anyway': 'AÃ±adir de todos modos (duplicado)',
            'cancel': 'Cancelar',
            'perhaps-you-meant': 'QuizÃ¡s quisiste decir:',
            'use-as-is': 'Usar "{product}" tal cual',
            'product-not-recognized': 'Producto no reconocido',
            'not-in-database': '"{product}" no estÃ¡ en nuestra base de datos. Se aÃ±adirÃ¡ con precio por defecto.',
            'add-product': 'AÃ±adir "{product}"',
            'edit': 'Editar',
            'close': 'Cerrar',
            'balance': 'Saldo',
            'set-address-message': 'Configura tu direcciÃ³n en el perfil para encontrar tiendas',
            'name': 'Nombre',
            'surname': 'Apellido',
            'email': 'Correo electrÃ³nico',
            'street': 'Calle',
            'number': 'NÃºmero',
            'city': 'Ciudad',
            'province': 'Provincia',
            'country': 'PaÃ­s',
            'company': 'Nombre de la Empresa',
            'personal-data': 'Datos Personales',
            'home-address': 'DirecciÃ³n de Casa',
            'work-address': 'DirecciÃ³n de Trabajo',
            'international-preferences': 'Preferencias Internacionales',
            'preferred-language': 'Idioma Preferido',
            'default-currency': 'Moneda Predeterminada',
            'formatting-preview': 'Vista previa de formato',
            'save-profile': 'Guardar Perfil',
            'salary': 'Salario',
            'bonus': 'Bono',
            'investments': 'Inversiones',
            'rental-income': 'Ingresos por alquiler',
            'food': 'Alimentos',
            'utilities': 'Servicios',
            'transport': 'Transporte',
            'entertainment': 'Ocio',
            'health': 'Salud',
            'shopping': 'Compras',
            'rent': 'Alquiler',
            'mortgage': 'Hipoteca',  // NUOVA!
            'select-category': 'Seleccionar categorÃ­a', // per ES
            'select-category': 'Seleccionar categorÃ­a',
            'first-name': 'Nombre',
            'last-name': 'Apellido',
            'used-for-stores': 'Usado para encontrar tiendas',
            'optional': 'Opcional',
            'amount-with-currency': 'Importe (â‚¬)',
            'income-placeholder': 'Salario, Bono, Venta...',
            'expense-placeholder': 'Cena, Gasolina, Factura...',
            'other': 'Otro',
        },
        'fr': {
            'shopping-list': 'Liste de Courses',
            'shopping-placeholder': 'Que devez-vous acheter?',
            'optimize-purchases': 'Optimiser les Achats',
            'lowest-price': 'Prix le plus bas',
            'fewest-stores': 'Moins de magasins',
            'optimized': 'OptimisÃ©',
            'nearby-stores': 'Magasins Proches',
            'find-nearby-stores': 'Trouver des Magasins Proches',
            'budget-management': 'Gestion du Budget',
            'set-monthly-budgets': 'DÃ©finir les budgets mensuels par catÃ©gorie',
            'confirm-budget': 'Confirmer le Budget',
            'your-profile': 'Votre Profil',
            'configure-data': 'Configurez vos donnÃ©es pour une expÃ©rience personnalisÃ©e',
            'all-transactions': 'Toutes les Transactions',
            'new-income': 'Nouveau Revenu',
            'register-income': 'Enregistrer un nouveau revenu',
            'new-expense': 'Nouvelle DÃ©pense',
            'register-expense': 'Enregistrer une nouvelle dÃ©pense',
            'save-income': 'Enregistrer le Revenu',
            'save-expense': 'Enregistrer la DÃ©pense',
            'description-placeholder-income': 'Salaire, Bonus, Vente...',
            'description-placeholder-expense': 'DÃ®ner, Essence, Facture...',
            'cancel': 'Annuler',
            'back-to-dashboard': 'Retour au Tableau de bord',
            'min-total': 'DÃ©pense totale minimale',
            'fewer-stores': 'Visitez moins de magasins',
            'price-stores-balanced': 'Prix et magasins Ã©quilibrÃ©s',
            'choose-expense-type': 'Que voulez-vous ajouter?',
            'generic-expense': 'DÃ©pense GÃ©nÃ©rique',
            'add-expense': 'Ajouter une DÃ©pense',
            'back-to-choice': 'Retour au choix',
            'save-profile': 'Enregistrer le Profil',
            'email': 'Adresse e-mail',
            'price-button': 'Prix',
            'duplicate-product': 'Produit En Double',
            'check-product': 'VÃ©rifier le Produit',
            'you-entered': 'Vous avez saisi:',
            'already-in-list': 'Ce produit est dÃ©jÃ  dans la liste!',
            'add-anyway': 'Ajouter quand mÃªme (doublon)',
            'cancel': 'Annuler',
            'perhaps-you-meant': 'Peut-Ãªtre vouliez-vous dire:',
            'use-as-is': 'Utiliser "{product}" tel quel',
            'product-not-recognized': 'Produit non reconnu',
            'not-in-database': '"{product}" n\'est pas dans notre base de donnÃ©es. Il sera ajoutÃ© avec un prix par dÃ©faut.',
            'add-product': 'Ajouter "{product}"',
            'edit': 'Modifier',
            'close': 'Fermer',
            'balance': 'Solde',
            'set-address-message': 'Configurez votre adresse dans le profil pour trouver des magasins',
            'name': 'PrÃ©nom',
            'surname': 'Nom',
            'email': 'Adresse e-mail',
            'street': 'Rue',
            'number': 'NumÃ©ro',
            'city': 'Ville',
            'province': 'Province',
            'country': 'Pays',
            'company': "Nom de l'Entreprise",
            'personal-data': 'DonnÃ©es Personnelles',
            'home-address': 'Adresse du Domicile',
            'work-address': 'Adresse Professionnelle',
            'international-preferences': 'PrÃ©fÃ©rences Internationales',
            'preferred-language': 'Langue PrÃ©fÃ©rÃ©e',
            'default-currency': 'Devise par DÃ©faut',
            'formatting-preview': 'AperÃ§u du formatage',
            'save-profile': 'Enregistrer le Profil',
            'salary': 'Salaire',
            'bonus': 'Prime',
            'investments': 'Investissements',
            'rental-income': 'Revenus locatifs',
            'food': 'Alimentation',
            'utilities': 'Factures',
            'transport': 'Transport',
            'entertainment': 'Loisirs',
            'health': 'SantÃ©',
            'shopping': 'Achats',
            'rent': 'Loyer',
            'mortgage': 'PrÃªt immobilier',  // NUOVA!
            'select-category': 'SÃ©lectionner catÃ©gorie', // per FR
            'select-category': 'SÃ©lectionner catÃ©gorie',
            'first-name': 'PrÃ©nom',
            'last-name': 'Nom',
            'used-for-stores': 'UtilisÃ© pour trouver des magasins',
            'optional': 'Facultatif',
            'amount-with-currency': 'Montant (â‚¬)',
            'income-placeholder': 'Salaire, Bonus, Vente...',
            'expense-placeholder': 'DÃ®ner, Essence, Facture...',
            'other': 'Autre',
        },
        'de': {
            'shopping-list': 'Einkaufsliste',
            'shopping-placeholder': 'Was mÃ¼ssen Sie kaufen?',
            'optimize-purchases': 'EinkÃ¤ufe Optimieren',
            'lowest-price': 'Niedrigster Preis',
            'fewest-stores': 'Weniger GeschÃ¤fte',
            'optimized': 'Optimiert',
            'nearby-stores': 'Nahe GeschÃ¤fte',
            'find-nearby-stores': 'GeschÃ¤fte in der NÃ¤he finden',
            'budget-management': 'Budgetverwaltung',
            'set-monthly-budgets': 'Monatliche Budgets nach Kategorie festlegen',
            'confirm-budget': 'Budget BestÃ¤tigen',
            'your-profile': 'Ihr Profil',
            'configure-data': 'Konfigurieren Sie Ihre Daten fÃ¼r ein personalisiertes Erlebnis',
            'all-transactions': 'Alle Transaktionen',
            'new-income': 'Neue Einnahme',
            'register-income': 'Eine neue Einnahme erfassen',
            'new-expense': 'Neue Ausgabe',
            'register-expense': 'Eine neue Ausgabe erfassen',
            'save-income': 'Einnahme Speichern',
            'save-expense': 'Ausgabe Speichern',
            'description-placeholder-income': 'Gehalt, Bonus, Verkauf...',
            'description-placeholder-expense': 'Abendessen, Benzin, Rechnung...',
            'cancel': 'Abbrechen',
            'back-to-dashboard': 'ZurÃ¼ck zum Dashboard',
            'min-total': 'Minimale Gesamtausgaben',
            'fewer-stores': 'Besuchen Sie weniger GeschÃ¤fte',
            'price-stores-balanced': 'Preis und GeschÃ¤fte ausgeglichen',
            'choose-expense-type': 'Was mÃ¶chten Sie hinzufÃ¼gen?',
            'generic-expense': 'Allgemeine Ausgabe',
            'add-expense': 'Ausgabe HinzufÃ¼gen',
            'back-to-choice': 'ZurÃ¼ck zur Auswahl',
            'save-profile': 'Profil Speichern',
            'email': 'E-Mail-Adresse',
            'price-button': 'Preise',
            'duplicate-product': 'Doppeltes Produkt',
            'check-product': 'Produkt PrÃ¼fen',
            'you-entered': 'Sie haben eingegeben:',
            'already-in-list': 'Dieses Produkt ist bereits in der Liste!',
            'add-anyway': 'Trotzdem hinzufÃ¼gen (Duplikat)',
            'cancel': 'Abbrechen',
            'perhaps-you-meant': 'Vielleicht meinten Sie:',
            'use-as-is': '"{product}" wie es ist verwenden',
            'product-not-recognized': 'Produkt nicht erkannt',
            'not-in-database': '"{product}" ist nicht in unserer Datenbank. Es wird mit Standardpreis hinzugefÃ¼gt.',
            'add-product': '"{product}" hinzufÃ¼gen',
            'edit': 'Bearbeiten',
            'close': 'SchlieÃŸen',
            'balance': 'Kontostand',
            'set-address-message': 'Legen Sie Ihre Adresse im Profil fest, um GeschÃ¤fte zu finden',
            'name': 'Vorname',
            'surname': 'Nachname',
            'email': 'E-Mail-Adresse',
            'street': 'StraÃŸe',
            'number': 'Hausnummer',
            'city': 'Stadt',
            'province': 'Provinz',
            'country': 'Land',
            'company': 'Firmenname',
            'personal-data': 'PersÃ¶nliche Daten',
            'home-address': 'Heimatadresse',
            'work-address': 'GeschÃ¤ftsadresse',
            'international-preferences': 'Internationale PrÃ¤ferenzen',
            'preferred-language': 'Bevorzugte Sprache',
            'default-currency': 'StandardwÃ¤hrung',
            'formatting-preview': 'Formatierungsvorschau',
            'save-profile': 'Profil Speichern',
            'salary': 'Gehalt',
            'bonus': 'Bonus',
            'investments': 'Investitionen',
            'rental-income': 'Mieteinnahmen',
            'food': 'Lebensmittel',
            'utilities': 'Nebenkosten',
            'transport': 'Verkehr',
            'entertainment': 'Unterhaltung',
            'health': 'Gesundheit',
            'shopping': 'Einkaufen',
            'rent': 'Miete',
            'mortgage': 'Hypothek',  // NUOVA!
            'select-category': 'Kategorie auswÃ¤hlen',  // per DE
            'select-category': 'Kategorie auswÃ¤hlen',
            'first-name': 'Vorname',
            'last-name': 'Nachname',
            'used-for-stores': 'Verwendet, um GeschÃ¤fte zu finden',
            'optional': 'Optional',
            'amount-with-currency': 'Betrag (â‚¬)',
            'income-placeholder': 'Gehalt, Bonus, Verkauf...',
            'expense-placeholder': 'Abendessen, Benzin, Rechnung...',
            'other': 'Sonstiges',
        },
        'ro': {
            'shopping-list': 'Lista de CumpÄƒrÄƒturi',
            'shopping-placeholder': 'Ce trebuie sÄƒ cumperi?',
            'optimize-purchases': 'OptimizeazÄƒ AchiziÈ›ii',
            'lowest-price': 'Cel mai mic preÈ›',
            'fewest-stores': 'Mai puÈ›ine magazine',
            'optimized': 'Optimizat',
            'nearby-stores': 'Magazine Apropiate',
            'find-nearby-stores': 'GÄƒseÈ™te Magazine Apropiate',
            'budget-management': 'Gestionare Buget',
            'set-monthly-budgets': 'SeteazÄƒ bugete lunare pe categorii',
            'confirm-budget': 'ConfirmÄƒ Buget',
            'your-profile': 'Profilul TÄƒu',
            'configure-data': 'ConfigureazÄƒ-È›i datele pentru o experienÈ›Äƒ personalizatÄƒ',
            'all-transactions': 'Toate TranzacÈ›iile',
            'new-income': 'Venit Nou',
            'register-income': 'ÃŽnregistreazÄƒ un venit nou',
            'new-expense': 'CheltuialÄƒ NouÄƒ',
            'register-expense': 'ÃŽnregistreazÄƒ o cheltuialÄƒ nouÄƒ',
            'save-income': 'SalveazÄƒ Venit',
            'save-expense': 'SalveazÄƒ CheltuialÄƒ',
            'description-placeholder-income': 'Salariu, Bonus, VÃ¢nzare...',
            'description-placeholder-expense': 'CinÄƒ, BenzinÄƒ, FacturÄƒ...',
            'cancel': 'AnuleazÄƒ',
            'back-to-dashboard': 'ÃŽnapoi la Tablou de bord',
            'min-total': 'CheltuialÄƒ totalÄƒ minimÄƒ',
            'fewer-stores': 'ViziteazÄƒ mai puÈ›ine magazine',
            'price-stores-balanced': 'PreÈ› È™i magazine echilibrate',
            'choose-expense-type': 'Ce doreÈ™ti sÄƒ adaugi?',
            'generic-expense': 'CheltuialÄƒ GenericÄƒ',
            'add-expense': 'AdaugÄƒ CheltuialÄƒ',
            'back-to-choice': 'ÃŽnapoi la alegere',
            'save-profile': 'SalveazÄƒ Profil',
            'email': 'Email',
            'price-button': 'PreÈ›uri',
            'duplicate-product': 'Produs Duplicat',
            'check-product': 'VerificÄƒ Produsul',
            'you-entered': 'Ai introdus:',
            'already-in-list': 'Acest produs este deja Ã®n listÄƒ!',
            'add-anyway': 'AdaugÄƒ oricum (duplicat)',
            'cancel': 'AnuleazÄƒ',
            'perhaps-you-meant': 'Poate ai vrut sÄƒ spui:',
            'use-as-is': 'FoloseÈ™te "{product}" aÈ™a cum este',
            'product-not-recognized': 'Produs nerecunoscut',
            'not-in-database': '"{product}" nu este Ã®n baza noastrÄƒ de date. Va fi adÄƒugat cu preÈ› implicit.',
            'add-product': 'AdaugÄƒ "{product}"',
            'edit': 'EditeazÄƒ',
            'close': 'ÃŽnchide',
            'balance': 'Sold',
            'set-address-message': 'SeteazÄƒ adresa Ã®n profil pentru a gÄƒsi magazine',
            'name': 'Prenume',
            'surname': 'Nume',
            'email': 'Email',
            'street': 'StradÄƒ',
            'number': 'NumÄƒr',
            'city': 'OraÈ™',
            'province': 'Provincie',
            'country': 'ÈšarÄƒ',
            'company': 'Nume Companie',
            'personal-data': 'Date Personale',
            'home-address': 'Adresa de Domiciliu',
            'work-address': 'Adresa de MuncÄƒ',
            'international-preferences': 'PreferinÈ›e InternaÈ›ionale',
            'preferred-language': 'Limba PreferatÄƒ',
            'default-currency': 'Moneda ImplicitÄƒ',
            'formatting-preview': 'Previzualizare formatare',
            'save-profile': 'SalveazÄƒ Profil',
            'salary': 'Salariu',
            'bonus': 'Bonus',
            'investments': 'InvestiÈ›ii',
            'rental-income': 'Venituri din chirii',
            'food': 'Alimente',
            'utilities': 'UtilitÄƒÈ›i',
            'transport': 'Transport',
            'entertainment': 'Divertisment',
            'health': 'SÄƒnÄƒtate',
            'shopping': 'CumpÄƒrÄƒturi',
            'rent': 'Chirie',
            'mortgage': 'Credit ipotecar',  // NUOVA!
            'select-category': 'SelecteazÄƒ categoria', // per RO
            'select-category': 'SelecteazÄƒ categoria',
            'first-name': 'Prenume',
            'last-name': 'Nume',
            'used-for-stores': 'Folosit pentru a gÄƒsi magazine',
            'optional': 'OpÈ›ional',
            'amount-with-currency': 'SumÄƒ (â‚¬)',
            'income-placeholder': 'Salariu, Bonus, VÃ¢nzare...',
            'expense-placeholder': 'CinÄƒ, BenzinÄƒ, FacturÄƒ...',
            'other': 'Altele',
        }
    };
    
    return translations[lang] || translations['it'];
}

// Aggiungi questa funzione helper per aggiornare i testi delle transazioni
function updateRecentTransactionsText() {
    const recentTransactionsContainer = document.getElementById('recent-transactions');
    if (recentTransactionsContainer) {
        const noTransactionsText = recentTransactionsContainer.querySelector('p.text-gray-500');
        if (noTransactionsText && noTransactionsText.textContent.includes('Nessuna transazione')) {
            const lang = userProfile?.language || 'it';
            const translations = {
                'it': 'Nessuna transazione',
                'en': 'No transactions',
                'es': 'Sin transacciones',
                'fr': 'Aucune transaction',
                'de': 'Keine Transaktionen',
                'ro': 'FÄƒrÄƒ tranzacÈ›ii'
            };
            noTransactionsText.textContent = translations[lang] || translations['it'];
        }
    }
}

// ðŸ”´ AGGIUNGI QUI LA FUNZIONE ðŸ”´
function fixBalanceTranslation() {
    const balanceElement = document.querySelector('[data-translate="balance"]');
    if (balanceElement) {
        const lang = userProfile?.language || 'it';
        if (lang === 'it' || lang === 'ro') {
            balanceElement.textContent = 'Sold';
        } else if (lang === 'en') {
            balanceElement.textContent = 'Balance';
        } else if (lang === 'es') {
            balanceElement.textContent = 'Saldo';
        } else if (lang === 'fr') {
            balanceElement.textContent = 'Solde';
        } else if (lang === 'de') {
            balanceElement.textContent = 'Kontostand';
        }
        console.log('âœ… Balance tradotto in:', lang, balanceElement.textContent);
    }
}
// ==================== TEST TRADUZIONE ====================
function testTranslate() {
    console.log('ðŸ§ª TEST MANUALE TRADUZIONE');
    console.log('Lingua corrente:', userProfile?.language);
    console.log('userProfile esiste?', userProfile ? 'SI' : 'NO');
    
    // Forza traduzione
    translateAllScreens();
    
    showToast('ðŸ”„ Traduzione forzata');
}
    // ==================== INITIALIZE ====================
function initApp() {
    console.log('ðŸš€ === INIZIALIZZAZIONE APP ===');
    
    // ðŸ”¥ FUNZIONE PER RILEVARE LINGUA DISPOSITIVO
    function detectDeviceLanguage() {
        let deviceLang = navigator.language || navigator.userLanguage || 'en';
        deviceLang = deviceLang.split('-')[0];
        const supportedLangs = ['it', 'en', 'es', 'fr', 'de', 'ro'];
        return supportedLangs.includes(deviceLang) ? deviceLang : 'en';
    }
    
    let loadedProfile = null;
    let source = 'nessuno';
    
    // 1. CERCA NELL'ORDINE:
    
    // A) Variabile globale PRIMARIA (piÃ¹ affidabile)
    if (window.SMART_BILLING_USER_PROFILE) {
        loadedProfile = window.SMART_BILLING_USER_PROFILE;
        source = 'window.SMART_BILLING_USER_PROFILE';
        console.log('ðŸŽ¯ Profilo trovato in variabile globale primaria');
    }
    
    // B) Variabile globale userProfile (se esiste giÃ )
    else if (userProfile && userProfile.firstName) {
        loadedProfile = userProfile;
        source = 'variabile userProfile esistente';
        console.log('ðŸ“ Profilo trovato in variabile esistente');
    }
    
    // C) localStorage
    else {
        try {
            const localData = localStorage.getItem('smart_billing_profile_v2');
            if (localData) {
                loadedProfile = JSON.parse(localData);
                source = 'localStorage';
                console.log('ðŸ’¾ Profilo trovato in localStorage');
            }
        } catch (e) {
            console.log('âš ï¸ localStorage non accessibile');
        }
    }
    
    // 2. SE TROVATO, CARICALO
    if (loadedProfile) {
        userProfile = loadedProfile;
        console.log('âœ… PROFILO CARICATO da:', source);
        console.log('ðŸŒ Lingua:', userProfile.language);
        console.log('ðŸ’° Valuta:', userProfile.currency);
        console.log('ðŸ  Paese:', userProfile.homeCountry);
        applyLanguageSettings(); // <-- AGGIUNGI O VERIFICA CHE CI SIA

        // Assicurati che currencySymbol sia definito
        if (!userProfile.currencySymbol && userProfile.currency) {
            const currencyInfo = currencies[userProfile.currency];
            userProfile.currencySymbol = currencyInfo?.symbol || 'â‚¬';
            console.log('ðŸ”§ Symbol corretto:', userProfile.currencySymbol);
        }
    } else {
        console.log('âš ï¸ Nessun profilo trovato, uso impostazioni default');
        // ðŸ”¥ RILEVA LINGUA DISPOSITIVO
        const deviceLang = detectDeviceLanguage();
        userProfile.language = deviceLang;
        userProfile.currency = 'EUR';  // Default EURO
        userProfile.currencySymbol = 'â‚¬';
        userProfile.homeCountry = deviceLang === 'it' ? 'IT' : 
                                 deviceLang === 'ro' ? 'RO' : 
                                 deviceLang === 'es' ? 'ES' : 
                                 deviceLang === 'fr' ? 'FR' : 
                                 deviceLang === 'de' ? 'DE' : 'IT';
        console.log(`ðŸ“± Lingua dispositivo rilevata: ${deviceLang}`);
        console.log('ðŸ‡¬ðŸ‡§ Default: Inglese/Euro (se non supportato)');
    }
    
    // 3. Carica learnedCategories (semplificato)
    try {
        const catData = localStorage.getItem('learnedCategories') || sessionStorage.getItem('learnedCategories');
        if (catData) {
            learnedCategories = JSON.parse(catData);
            console.log('ðŸ“š Categorie imparate caricate');
        }
    } catch (e) {
        console.log('âš ï¸ Error caricamento categorie:', e);
        learnedCategories = {};
    }
    
    // 4. Event listeners per anteprima valuta
    setTimeout(() => {
        const currencySelect = document.getElementById('profile-currency');
        const languageSelect = document.getElementById('profile-language');
        
        if (currencySelect) {
            currencySelect.addEventListener('change', updateCurrencyPreview);
            console.log('ðŸŽ¯ Event listener currency aggiunto');
        }
        if (languageSelect) {
            languageSelect.addEventListener('change', updateCurrencyPreview);
            console.log('ðŸŽ¯ Event listener language aggiunto');
        }
        
        // Inizializza anteprima se in profilo
        if (document.getElementById('screen-profile')?.classList.contains('active')) {
            updateCurrencyPreview();
        }
    }, 300);
    
   // 5. Inizializza app
   console.log('ðŸ”„ Inizializzazione componenti...');
    updateDashboard();
    updateItemPrices();
    updateStoreProducts();
    
    console.log('âœ… APP INIZIALIZZATA');
    console.log('ðŸŒ LINGUA FINALE:', userProfile.language);
}
// Aggiungi dopo initApp() o prima del DOMContentLoaded
function debugProfile() {
    console.log('=== DEBUG PROFILO ===');
    console.log('1. userProfile globale:', userProfile);
    console.log('2. window.SMART_BILLING_USER_PROFILE:', window.SMART_BILLING_USER_PROFILE);
    console.log('3. localStorage:', localStorage.getItem('smart_billing_profile_v2'));
    console.log('4. Form values:');
    console.log('   - Nome:', document.getElementById('profile-firstname')?.value);
    console.log('   - Lingua:', document.getElementById('profile-language')?.value);
    console.log('   - Valuta:', document.getElementById('profile-currency')?.value);
    console.log('   - Paese:', document.getElementById('home-country')?.value);
}
    document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>