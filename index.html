async function addShoppingItemInternal(name, quantity = 1, selectedStore = null, forceAdd = false) {
        console.log('4Ô∏è‚É£ addShoppingItemInternal chiamata con', name, quantity, selectedStore);
    const input = document.getElementById('shopping-item');
    const itemName = name || input.value.trim();
    
    if (!itemName) {
        showToast('‚ö†Ô∏è Inserisci un nome per l\'articolo');
        return;
    }
    
    if (!forceAdd && checkDuplicate(itemName)) {
        showProductSuggestionModal(itemName, [], true);
        return;
    }
    
    const suggestions = findSuggestions(itemName);
    console.log('üîç Suggerimenti per', itemName, ':', suggestions);

    // üî• BLOCCA PAROLE NON RICONOSCIUTE
    if (suggestions.length === 0) {
        console.log('‚ùå Nessun suggerimento -> BLOCCATO');
        showToast('‚ö†Ô∏è Prodotto non riconosciuto. Usa un nome valido.');
        return;  // <-- BLOCCA SENZA APRIRE MODAL
    }

    if (suggestions[0].confidence < 60) {  // Soglia abbassata a 60
        console.log('‚ö†Ô∏è Confidence bassa -> mostro modal con suggerimenti');
        showProductSuggestionModal(itemName, suggestions, false);
        return;
    }
    
    showToast('üîç Cerco il miglior prezzo...');
    
    let bestPrice;
    if (selectedStore) {
        bestPrice = await getBestPrice(itemName, selectedStore);
    } else {
        bestPrice = await getBestPrice(itemName);
    }
    
    shoppingList.push({
        id: Date.now(),
        name: itemName,
        quantity: quantity,
        checked: false,
        bestPrice: bestPrice.price,
        bestStore: bestPrice.store,
        selectedStore: selectedStore || bestPrice.store,
        prices: [bestPrice],
        recognized: true,
        source: bestPrice.source,
        confidence: bestPrice.confidence
    });
    
    input.value = '';
    renderShoppingList();
    
    const confidenceIcon = bestPrice.confidence > 0.8 ? '‚úÖ' : '‚ö†Ô∏è';
    showToast(`${confidenceIcon} ${itemName} x${quantity} aggiunto - ${formatCurrency(bestPrice.price * quantity)} @ ${bestPrice.store}`);
}